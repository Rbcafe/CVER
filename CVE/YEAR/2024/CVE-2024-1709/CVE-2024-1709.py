# CVE-2024-1709
# ░█████╗░██╗░░██╗░██████╗██████╗░██╗░░██╗██╗███╗░░██╗██╗░░██╗
# ██╔══██╗╚██╗██╔╝██╔════╝██╔══██╗██║░░██║██║████╗░██║╚██╗██╔╝
# ██║░░██║░╚███╔╝░╚█████╗░██████╔╝███████║██║██╔██╗██║░╚███╔╝░
# ██║░░██║░██╔██╗░░╚═══██╗██╔═══╝░██╔══██║██║██║╚████║░██╔██╗░
# ╚█████╔╝██╔╝╚██╗██████╔╝██║░░░░░██║░░██║██║██║░╚███║██╔╝╚██╗
# ░╚════╝░╚═╝░░╚═╝╚═════╝░╚═╝░░░░░╚═╝░░╚═╝╚═╝╚═╝░░╚══╝╚═╝░░╚═╝
# LinkedIn: https://www.linkedin.com/in/0xsphinx


import requests
from requests.exceptions import RequestException, SSLError
from urllib3.exceptions import InsecureRequestWarning

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

input_file_path = 'hosts.txt'
output_file_path = 'vulnerable_hosts.txt'

with open(input_file_path, 'r') as input_file, open(output_file_path, 'a') as output_file:
    for host in input_file:
        host = host.strip()

        if not host.startswith("http://") and not host.startswith("https://"):
            host = "http://" + host

        try:
            response_initial = requests.get(host + "/SetupWizard.aspx", verify=False, allow_redirects=False, timeout=30)
        except (SSLError, RequestException) as e:
            continue 

        if response_initial.status_code == 302:
            try:
                response_final = requests.get(host + "/SetupWizard.aspx/", verify=False, allow_redirects=False, timeout=30)
                if response_final.status_code == 200:
                    print(f"Successful: {host}/SetupWizard.aspx/")
                    output_file.write(host +"/SetupWizard.aspx/"+ '\n')
                    output_file.flush()
                else:
                    print(f"Unsuccessful: {host}, Status Code: {response_final.status_code}")
            except (SSLError, RequestException) as e:
                continue
                
        else:
            print(f"Ignoring host due to initial 302 redirect: {host}")
