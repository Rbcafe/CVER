{
  "id": 65284,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NTI4NA==",
  "url": "https://hackerone.com/reports/65284",
  "title": "Stored Cross-Site Scripting in Map Share Page",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2015-06-01T18:54:36.379Z",
  "submitted_at": "2015-06-01T18:54:36.379Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "hussain_0x3c",
    "url": "/hussain_0x3c",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/i5136ewsb8ixn0dfg3cgrr2pqsoy/ede8cd84a64d5392a2bb88ecb598721116469c27c015c2caa77148f11e211d58"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 1366,
    "url": "https://hackerone.com/mapbox",
    "handle": "mapbox",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Mapbox",
      "twitter_handle": "mapbox",
      "website": "https://www.mapbox.com/security",
      "about": "Mapbox is an open source mapping platform, providing building blocks for developers to integrate location into any mobile or online application."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2016-04-19T21:23:39.661Z",
  "bug_reporter_agreed_on_going_public_at": "2016-03-24T15:32:08.653Z",
  "team_member_agreed_on_going_public_at": "2016-04-19T21:23:39.589Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hi Team Mapbox Security \r\nThis is Copy From message email ( ‫security@mapbox.com‬ ) \r\n\r\nintro.\r\nI'm Hussain Adnan Researcher Security,\r\nIam Have  Found  Vulnerability *Bug* in form project profile ( Map )\r\n\r\nType Vulnerability : Cross-Site Scripting ( Stored - Reflected ) \r\nAffected Domain : Affected Domain : mapbox.com - a.tiles.mapbox.com\r\nlink Demo to execute : Reflected \r\n~~~ \r\nhttps://a.tiles.mapbox.com/v4/ibmsecurity.ma91e43j/page.html?access_token=pk.eyJ1IjoiaWJtc2VjdXJpdHkiLCJhIjoiOWI0NDYxYjVmMjYzNjE2Yjc1ODM5NDgxOTBmMTFkODEifQ.EIBxJM1o7YiuI4pgZ7bsjg \r\n~~~\r\nCode javascript  execute   in mapbox.com on form  search map edited.\r\nand  execute    in a.tiles.mapbox.com on URL \r\n\r\nSteps to reproduce\r\n-----\r\nan attacker delete #  from  url  and  get  url  code  execute    Stored  - Reflected \r\nhttp://im54.gulfup.com/0gseLU.gif\r\n\r\n----\r\nPOC   : https://youtu.be/N_4mqOtp07c - http://im54.gulfup.com/0gseLU.gif\r\n\r\n\r\n\r\n\r\nBe Safe\r\nBest Regards ",
  "weakness": {
    "id": 60,
    "name": "Cross-site Scripting (XSS) - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2016-04-23T15:32:09.184Z",
  "allow_singular_disclosure_after": -246398938.88296416,
  "singular_disclosure_allowed": true,
  "vote_count": 3,
  "voters": [
    "shivammusic",
    "spetr0x",
    "dyabla"
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 1719,
      "category": "team",
      "content": "In June 2015, @hussain found a stored cross-site scripting (XSS) vulnerability in the share page of our v3 and v4 Mapbox classic maps. This vulnerability did not affect mapbox.js, Mapbox GL JS, or any of our mobile SDKs, it only affected the share page for v3 and v4 maps hosted on *.tiles.mapbox.com. In order to be subject to the XSS attack, a user had to either directly visit the share URL of a malicious map or visit an attacker-controlled web page with a malicious map embedded via an `iframe`. \n\nHussain created a [map](https://a.tiles.mapbox.com/v4/ibmsecurity.ma91e43j/page.html?access_token=pk.eyJ1IjoiaWJtc2VjdXJpdHkiLCJhIjoiOWI0NDYxYjVmMjYzNjE2Yjc1ODM5NDgxOTBmMTFkODEifQ.EIBxJM1o7YiuI4pgZ7bsjg) in the online classic map editor and added several XSS payloads to a few map markers.\n\nThe payload `&lt;img src=x onerror=alert(1) \"` evaded sanitization and executed arbitrary JavaScript immediately. The payload was added to the DOM as part of a list of map marker titles in the top left hand corner of the share page.\n\nThe following old code in https://a.tiles.mapbox.com/v3/embed/share.js and https://a.tiles.mapbox.com/v4/embed/share.js was vulnerable:\n\n```\nfunction stripHTML(html) {\n   var tmp = document.createElement('DIV');\n   tmp.innerHTML = L.mapbox.sanitize(html);\n   return tmp.textContent || tmp.innerText || '';\n}\n```\n\nThe `stripHTML` function returned `<img src=x onerror=alert(1) \"` due to the use of `textContent`, which converted the `&lt;` HTML entity into the left angle bracket unicode character (`<`). As a result, the payload was added to the share page as `<img src=x onerror=alert(1) \"`, executing `alert(1)` on error when loading the image with no source.\n\nWe resolved the issue by using underscore's [escape function](http://underscorejs.org/#escape) before returning the `textContent` of the marker. \n\n```\nfunction stripHTML(html) {\n   var tmp = document.createElement('DIV');\n   tmp.innerHTML = L.mapbox.sanitize(html);\n   return _.escape(tmp.textContent || tmp.innerText || '');\n}\n```\n\nAs seen in [this map](https://a.tiles.mapbox.com/v4/alulsh.pnbm6b4b/page.html?access_token=pk.eyJ1IjoiYWx1bHNoIiwiYSI6ImY0NDBjYTQ1NjU4OGJmMDFiMWQ1Y2RmYjRlMGI1ZjIzIn0.pngboKEPsfuC4j54XDT3VA#3/61.73/41.92), the map marker title is `<img src=x onerror=alert(1)\"` now instead of a broken image tag.",
      "user": {
        "id": 39856,
        "username": "alulsh",
        "name": "Alexandra Ulsh",
        "bio": "",
        "cleared": false,
        "verified": false,
        "website": "http://alexandraulsh.com",
        "location": "Washington, D.C.",
        "created_at": "2015-09-09T10:35:58.141Z",
        "url": "https://hackerone.com/alulsh",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/cccd3716a6d2e06174d2a41492445cb1d4bf85b4611a755bc810b9246a24d951",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/67ff39e4a58539d410215f8dba66a6070ecd205a28d2d3cc89a9223fcfd99d7c",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/d1445988e2aaee9e43a96ed7edc9348b9095032dce95c8873f36a1ca91ca18f7"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
