{
  "id": 66962,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82Njk2Mg==",
  "url": "https://hackerone.com/reports/66962",
  "title": "Misusing of FPU Instruction Could Cause Security Vulnerabilities in Adobe Flash Player",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2015-06-09T19:20:55.951Z",
  "submitted_at": "2015-06-09T19:20:55.951Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "yopwn",
    "url": "/yopwn",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQTF44ZAEY%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T114144Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIFEl8GqbU4%2BAZWXm076AaH%2B3S407ekrwvRLdQXFj8maSAiEA7oNJs0dICVPaCtN3NpIrAoDbQV6Ejyi77KrlQuPRpBUqsgUIcBADGgwwMTM2MTkyNzQ4NDkiDNahsKqUdewADnORUCqPBbSt2LFuIdf7dnF6%2BSGZ9cPoiAZQMWLALN%2BWYyomEtoEWkOWvMa3f%2FvHfanqxv8y5APokVYlWhRKSi8EMnvvYlLkZCoZfEBYxrita%2BGJmOnAfLzKbAP4Y1yam8eHRyWd6gZv7A4xifGB4%2ByVBYpUwFfY%2FtSjbc%2FADNbGz8H5boNvsNv97iDrtAsWuhS%2BTsE9HMWty2Q5Kps5ZGh719NET5yzc4Q%2FtQXq6VZEsGmZJkhBk53ZbFfobOPyei9pZmZ6%2F2Mdq5510O22TvjtOWihXdrUVF18IGjoWAOzpmqJcFgY3pqd5Ptl8Jdv66jxrsyfzyou5wCExfQr5qzH9Vpmay4uCPhR%2FSyOG0CWwOh8b8NbDwQiT7n2e8mRdgfAZzQDYWZ3kDf3xJl4T%2BjizpvEyF4k8cnRHigJ9psCKck22rc%2FdJIeRzDPuK5gMydq%2BbZEiPRUgdLry1vf%2FHAVYzhqB51d5Ia44hsUeGvDrXu3hn5jGoJVb3p%2Bu8LXRAkstmLBEwTwx74%2BZLrtaIUbsPvoibM71bPShjn%2BeifHzFDMz1pzYAEKS3bKR%2BF6mAsb4TJcHb1aEgl%2F2VZr38huYt8TwDwXCn28i8e7UPTktLQ2%2BMY1xUbNU3qxurYTVuFskexXKmi%2BnALorE9k8A7GDdADBu%2BosuLTO%2FnUPwqP7dZYKwg749EtuHvA2OFyp16mblUz6KrLb%2FfAf3TLzS6zHIe9WcnoK0psjQn6DQdUv66ZNqunDkraEzFI7GUBVlDXzoFJMpTnm5cbS7icJeTI6SUbCamKJgZz1LYzEzm33%2FlZTz%2BFyEGL8HyorVpd5vY4dHVbb%2FeMQNELRsc2s1ONbdE6YfwyrhFyYvYBiYx9Ye%2F4ssowjpisrgY6sQFmStbg5zGr%2B68rMwEIJwcr9jwJvywdn4oxOR6RXInAJwN7lgch%2FvzVf1lSeRFZ6LuihOe%2FS4iwHxeNi0t9Xh3zgBPmKv%2FWlXb8g%2B6ZDByHn%2FH6haAptR1xW4BXNpTl7xRg1NW7b9aUxDCrRqOG%2Fy%2Bh2qYMDczVX6rGrxtEquYnaLpzcZzZ9hdZysgVk1A1SxT6%2Bkfp2tIiSadsRwSyKAYEPliJeaGXm3nwn7sIZmazF5Y%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=93780cdfed9d7e2649e4ed4e776393832f5c16a8dffa129edaf682d82078a2d0",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQTF44ZAEY%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T114144Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIFEl8GqbU4%2BAZWXm076AaH%2B3S407ekrwvRLdQXFj8maSAiEA7oNJs0dICVPaCtN3NpIrAoDbQV6Ejyi77KrlQuPRpBUqsgUIcBADGgwwMTM2MTkyNzQ4NDkiDNahsKqUdewADnORUCqPBbSt2LFuIdf7dnF6%2BSGZ9cPoiAZQMWLALN%2BWYyomEtoEWkOWvMa3f%2FvHfanqxv8y5APokVYlWhRKSi8EMnvvYlLkZCoZfEBYxrita%2BGJmOnAfLzKbAP4Y1yam8eHRyWd6gZv7A4xifGB4%2ByVBYpUwFfY%2FtSjbc%2FADNbGz8H5boNvsNv97iDrtAsWuhS%2BTsE9HMWty2Q5Kps5ZGh719NET5yzc4Q%2FtQXq6VZEsGmZJkhBk53ZbFfobOPyei9pZmZ6%2F2Mdq5510O22TvjtOWihXdrUVF18IGjoWAOzpmqJcFgY3pqd5Ptl8Jdv66jxrsyfzyou5wCExfQr5qzH9Vpmay4uCPhR%2FSyOG0CWwOh8b8NbDwQiT7n2e8mRdgfAZzQDYWZ3kDf3xJl4T%2BjizpvEyF4k8cnRHigJ9psCKck22rc%2FdJIeRzDPuK5gMydq%2BbZEiPRUgdLry1vf%2FHAVYzhqB51d5Ia44hsUeGvDrXu3hn5jGoJVb3p%2Bu8LXRAkstmLBEwTwx74%2BZLrtaIUbsPvoibM71bPShjn%2BeifHzFDMz1pzYAEKS3bKR%2BF6mAsb4TJcHb1aEgl%2F2VZr38huYt8TwDwXCn28i8e7UPTktLQ2%2BMY1xUbNU3qxurYTVuFskexXKmi%2BnALorE9k8A7GDdADBu%2BosuLTO%2FnUPwqP7dZYKwg749EtuHvA2OFyp16mblUz6KrLb%2FfAf3TLzS6zHIe9WcnoK0psjQn6DQdUv66ZNqunDkraEzFI7GUBVlDXzoFJMpTnm5cbS7icJeTI6SUbCamKJgZz1LYzEzm33%2FlZTz%2BFyEGL8HyorVpd5vY4dHVbb%2FeMQNELRsc2s1ONbdE6YfwyrhFyYvYBiYx9Ye%2F4ssowjpisrgY6sQFmStbg5zGr%2B68rMwEIJwcr9jwJvywdn4oxOR6RXInAJwN7lgch%2FvzVf1lSeRFZ6LuihOe%2FS4iwHxeNi0t9Xh3zgBPmKv%2FWlXb8g%2B6ZDByHn%2FH6haAptR1xW4BXNpTl7xRg1NW7b9aUxDCrRqOG%2Fy%2Bh2qYMDczVX6rGrxtEquYnaLpzcZzZ9hdZysgVk1A1SxT6%2Bkfp2tIiSadsRwSyKAYEPliJeaGXm3nwn7sIZmazF5Y%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2cd94f6da9e6997d4e802689aeef39531c722002242f5f7775a09e67a1768fb3"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2015-3100"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-11-12T09:43:36.415Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2019-10-13T09:43:28.436Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Misusing of FPU Instruction Could Cause Security Vulnerabilities in Adobe Flash Player\r\n\r\nThis vulnerability (CVE-2015-3100) was reported to Adobe on March 10, 2015 and has been patched today via APSB15-11 (https://helpx.adobe.com/security/products/flash-player/apsb15-11.html).\r\n\r\nFollowing is the original vulnerability report, sharing privately for your assessment of the impact.\r\n\r\nSummary:\r\n========\r\nThere is a security vulnerability in Adobe Flash Player when using FPU instructions. Successfully exploiting this vulnerability allows the attacker run arbitrary code with the same right of the current user.\r\n\r\n\r\nDetails:\r\n========\r\nAccording to http://en.wikibooks.org/wiki/X86_Assembly/Floating_Point#FPU_Register_Stack,\r\n\r\n\"the FPU has 8 registers, st0 to st7, formed into a stack. Numbers are pushed onto the stack from memory, and are popped off the stack back to memory\".\r\n\r\nPrograms are responsible to maintain the stack when using FPU instructions. If not, for example, all the 8 registers are in-use, future FPU instruction may fail and cause a \"stack overflow\" problem while the failed instruction doesn't have a chance to know. \r\n\r\n\r\nUnder some certain situation, Adobe Flash Player may use FPU instructions to handle floating numbers. When playing the attached \"PoC.swf\", it will run the following function/code.\r\n\r\n.text:009CE380 sub_9CE380      proc near               \r\n.text:009CE380\r\n.text:009CE380 arg_0           = dword ptr  4\r\n.text:009CE380\r\n.text:009CE380                 mov     eax, [esp+arg_0]\r\n.text:009CE384                 mov     ecx, eax\r\n.text:009CE386                 and     ecx, 7\r\n.text:009CE389                 cmp     cl, 6\r\n.text:009CE38C                 jnz     short loc_9CE39A\t\t;jmp to 009CE39A\r\n.text:009CE38E                 sar     eax, 3\r\n.text:009CE391                 mov     [esp+arg_0], eax\r\n.text:009CE395                 fild    [esp+arg_0]\r\n.text:009CE399                 retn\r\n.text:009CE39A ; ---------------------------------------------------------------------------\r\n.text:009CE39A\r\n.text:009CE39A loc_9CE39A:\t\t\t\t\t\r\n.text:009CE39A                 and     eax, 0FFFFFFF8h\r\n.text:009CE39D                 fld     qword ptr [eax]\t\t;this will cause one more FPU register in use\r\n.text:009CE39F                 retn\r\n.text:009CE39F sub_9CE380      endp\r\n\r\n(We are using the Flash Player projector for test, version is 16.0.0.305.)\r\n\r\nHowever, the main function which calls the sub_9CE380 doesn't \"restore\" the FPU register's status correctly. Instead of \"clean\" the registers, it simply return to its main function, and there is no place to \"clean\" the FPU registers at all. Let's see what the main function does.\r\n\r\n03ED5C89    83C4 10         add     esp, 10\r\n03ED5C8C    83EC 0C         sub     esp, 0C\r\n03ED5C8F    50              push    eax\r\n03ED5C90    E8 EB86AFFC     call    flashpla.009CE380\t\t; call to use one FPU register\r\n03ED5C95    83C4 10         add     esp, 10\t\t\t; no instruction to \"clean\" the FPU register \r\n03ED5C98    8BE5            mov     esp, ebp\r\n03ED5C9A    5D              pop     ebp\r\n03ED5C9B    C3              retn\t\t\t\t; return\r\n\r\nThis is a JITed function from our bytecode in one of the \"method_bodies\" in the SWF file. In the main function of this function, it also doesn't have any FPU instruction to clean the register. Here is what it may look like:\r\n\r\n00A10E86    2BE1            sub     esp, ecx\r\n00A10E88    51              push    ecx\r\n00A10E89    8B4D 10         mov     ecx, dword ptr [ebp+10]\r\n00A10E8C    8B55 0C         mov     edx, dword ptr [ebp+C]\r\n00A10E8F    8B46 08         mov     eax, dword ptr [esi+8]\r\n00A10E92    8B40 04         mov     eax, dword ptr [eax+4]\r\n00A10E95    51              push    ecx\r\n00A10E96    52              push    edx\r\n00A10E97    56              push    esi\r\n00A10E98    FFD0            call    eax\t\t\t\t; call to our previously-discussed function\r\n00A10E9A    83C4 0C         add     esp, 0C\r\n00A10E9D    59              pop     ecx\r\n00A10E9E    03E1            add     esp, ecx\r\n00A10EA0    59              pop     ecx\r\n00A10EA1    5E              pop     esi\r\n00A10EA2    5D              pop     ebp\r\n00A10EA3    C3              retn\t\t\t\t; return\r\n\r\n\r\nAnyway, when running the 1st time of sub_9CE380, st(0) will become \"in-use\", when running the 2nd time, the st(0) and st(1) will become \"in-use\". After we run it 6 times, which will cause st(0) to st(5) \"in-use\" - this is exactly what we see when playing our PoC.swf.\r\n\r\nA failure of maintaining the FPU register stack may cause many problems. For example, if all the 8 registers are all in-use, future FPU instruction which related to FPU register may fail, and the program usually don't have a way to detect such instruction-level failure.\r\n\r\nThe attached \"PoC.swf\" will cause the program run to the sub_009EB440 function. There will be some FPU instructions involved and some will fail. Since it's probably a good example to explain this situation, let's see what the sub_009EB440 does. We use Hex-Rays Decomplier and got the following piece of code.\r\n\r\n  if ( r_value >= 1.0 )\r\n  {\r\n    v7 = floor(r_value);\r\n    if ( 0.0 != v7 )\r\n    {\r\n      v15 = (double)radix;\r\n      v16 = 1.0 / v15;\r\n      do\t\t\t//starting point of the loop\r\n      {\r\n        v14 = v7;\r\n        v7 = floor(v7 * v16);\r\n        v8 = v14 - v15 * v7;\r\n        if ( v8 >= 10.0 )\r\n          v9 = (signed int)v8 + 87;\r\n        else\r\n          v9 = (signed int)v8 + 48;\r\n        *v4-- = v9;\t\t/******note: writing 1 byte to stack memory, and the pointer is decreased by 1******/\r\n      }\r\n      while ( 0.0 != v7 );\t//the loop\r\n    }\r\n    if ( !negative )\r\n      goto LABEL_16;\r\n    *v4 = 45;\r\n  }\r\n  else\r\n  {\r\n    LOBYTE(v13) = 48;\r\n  }\r\n\r\nIt's probably the \"MathUtils::convertDoubleToStringRadix()\" function in Adobe's open-sourced \"avmplus\" code.\r\n\r\nUsually the above code run well, but if there is a FPU register stack overflow, some instruction will fail and it will cause that the execution in the loop will not have a chance to get out - which will cause all the stack memory be overwritten.\r\n\r\nWe have observed the following \"WRITE\" exception in the following address:\r\n\r\neax=80000057 ebx=03774000 ecx=00000000 edx=00000000 esi=00032fff edi=0012e650\r\neip=009eb50d esp=0012e250 ebp=0012e690 iopl=0         nv up ei ng nz na po nc\r\ncs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00240282\r\nflashplayer_16_sa!IAEModule_IAEKernel_UnloadModule+0xff91d:\r\n009eb50d 8806            mov     byte ptr [esi],al          ds:0023:00032fff=00\r\n0:000> db esi\r\n00032fff  00 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  .WWWWWWWWWWWWWWW\r\n0003300f  57 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  WWWWWWWWWWWWWWWW\r\n0003301f  57 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  WWWWWWWWWWWWWWWW\r\n0003302f  57 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  WWWWWWWWWWWWWWWW\r\n0003303f  57 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  WWWWWWWWWWWWWWWW\r\n0003304f  57 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  WWWWWWWWWWWWWWWW\r\n0003305f  57 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  WWWWWWWWWWWWWWWW\r\n0003306f  57 57 57 57 57 57 57 57-57 57 57 57 57 57 57 57  WWWWWWWWWWWWWWWW\r\n\r\nThe following instruction \"fld1\" will fail due to that all the registers are in-use.\r\n\r\n.text:009EB4C1                 fild    [ebp+arg_C]\r\n.text:009EB4C4                 fst     [ebp+var_1C]\r\n.text:009EB4C7                 fld1\t\t\t\t;all the 8 registers are in-use\r\n.text:009EB4C9                 fdivrp  st(1), st\r\n.text:009EB4CB                 fstp    [ebp+var_14]\r\n\r\nReaders should note that the above crash we discussed is essentially caused by the wrong use of FPU instructions, such a wrong use may bring many future problems, the above crash - even it looks not quite possible to develop a working exploit - was just one scenario.\r\n\r\nReproduce:\r\n==========\r\nOpen the attached \"PoC.swf\" (the password for the PoC.zip is \"adobe_mcafee\") you will see the crash. Use your debugger to see what's going on.",
  "weakness": {
    "id": 2,
    "name": "Memory Corruption - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-11-12T09:43:28.515Z",
  "allow_singular_disclosure_after": -134272695.7799368,
  "singular_disclosure_allowed": true,
  "vote_count": 2,
  "voters": [
    "lumbridge",
    "shivammusic"
  ],
  "structured_scope": {
    "databaseId": 84122,
    "asset_type": "OTHER",
    "asset_identifier": "IBB (Legacy)",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
