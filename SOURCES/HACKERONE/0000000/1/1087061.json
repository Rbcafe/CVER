{
  "id": 1087061,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDg3MDYx",
  "url": "https://hackerone.com/reports/1087061",
  "title": "Stored-XSS on wiki pages",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2021-01-25T21:21:47.323Z",
  "submitted_at": "2021-01-25T21:21:47.404Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "yvvdwf",
    "url": "/yvvdwf",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/ubqmt760dugarh527x4qc4mkdn4n/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": false,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 264,
    "url": "https://hackerone.com/gitlab",
    "handle": "gitlab",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "GitLab",
      "twitter_handle": "gitlab",
      "website": "https://about.gitlab.com",
      "about": "A single application for the entire software development lifecycle."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2021-07-13T08:35:54.633Z",
  "bug_reporter_agreed_on_going_public_at": "2021-07-13T08:35:54.540Z",
  "team_member_agreed_on_going_public_at": "2021-07-12T22:54:00.703Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hello,\n\nA Stored-XSS is existing on Wiki pages. It is caused by recent change in [show.html.haml#L10](https://gitlab.com/gitlab-org/gitlab/blob/3e543192b1179c79e0a44ae6f32648fa7155c10e/app/views/shared/wikis/show.html.haml#L10)\n\n```ruby\n       ... \"<a href='#{@page.last_version.author_url}'>\".html_safe ...\n```\n\n`author_url` is defined by committed email in [wiki_page_version.rb](https://gitlab.com/gitlab-org/gitlab/blob/3e543192b1179c79e0a44ae6f32648fa7155c10e/lib/gitlab/git/wiki_page_version.rb):\n\n```ruby\n     delegate :message, :sha, :id, :author_name, :author_email, :authored_date, to: :commit\n\n      def author_url\n        user = ::User.find_by_any_email(author_email)\n        user.nil? ? \"mailto:#{author_email}\" : Gitlab::UrlBuilder.build(user)\n      end\n```\n\nSince the `author_url`is considered as `safe`, attackers may inject any DOM attributes of `<a>` tag. \n\n\n### Steps to reproduce\n\n1. Clone wiki repository of an existing project or a new one, for example: `git clone git@gl.local:root/test.wiki.git`\n2. Go to inside `test.wiki` directory, then add the 3 following lines at then end of  `.git/config` file (if there exists `[user]` section in `.git/config`, then replace its section by the following lines):\n\n```\n[user]\n\tname = anyname\n\temail = \"#' style=animation-name:blinking-dot onanimationstart=alert(document.domain) other\"\n```\n\n3.  Modify/create any wiki page, for example: `echo \"Hi\" >> home.md`\n4. Commit the modification and push it into gitlab server\n5. Open the wiki page in Web browser,  http://gl.local/hi/test/-/wikis/home, you should see the alert\n\n### Impact\n\nXSS may allows attackers to perform any actions on behalf of victims at client side.\n\n\n### What is the current *bug* behavior?\n\n`author_url` is not sanitized\n\n### What is the expected *correct* behavior?\n\n`author_url`  should be sanitized\n\n### Output of checks\n\n#### Results of GitLab environment info\n\n(For installations with omnibus-gitlab package run and paste the output of:\n`sudo gitlab-rake gitlab:env:info`)\n\n```\nSystem:\t\tUbuntu 18.04\nProxy:\t\tno\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.7.2p137\nGem Version:\t3.1.4\nBundler Version:2.1.4\nRake Version:\t13.0.3\nRedis Version:\t5.0.9\nGit Version:\t2.29.0\nSidekiq Version:5.2.9\nGo Version:\tunknown\n\nGitLab information\nVersion:\t13.8.0-ee\nRevision:\t1ae10d09692\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t12.4\nURL:\t\thttp://gl.local\nHTTP Clone URL:\thttp://gl.local/some-group/some-project.git\nSSH Clone URL:\tgit@gl.local:some-group/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers: \n\nGitLab Shell\nVersion:\t13.15.0\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n```\n\n## Impact\n\nXSS may allows attackers to perform any actions on behalf of victims at client side.",
  "weakness": {
    "id": 62,
    "name": "Cross-site Scripting (XSS) - Stored"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 57,
  "voters": [
    "xenx",
    "taha",
    "osman1337",
    "n1m0",
    "fqdn",
    "run_win",
    "tess",
    "imranhudaa",
    "ali",
    "0xdln",
    "and 47 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 5.4,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "required",
      "scope": "changed",
      "confidentiality": "low",
      "integrity": "low",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 39022,
    "asset_type": "OTHER",
    "asset_identifier": "Your Own GitLab Instance",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
