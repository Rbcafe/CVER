{
  "id": 1364851,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzY0ODUx",
  "url": "https://hackerone.com/reports/1364851",
  "title": "WordPress Plugin Update Confusion at trafficfactory.com",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2021-10-10T10:59:43.612Z",
  "submitted_at": "2021-10-10T10:59:43.670Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "vavkamil",
    "url": "/vavkamil",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/069/616/003619f9ca0b0b3d11a238bb540d86b9b22d5b5c_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 50466,
    "url": "https://hackerone.com/trafficfactory",
    "handle": "trafficfactory",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/shvdZeiJg1R2ZaaKjRyDcj5S/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/shvdZeiJg1R2ZaaKjRyDcj5S/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Traffic Factory",
      "twitter_handle": "",
      "website": "https://www.trafficfactory.com/",
      "about": ""
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2021-11-25T09:11:00.772Z",
  "bug_reporter_agreed_on_going_public_at": "2021-11-25T09:11:00.637Z",
  "team_member_agreed_on_going_public_at": "2021-10-15T13:00:42.471Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hi,\n\nI'm currently researching a \"novel\" supply chain attack affecting WordPress plugins, and I believe your website might be vulnerable.\n\nThe way it works is similar to a recent [Dependency Confusion](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610) attack, where a malicious actor can take over internal packages unclaimed on PyPI / npm registry.\n\nIf you use an internally developed WordPress plugin not present in WordPress Plugin Directory, an attacker might upload it there. That would introduce the \"[Confused deputy problem](https://en.wikipedia.org/wiki/Confused_deputy_problem)\" attack scenario, where the privileged user, instructed to update all plugins regularly, inadvertently infects the instance with malware.\n\nI wrote a custom scanner, which passively detects plugins on a front page (JS/CSS assets), and searches the slug name in the WP SVN registry. It found \"tf-elementor\" plugin installed at \"trafficfactory.com\":\n\n`https://www.trafficfactory.com/wp-content/plugins/tf-elementor/assets/css/tf9d3a.css?ver=5.6.5`\n\ncurrently not present in:\n\n`https://plugins.svn.wordpress.org/tf-elementor`\n\n## Steps To Reproduce:\n\nThe WordPress approval process for new plugins is automated and [open-source](https://meta.trac.wordpress.org/browser/sites/trunk/wordpress.org/public_html/wp-content/plugins/plugin-directory/shortcodes/class-upload-handler.php), so it's possible to see which checks needs to pass:\n\n- Slug must only contain lowercase alphanumeric characters and dash.\n- Slug can't have a reserved name like wp-admin (`has_reserved_slug()`)\n- Slug can't be on a list of protected trademarks (`has_trademarked_slug()`)\n- Slug can't be installed on more than 100 websites (`wporg_stats_get_plugin_name_install_count`)\n\nThe whole flow looks like this:\n\n1. An attacker submits a plugin with the same name you use for a review\n2. It will pass the review process, and the attacker gets access to the SVN repository\n3. The attacker uploads the plugin files, and it's added to the WordPress Plugin Directory for anyone to use\n4. The attacker adds a backdoor and bumps the plugin version\n5. You will get a notification that a new update is available; when you update, your website gets compromised\n\nI did not attempt to claim your plugin, as the update would inadvertently break the website (old plugin files will get deleted), but I simulated the attack with [my custom plugin](https://wordpress.org/plugins/xml-rpc-settings/), and it works.\n\n## How to mitigate\n\nThere is no easy way to defend yourself because it's by design, and WordPress doesn't allow you to upload a \"dummy\" version of your plugin. You can either add the plugin you use in the WordPress Plugin Directory or change the plugin name to prevent the review process from succeeding.\nThe plugin slug can only contain lower case alphanumeric characters and dash as a delimiter. Some of the keywords are prohibited as well, which could help us in this case. That means that you can rename your custom plugins in the following ways:\n\n- `internal_plugin_name`\n- `InternalPluginName`\n- `wp-internal-plugin-name`\n\nIt is also possible to leverage a [hook](https://developer.wordpress.org/reference/hooks/upgrader_package_options/) and write a custom update function, blocking the internal WP API call and replacing it with your own, similar to how a paid plugin offers custom updates from their servers.\n\nSome plugins do that for you, for example, [Easy Updates Manager](https://wordpress.org/plugins/stops-core-theme-and-plugin-updates/), which allows you to block updates for specific plugins.\n\n## Supporting Material/References:\n\nI wrote a custom scanner in Python, a WordPress Docker container to simulate the Plugin update process, a custom plugin to pass the review for the SVN registry, and an extensive write-up describing everything in more detail.\n\nI plan to publish everything soon, but let me know, and I will share a draft with you beforehand. Feel free to requests any additional info from me, as I understand it sounds more like a theoretical vulnerability without a valid PoC.\n\nThank you!\n\nKind regards,\n@vavkamil\n\n## Impact\n\nAn attacker can hijack your plugin, currently not available in the WordPress Plugin Directory (SVN registry). If that happens and you update the plugin, it can introduce a backdoor or RCE, essentially giving keys to the kingdom to the attacker.",
  "bounty_amount": "200.0",
  "formatted_bounty": "$200",
  "weakness": {
    "id": 65,
    "name": "Business Logic Errors"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 66,
  "voters": [
    "nepalihacker0x01",
    "m7arm4n",
    "ganeshbagaria",
    "tolga",
    "testt0",
    "drsniper",
    "nagli",
    "ar6aaz",
    "fqdn",
    "trieulieuf9",
    "and 56 more..."
  ],
  "severity": {
    "rating": "low",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 54936,
    "asset_type": "URL",
    "asset_identifier": "www.trafficfactory.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
