{
  "id": 1193062,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTkzMDYy",
  "url": "https://hackerone.com/reports/1193062",
  "title": "Privilege escalation of \"external user\" (with maintainer privilege) to internal access  through project token",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2021-05-12T08:15:41.699Z",
  "submitted_at": "2021-05-12T08:15:41.788Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "joaxcar",
    "url": "/joaxcar",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/9865qc9er7t2lratx5rgszbf3257/ede8cd84a64d5392a2bb88ecb598721116469c27c015c2caa77148f11e211d58?response-content-disposition=inline%3B%20filename%3D%224FB38693-148C-4D50-BBCD-D726D3AE2B4F.jpeg%22%3B%20filename%2A%3DUTF-8%27%274FB38693-148C-4D50-BBCD-D726D3AE2B4F.jpeg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3DOTL4Z4%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T141118Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCP1h%2BMnyvDRDa6h%2F4zIodqh2MzJlGISvpnoEvR4kc2fgIgP8fAE6zkU2xDXiIdq36r00FCUyYf6OQc2MuvlpSL6zgqsgUIdhADGgwwMTM2MTkyNzQ4NDkiDJ2sbhPrB5o6p2UkMiqPBcMZAZzMf1lo6ftFZmyVLqm8Hg2J3xbj6a3GuTLabMbNJWiA%2FZsFo0hE3gxRPbyAqhG6FJuKINNLYiqNvOekzW8sar88psZuM%2FX9%2FNoLvFSAVVJpHHBKNZUcwzDsSG6dL68X0%2F81p9YWjmvjokQY%2B9nuD7359WQ659K26Fclw65VMeRybJ1hUyi2a%2FyS4P%2FH0PoUc1H0vEsvCcDRZFSU2VqX6BFziwRAbmxLuUXTN5m%2F5hWF5b3%2BkgFf3EOVPo%2BXtyBL0zsVvefLcDnkTyLYtjGuMSoKMfdzhMUUnoy%2FSkL%2FnqSrrhe9QDnvuA12WJYXs7dXUtOgD1FweSHqkAlJgnKNM8PYSjJnvj8q9w4J7BBdDstdMKFug3p2hl8P0Z3ewTKwgYQFTrJSgQ5k2oIl05GLUuZEuGlOhqiAdJ0VSwCyoN%2BcsLtWKUwcF5i%2BGCo6ppjPFD80qdzVR70b4ApfmQxVQXMoqtkj6LQcYtZ%2BagRqhM%2BtszUfSlLJd2TtHW1cmvfHpY38mbjTqSHEOfCoz%2FpdesWuHOFHT%2FPgVGOwrKnQpNMV%2FyR1KqF%2B%2F4CD%2FGMR2tktKBwuNfh2OlxQvwD2aE8XvEC%2B4mc3056ID7XSvkKVVQ5FPigZOQTgvmJ494qVF7ehsKzqTF%2B9hAoK4S6zfV7Rj7ZQPgHv3om4hYuHsgUcaD29IgjjBb7uAyiaX%2BnWynmxhoDSjS8R%2BX%2Fh548W%2F5oeVorlsLKwzmcY%2Fn5eCd84hK21TQBO83%2FN5WvC2Rjqcrcse3ypMcrNI7pSoyAYBbW7BZ7x1FSQkjJ0k9%2BmmuCWHGFTK1yvtjTnkqMZorU8FXNTbF9f5hhpv%2FD%2Bx%2FaaWxL40nM7EEpqTFiYBitKsZow7cCtrgY6sQExtT%2FZOBwnOUsXGGVn22KELl38mJ%2B5OivmNc%2Fgks2i4L3ET0mxTFvDVZpjL316NVv%2FbrIj%2Fy2VtfGofe3Raptm7CsozbMN%2FwB4%2F%2B1rcHUIoVQ8JJTc06nsi5aVYzNhXnbrwhbQkoT0dxKYDFETL%2B6%2F051XAavIrnvB5CtHwa5YaT7z83h5GNqUOlmAh9%2BiDFNSkfEsNFaYzGytNE8syYguoEi7iDkqQjn2z2qwL4LrkcU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=481c8b53efa5e2ece4e5ce1281de39d35eb014bf2efff8f5cca810aca445eb74"
    },
    "is_me?": false,
    "cleared": false,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 264,
    "url": "https://hackerone.com/gitlab",
    "handle": "gitlab",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "GitLab",
      "twitter_handle": "gitlab",
      "website": "https://about.gitlab.com",
      "about": "A single application for the entire software development lifecycle."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2021-10-11T10:23:00.708Z",
  "bug_reporter_agreed_on_going_public_at": "2021-10-11T09:52:21.688Z",
  "team_member_agreed_on_going_public_at": "2021-10-11T10:23:00.491Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "### Summary\n\nAn \"external user\" (a user account with the status external) which is granted \"Maintainer\" role on any project on the GitLab instance where \"project tokens\" are allowed can elevate its privilege to \"Internal\". An external user with maintainer permissions could create a project token, which will be connected to a bot user with internal privileges on the GitLab instance. Thus, now being able to access all internal projects and snippets as a Guest user. This includes\n\n* Accessing all information about internal projects as if having Guest permissions (including source code)\n* Creating issues on internal projects\n* Creating projects and groups (these will contain no members and thus be of little use)\n\nAn external user is by the documentation described as a way to let external contractors get access to limited parts of a GitLab instance [link](https://docs.gitlab.com/ee/user/permissions.html#external-users). Stating that\n```\nThis feature may be useful when for example a contractor is working on a given project and should only have access to that project.\n```\nThere are no warnings about giving an external user maintainer permissions. It is also possible for ANY internal user to elevate the external user to maintainer on any internal project created by that user. Thus, there is no need to ask an Admin for permission to do this. Thus, an external user (if not already granted maintainer on a project) only needs to convince one other user on the system to create a project and invite the external user as maintainer. \n\n\n### Steps to reproduce\n\n1. Create a user with \"external user\" activated\n2. Use any internal user to invite the \"external user\" as maintainer to a project\n3. Login as the \"external user\" and create a project token on the project, save the token\n4. Use the token to probe internal projects\n```\n curl --header \"Authorization: Bearer <TOKEN>\" \"https://gitlab.domain.com/api/v4/projects\"\n```\ncreate groups\n```\n curl -X POST --header \"Authorization: Bearer <TOKEN>\" \"https://gitlab.domain.com/api/v4/groups?name=newg&path=newgroup\"\n```\ncreate issues on internal projects\n```\ncurl -X POST --header \"Authorization: Bearer <TOKEN>\" \"https://gitlab.domain.com/api/v4/projects/21/issues?title=iWasHere\" \n```\naccess source code\n```\ncurl --header \"Authorization: Bearer <TOKEN>\" \"https://gitlab.domain.com/api/v4/projects/19/repository/blobs/83d9398518bdf1519b7b8fbbb3fa3e305a8554ef/raw\"\n```\n\n### Impact\n\nAn external user can access all internal projects. Thus leading to severe information disclosure and ability to interact by issues. \n\n### What is the current *bug* behavior?\n\nAn external user with maintainer privileges to a project can create a project token which is connected to a Bot with internal access.\n\n### What is the expected *correct* behavior?\n\nThe bot should not have internal access to the GitLab instance. It is stated that\n```\nProject access tokens are scoped to a project and can be used to authenticate with the GitLab API.\n```\n[link](https://docs.gitlab.com/ee/user/project/settings/project_access_tokens.html)\nWhich makes it seam like the token does not have any permissions outside the project.\nThe bot should probably have \"external privilege\" as standard. At least an external user should not be able to use the bot to access internal projects.\n\n#### Results of GitLab environment info\n\n```\nSystem information\nSystem:\t\t\nCurrent User:\tgitlab\nUsing RVM:\tno\nRuby Version:\t3.0.1p64\nGem Version:\t/usr/lib/ruby/2.7.0/bundler/spec_set.rb:86:in `block in materialize': Could not find rake-13.0.3 in any of the sources (Bundler::GemNotFound)\n\tfrom /usr/lib/ruby/2.7.0/bundler/spec_set.rb:80:in `map!'\n\tfrom /usr/lib/ruby/2.7.0/bundler/spec_set.rb:80:in `materialize'\n\tfrom /usr/lib/ruby/2.7.0/bundler/definition.rb:170:in `specs'\n\tfrom /usr/lib/ruby/2.7.0/bundler/definition.rb:237:in `specs_for'\n\tfrom /usr/lib/ruby/2.7.0/bundler/definition.rb:226:in `requested_specs'\n\tfrom /usr/lib/ruby/2.7.0/bundler/runtime.rb:101:in `block in definition_method'\n\tfrom /usr/lib/ruby/2.7.0/bundler/runtime.rb:20:in `setup'\n\tfrom /usr/lib/ruby/2.7.0/bundler.rb:149:in `setup'\n\tfrom /usr/lib/ruby/2.7.0/bundler/setup.rb:20:in `block in <top (required)>'\n\tfrom /usr/lib/ruby/2.7.0/bundler/ui/shell.rb:136:in `with_level'\n\tfrom /usr/lib/ruby/2.7.0/bundler/ui/shell.rb:88:in `silence'\n\tfrom /usr/lib/ruby/2.7.0/bundler/setup.rb:20:in `<top (required)>'\n\tfrom <internal:/usr/lib/ruby/3.0.0/rubygems/core_ext/kernel_require.rb>:85:in `require'\n\tfrom <internal:/usr/lib/ruby/3.0.0/rubygems/core_ext/kernel_require.rb>:85:in `require'\nBundler Version:unknown\nRake Version:\t13.0.3\nRedis Version:\t6.2.3\nGit Version:\t2.31.1\nSidekiq Version:5.2.9\nGo Version:\tgo1.16.4 linux/amd64\n\nGitLab information\nVersion:\t13.10.4\nRevision:\te11cc45d59e\nDirectory:\t/usr/share/webapps/gitlab\nDB Adapter:\tPostgreSQL\nDB Version:\t13.2\nURL:\t\thttp://gitlab.joaxcar.com\nHTTP Clone URL:\thttp://gitlab.joaxcar.com/some-group/some-project.git\nSSH Clone URL:\tgitlab@gitlab.joaxcar.com:some-group/some-project.git\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers: \n\nGitLab Shell\nVersion:\t13.17.0\nRepository storage paths:\n- default: \t/var/lib/gitlab/repositories\nGitLab Shell path:\t\t/usr/share/webapps/gitlab-shell\nGit:\t\t/usr/bin/git\n```\n\n## Impact\n\nAn external user can access all internal projects. Thus leading to severe information disclosure and ability to interact by issues. \n\nThe user can now\n* Accessing all information about internal projects as if having Guest permissions (including source code)\n* Creating issues on internal projects\n* Creating projects and groups (these will contain no members and thus be of little use)",
  "bounty_amount": "1020.0",
  "formatted_bounty": "$1,020",
  "weakness": {
    "id": 75,
    "name": "Privilege Escalation"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 60,
  "voters": [
    "joaxcar",
    "joanbono",
    "shafou",
    "run_win",
    "ali",
    "address_below0",
    "sudi",
    "akashhamal0x01",
    "pacmanx",
    "kmxx",
    "and 50 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 5.5,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "high",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "high",
      "integrity": "low",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 39022,
    "asset_type": "OTHER",
    "asset_identifier": "Your Own GitLab Instance",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
