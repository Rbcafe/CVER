{
  "id": 1081137,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDgxMTM3",
  "url": "https://hackerone.com/reports/1081137",
  "title": "Incorrect Authorization Checks in /include/findusers.php",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2021-01-19T01:59:23.069Z",
  "submitted_at": "2021-01-19T01:59:23.180Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "egix",
    "url": "/egix",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/001/431/9435ac0bb25492f164582fbbc7e3f6f8f016b1d1_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 38302,
    "url": "https://hackerone.com/impresscms",
    "handle": "impresscms",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/038/302/c9f69b5546e2b4211c0a26681a398b1685cc5ebb_original./d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/038/302/c9f69b5546e2b4211c0a26681a398b1685cc5ebb_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "paused",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": false,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "ImpressCMS",
      "twitter_handle": "impresscms",
      "website": "https://www.impresscms.org",
      "about": "PHP and MySQL content management system"
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2022-03-22T22:57:15.604Z",
  "bug_reporter_agreed_on_going_public_at": "2022-02-20T22:57:03.997Z",
  "team_member_agreed_on_going_public_at": null,
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\nThe vulnerability is located in the `/include/findusers.php` script:\n\n```\n16.\tinclude \"../mainfile.php\";\n17.\txoops_header(false);\n18.\t\n19.\t$denied = true;\n20.\tif (!empty($_REQUEST['token'])) {\n21.\t\tif (icms::$security->validateToken($_REQUEST['token'], false)) {\n22.\t\t\t$denied = false;\n23.\t\t}\n24.\t} elseif (is_object(icms::$user) && icms::$user->isAdmin()) {\n25.\t\t$denied = false;\n26.\t}\n27.\tif ($denied) {\n28.\t\ticms_core_Message::error(_NOPERM);\n29.\t\texit();\n30.\t}\n```\n\nAs far as I can see, I believe this script should be accessible by admin users only (due to line 24). However, because of the if statements at lines 20-23, this script could be accessed by unauthenticated attackers if they will provide a valid security token. Such a token will be generated in several places within the application (just search for the string `icms::$security->getTokenHTML()`), and some of them do not require the user to be authenticated, like in `misc.php` at [line 181](https://github.com/ImpressCMS/impresscms/blob/48af29c6b8150fbf4220bb5cc4f3c57bcd818384/misc.php#L181).\n\n\n\n## ImpressCMS branch :\nThe vulnerability has been tested and confirmed on ImpressCMS version 1.4.2 (the latest at the time of writing).\n\n## Steps To Reproduce:\n  1. Try to access the `/include/findusers.php` script without being logged into the application\n  1. You will see an error message saying **\"Sorry, you don't have permission to access this area.\"**\n  1. Go to `/misc.php?action=showpopups&type=friend` and look at the HTML source code, search the string `XOOPS_TOKEN_REQUEST` and copy the value of the token\n  1. Go to `/include/findusers.php?token=[TOKEN_VALUE]` and you will be able to access the script and e.g. search through the registered users\n\n## Impact\n\nThis vulnerability might allow unauthenticated attackers to access an otherwise restricted functionality of the application, which in turn might allow an information disclosure about the CMS users (specifically, only the username and real name will be disclosed).",
  "weakness": {
    "id": 128,
    "name": "Incorrect Authorization"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2022-03-22T22:57:04.052Z",
  "allow_singular_disclosure_after": -59843202.465288095,
  "singular_disclosure_allowed": true,
  "vote_count": 3,
  "voters": [
    "rook1337",
    "run_win",
    "shivammusic"
  ],
  "severity": {
    "rating": "medium",
    "score": 5.3,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "low",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 28943,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/impresscms/impresscms",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
