{
  "id": 1595299,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTk1Mjk5",
  "url": "https://hackerone.com/reports/1595299",
  "title": "Read beyond bounds via ap_rwrite() [zhbug_httpd_47.2]",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2022-06-08T23:34:50.753Z",
  "submitted_at": "2022-06-08T23:34:50.838Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "tdp3kel9g",
    "url": "/tdp3kel9g",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQQQSQTJWE%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142653Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICMbzzKBCraFobXOcCqfodxzM%2F89seEFEtkolz9ym8yYAiEA%2Fsvto%2F251HQZfvVraGJNSEE9N05zP%2BaGv%2FBSxh9MwpMqsgUIdxADGgwwMTM2MTkyNzQ4NDkiDLRiPgXnAALYKAeN%2BSqPBWHgzJxP51a7MbYBgyoxP1LDcsLwdgUbUtgcBcVihNzgjkpkX1z4v6%2FjmlETXMHpM%2FauQHP0xGmCQhKLjGzIinKmY6tZ4kZl141nt3bExoUI5fWVsWEB7O84QdqCtoGtUZA0f1O7EIdYBJQb%2FmNKqwZEWaU%2F7PgkRk0H3XNrhegcIQuivj4XNypNwJPOxdtitDeFDYLpO12smqVJ5amk5ztkBZAoq8E%2Fxhaobm%2BP%2BcLxlPXFMWF2mULZXnUB%2BQexzDE%2FeLT2%2F%2FCafZViAqQkXNNhRc1onMPfkORBF3TWhoGrNIEBTcxPrms3Wk4KLaYQfHMpRmDn8NdWo6rpTdWGmrWp15yhtPtvFe8ReFe1qwFRwBcnvbxbIpos0u911N8KZcdmsYZha%2FoJ5gCaJUsYWiujZHGn6f5ac2aDT02iO7y%2FvFGh%2BiiCuJnTr%2FTPbUjsuYpUKRWvX0lbNazDhrREV3P7R16HgWupyfQVvDMUxflgXVEIBtoH%2F3PlfIvSwDTjDdb04Ji5mlT6sdPmo0lfcQgYurG6SnsI6MgswsJjYI2WOlv2p1tmsRt%2ByFO3bcNXUIH7i5sX1gS7pDgOE42otZhfgnqjvs281xt%2FxdyiAtfzcabnG58C%2F6LMJcKeiNXLZWzeSL%2FsIKZbRGv7%2BbTcyt4NUuw0Q8qvXsuEQa6pysO9CNZrAUmcPtXKlyDUNPvymrupyNL%2BTMEhXfQtQ9GR77FBbp2W1g6N%2BZC4U3Pyjd%2B5zay1bpkCArA0SfRd1XoibXzi71Y30tA%2FNUr4Rib62%2FqhPMoV5VVGpkLtyTBkmmVyf%2FESSQWdUjQsHkdlrlefv2cMA97YY4fWehghMcS0o3sWAL6LKEbcYmXkUd9uubUwzuGtrgY6sQGqVPKMUtXZrBKkrmums9UdPoAQiHM9bDEAcx6q6dTbsaND9EZI1kiWjVkhOtlNqyZzZiln%2BiwOaBZiB%2FQiRz7jN%2F4j0Xau5GsUBxICzxeYF6QfWg9kdjLfouuoymOG0OykNz%2FXKrjHdQ4BrNO6%2BP5iYizFhSP9s5uBbIRfMqyUWVBdXawoABdBVubTk5tCNVNh%2FWifWwE4VS1yIJoLSgY8wRQ3gW0tXMWlxD895PitKQQ%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=b767487767bec08d6d0d3ef0eff11fb32057b17a2555b558de68078cd1ed49f0",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQQQSQTJWE%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142653Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICMbzzKBCraFobXOcCqfodxzM%2F89seEFEtkolz9ym8yYAiEA%2Fsvto%2F251HQZfvVraGJNSEE9N05zP%2BaGv%2FBSxh9MwpMqsgUIdxADGgwwMTM2MTkyNzQ4NDkiDLRiPgXnAALYKAeN%2BSqPBWHgzJxP51a7MbYBgyoxP1LDcsLwdgUbUtgcBcVihNzgjkpkX1z4v6%2FjmlETXMHpM%2FauQHP0xGmCQhKLjGzIinKmY6tZ4kZl141nt3bExoUI5fWVsWEB7O84QdqCtoGtUZA0f1O7EIdYBJQb%2FmNKqwZEWaU%2F7PgkRk0H3XNrhegcIQuivj4XNypNwJPOxdtitDeFDYLpO12smqVJ5amk5ztkBZAoq8E%2Fxhaobm%2BP%2BcLxlPXFMWF2mULZXnUB%2BQexzDE%2FeLT2%2F%2FCafZViAqQkXNNhRc1onMPfkORBF3TWhoGrNIEBTcxPrms3Wk4KLaYQfHMpRmDn8NdWo6rpTdWGmrWp15yhtPtvFe8ReFe1qwFRwBcnvbxbIpos0u911N8KZcdmsYZha%2FoJ5gCaJUsYWiujZHGn6f5ac2aDT02iO7y%2FvFGh%2BiiCuJnTr%2FTPbUjsuYpUKRWvX0lbNazDhrREV3P7R16HgWupyfQVvDMUxflgXVEIBtoH%2F3PlfIvSwDTjDdb04Ji5mlT6sdPmo0lfcQgYurG6SnsI6MgswsJjYI2WOlv2p1tmsRt%2ByFO3bcNXUIH7i5sX1gS7pDgOE42otZhfgnqjvs281xt%2FxdyiAtfzcabnG58C%2F6LMJcKeiNXLZWzeSL%2FsIKZbRGv7%2BbTcyt4NUuw0Q8qvXsuEQa6pysO9CNZrAUmcPtXKlyDUNPvymrupyNL%2BTMEhXfQtQ9GR77FBbp2W1g6N%2BZC4U3Pyjd%2B5zay1bpkCArA0SfRd1XoibXzi71Y30tA%2FNUr4Rib62%2FqhPMoV5VVGpkLtyTBkmmVyf%2FESSQWdUjQsHkdlrlefv2cMA97YY4fWehghMcS0o3sWAL6LKEbcYmXkUd9uubUwzuGtrgY6sQGqVPKMUtXZrBKkrmums9UdPoAQiHM9bDEAcx6q6dTbsaND9EZI1kiWjVkhOtlNqyZzZiln%2BiwOaBZiB%2FQiRz7jN%2F4j0Xau5GsUBxICzxeYF6QfWg9kdjLfouuoymOG0OykNz%2FXKrjHdQ4BrNO6%2BP5iYizFhSP9s5uBbIRfMqyUWVBdXawoABdBVubTk5tCNVNh%2FWifWwE4VS1yIJoLSgY8wRQ3gW0tXMWlxD895PitKQQ%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=17f10a54fcc5a44e1595284c2f78e03f32ec7a763d00d8c2c9e9f7b3d6bf6d39"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2022-28614"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2022-07-09T13:54:56.102Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2022-06-09T13:54:47.019Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Greetings. I have found that ap_rwrite() (/server/protocol.c) can cause a read beyond bounds with the extra data sent to an attacker.\n\nThe bug is that ap_rwrite() passes its |int nbyte| argument to buffer_output(), where buffer_output()'s corresponding |len| argument isa |apr_size_t|. Thus, a negative |nbyte| value gets sign-extended into a gigantic |len|, causing the creation of a gigantic bucket (`0xffffffffnnnnnnnn bytes`) pointing to a buffer whose actual length is `0xnnnnnnnn`, causing a large read beyond bounds and thus a leak of heap information to an attacker.\n\nThe bug is still present in trunk.\n\nAttached is a POC that demonstrates the vulnerability. Use it thusly:\n\n   1. Copy bug47.2.lua into /bug47.2/bug47.2.lua .\n   2. Enable LUA.\n\n   3. Copy httpd_lines.txt from this report into httpd.conf (this adds a DATA filter to the output filter chain so that httpd sends data in small chunks).\n\n   4. Run httpd and attach a debugger to it.\n   5. Set a BP on ap_rwrite().\n   6. Go on to step 7.\n   7. Create a file `0x80000000` bytes long filled with 'a' characters, named /<somepath>/bug47.2.bin .\n   8. Run the command\n\n      `curl -v -i -o <somepath>/response.txt -X POST -k -T /<somepath>/bug47.2.bin http://127.0.0.1/bug47.2/bug47.2.lua`\n\n   which POSTs the file to httpd.\n\n    9. When the ap_rwrite() BP fires, notice that |int nbyte| == `0x80000000`. Also note the address of the end of the buffer |buf + 0x80000000|.\n\n    10. Trace into buffer_output(). Notice how |len| == `0xffffffff80000000`. Trace into ap_fwrite() and notice how it creates a transient bucket with this length.\n\n    11. Set a BP on data_out_filter() (modules/filters/mod_data.c) on the loop that repeatedly reads <= `6000` bytes of data to be turned into data: URLs.\n\n    12. Proceed. When the BP fires, examine data_out_filter()'s normal behavior.\n\n    13. Disable the BP and proceed. Wait until the debugger pops up an read-beyond-bounds exception, most likely in apr_base64_encode_binary() (apr-util/encoding/apr_base64.c). Examine |string| (the beginning of the buffer that apr_base64_encode_binary() is reading from), and notice that it's already beyond the end of the buffer that you calculated in step 9, showing that some previous iteration of data_out_filter()'s loop sent beyond-bounds data to the attacking host.\n\n    14. If curl hasn't exited by itself, hit ctrl/c.\n\n    15. Examine the beginning of <somepath>/response.txt and notice how its response payload section contains the repeating pattern (\"YWFh\"), which is the base64 encoding of 'aaa' (which is what you filled bug47.2.bin with).\n\n    16. Examine the end of <somepath>/response.txt and notice how it containsa block of something other than \"YWFh\", indicating that httpd sent back something other than the base64-encoded value of repeating 'a's. What gets sent back depends on the arrangement of the heap, which depends upon your httpd build (mine is debug), platform, timing, and server loading.\n```\n-------- bug47.2.lua ----------------------------------------------------\nfunction handle(r)\n    local s = r:requestbody()\n    r:puts(s)\nend\n-------- bug47.2.lua ----------------------------------------------------\n```\n```\n-------- httpd_lines.txt ----------------------------------------------------\n<Location /bug47.2>\n   SetOutputFilter DATA\n</Location>\n-------- httpd_lines.txt ----------------------------------------------------\n```\n\n## Impact\n\nThe attacker could exfiltrate data from the victim site's heap. In mitigation, the victim site must run a suitable LUA program (the POC just reads data from the attacker and echoes it back to her, but a more-realistic program would transform the data in some way).\n\nUse of this attack is likely to cause an access violation and consequent crash, which is useful for a DoS attack.",
  "weakness": {
    "id": 18,
    "name": "Information Disclosure"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2022-07-09T13:54:47.137Z",
  "allow_singular_disclosure_after": -50459526.56805295,
  "singular_disclosure_allowed": true,
  "vote_count": 8,
  "voters": [
    "zy9ard3",
    "mjustu",
    "shivammusic",
    "0xshawky",
    "austindkong",
    "aasim690",
    "0xs",
    "jackflash1337"
  ],
  "severity": {
    "rating": "low",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 86382,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/apache/httpd",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 160233,
      "category": "team",
      "content": "low: read beyond bounds via ap_rwrite() (CVE-2022-28614)\n\nThe ap_rwrite() function in Apache HTTP Server 2.4.53 and earlier may read unintended memory if an attacker can cause the server to reflect very large input using ap_rwrite() or ap_rputs(), such as with mod_luas r:puts() function.\n\nAcknowledgements: The Apache HTTP Server project would like to thank Ronald Crane (Zippenhop LLC) for reporting this issue\n\nUpdate 2.4.54 released\t2022-06-08\nAffects\t<=2.4.53\n\nSecurity Advisory: https://httpd.apache.org/security/vulnerabilities_24.html",
      "user": {
        "id": 904892,
        "username": "kunderkoffler",
        "name": "Kayla Underkoffler",
        "bio": null,
        "cleared": false,
        "verified": false,
        "website": null,
        "location": null,
        "created_at": "2020-01-13T19:26:22.339Z",
        "url": "https://hackerone.com/kunderkoffler",
        "hackerone_triager": false,
        "hackerone_employee": true,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png",
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png",
          "xtralarge": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
