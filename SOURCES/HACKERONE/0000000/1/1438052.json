{
  "id": 1438052,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDM4MDUy",
  "url": "https://hackerone.com/reports/1438052",
  "title": "Race condition in faucet when using starport",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "critical",
  "readable_substate": "Resolved",
  "created_at": "2021-12-30T08:45:02.135Z",
  "submitted_at": "2021-12-30T08:45:02.218Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "cyberboy",
    "url": "/cyberboy",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/pQbrCr2dJysJYTjJvvMUiMdr/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 24626,
    "url": "https://hackerone.com/cosmos",
    "handle": "cosmos",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/7ujgxbvj1f55tubc30ya013fjaws/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/7ujgxbvj1f55tubc30ya013fjaws/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Cosmos",
      "twitter_handle": "cosmos",
      "website": "https://cosmos.network",
      "about": "The Internet of Blockchains."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": true,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2022-07-26T17:47:40.549Z",
  "bug_reporter_agreed_on_going_public_at": "2022-07-26T15:59:55.753Z",
  "team_member_agreed_on_going_public_at": "2022-07-26T17:47:40.425Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hi team, \nI and Aditya sent this bug over email on Wed, 29 Dec, 17:45 IST. Later we noticed that security reports are accepted via the HackerOne program. So, I am sending a copy of the bug report here. \n\n## Summary:\nWe were testing an application and we found a race condition bug in the faucet Implementation of Starport. \nhttps://github.com/tendermint/starport\n\n## Steps To Reproduce:\n1. Start a starport with the below configuration. Note the \"coins_max\" has been set to 11 tokens and hence a user cannot fetch more after the 11 token limits.\n\n```\naccounts:\n  - name: alice\n    coins: [\"0token\", \"200000000stake\"]\n  - name: bob\n    coins: [\"500token\", \"100000000stake\"]\nvalidator:\n  name: alice\n  staked: \"100000000stake\"\nclient:\n  openapi:\n    path: \"docs/static/openapi.yml\"\n  vuex:\n    path: \"vue/src/store\"\nfaucet:\n  name: bob\n  coins: [\"5token\", \"100000stake\"]  \n  coins_max: [\"11token\", \"100000stake\"]\n```\n\n2. Now call the request manually  with 5 tokens per request as in our configuration after 2 requests and 10 tokens in total Alice won't be able to fetch more tokens from the faucet\n\n```\nPOST / HTTP/1.1\nHost: 172.105.41.242:4500\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:95.0) Gecko/20100101 Firefox/95.0\nAccept: application/json\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nReferer: http://172.105.41.242:4500/\nContent-Type: application/json\nOrigin: http://172.105.41.242:4500\nContent-Length: 63\nConnection: close\n{\n  \"address\": \"ALICE_ADDRESS\"}\n\n```\n\nNow we can confirm Alice cannot have more than 11 tokens. \n\n3.  Now regenerate the server and instead of sending a single request send a concurrent request to fetch tokens in Alice address.  We used 50 requests concurrently.\n\n{F1563051}\n\n4. Now when we check Alice balance it is 30 which should have not been more than 11\n\n{F1563052}\n\nWe believe the root cause of the issues is the go mapping which is not advised for concurrency \nhttps://github.com/tendermint/starport/blob/develop/starport/pkg/cosmosfaucet/transfer.go#L59\n\n## Supporting Material/References:\nhttps://cwe.mitre.org/data/definitions/362.html\n\n## Impact\n\nA malicious user can send concurrent requests to fetch more tokes from faucets than the \"max-credit limit\" which allows.",
  "bounty_amount": "5000.0",
  "formatted_bounty": "$5,000",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 1563051,
      "file_name": "Screenshot_2021-12-29_at_5.41.56_PM.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/4pj9n1y11kneguz4cmnqimw1ledd?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2021-12-29_at_5.41.56_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2021-12-29_at_5.41.56_PM.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQXDXMWQX4%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142116Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBXiIatSvXxAR8ZBwoq9n9qamV3%2Beh4VxZ3KYO4Dx8ipAiBhqaPFcz1fCY4UiwnoQpCKbjkuyniJ5UnHxhrd1V7sPCqxBQh2EAMaDDAxMzYxOTI3NDg0OSIMI7x1nUgRkEN0qOmcKo4FXYYyeBqpZepmBlG%2Bn8RIW4ybBvBDLTs5NzQS7p452M4cH8%2FOy1nnGTSEGOnFuQ1hr8I838Py4bbR2k0%2FeAXwEKBwp9kUx1f6xHqwuZ%2BZJE6IBIkxerlv%2FE3eoTBjleGGo2wwfiOgBypgZ5sXatzcXx72vmVtwhxsDHzFmuJonyOALDBbiuqGbIPREpmA3jUxq%2BMAacTvuf9XMxNE478SaHCKprf1SFobf84oc7fT%2FWNU4UeJ8GNMQeSenAKYY%2BrLefa1UY4wwj6g5D0GjwCVp9bHXI21rt%2BOchx%2BJy%2Ff8hhrWt2fFEziDHK2ejHlzmon20KSav3Ecka%2Fl7q%2FXbFq%2B5cHQ3Fnv6Hsuz%2BtzfIL4EI8nN4PTXJ959QXCgSq68M3r%2FCq038IGGPaf9q5IZ44XiRhpk9WyrUqaUvKDpIG2kZMpC6jLDCikWY%2F0pq0aLMVs8K3zMuHvUvoA%2B2gV%2Bcm6EdoBU1pM0KqEZ4gTsmJdr8mPFqfdK1P4IwECSvHVNNvRZ%2FytigAMyryjJi%2FzrEs38Y9%2FrEkIQq4jS7aMXa2dJvo8qo%2BMpwzgI63Zc9%2BUb7QMMj32n1iEhgvRp0P4HsvjBZW5a45NrCNrdPawRXUjURzopS4c1KkPmoIyqVJLA%2FcZfSuGhSIBnYcB3irx3ar6nXnb1BlJQeYwVq%2BGugPDwYF7JnE98PVLlThTxxkQLe6rmhG98KDMqkM2rSCOaoIoCAr8pyrGNylV531TI6WsbwObHBBin8dGaMs5bPKof2pfOiufJXYwPbUfatl0yR4eeNEDZ2ojVwsNt%2FXz0I%2BnOHi3gFnlaTXXL2pE75y8B8i2gdpWyljLCB%2Bnh8JAX4zJ9W5uSJwboRkdOBCbm1EMOnJra4GOrIBAGTU0E8gZ3I1JcYpghGRH630deXcWBT7WyMmozUTe6qarc28Ss1LWSuryHkoMrH7Sud0DqGFERBVj7YzRXPoLL7BGEhCuNa2uCE2kvLJYBOVb8O0U%2BA8CX4iNwz55KlL7rByi1vNt6ahpUI7DJZTOvkkTX1DSVfQF%2Baicg%2BfMtGKT4Z2J8HGmzqC%2FR%2FqkC6K2vyecQNgl1yG%2BNZWxHLH3sMFQGgXVbyipFgwNo8D0TTcrQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=f9a1bbb04eb927e96a942710d3b2523b63c5a77e9f8683232869b6ee1d9961d7",
      "file_size": 126005,
      "type": "image/png",
      "moderated": null
    },
    {
      "id": 1563052,
      "file_name": "Screenshot_2021-12-29_at_5.43.09_PM.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/elyc2hli46v65e31q84ew4vc2lfq?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2021-12-29_at_5.43.09_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2021-12-29_at_5.43.09_PM.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQXDXMWQX4%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T142116Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBXiIatSvXxAR8ZBwoq9n9qamV3%2Beh4VxZ3KYO4Dx8ipAiBhqaPFcz1fCY4UiwnoQpCKbjkuyniJ5UnHxhrd1V7sPCqxBQh2EAMaDDAxMzYxOTI3NDg0OSIMI7x1nUgRkEN0qOmcKo4FXYYyeBqpZepmBlG%2Bn8RIW4ybBvBDLTs5NzQS7p452M4cH8%2FOy1nnGTSEGOnFuQ1hr8I838Py4bbR2k0%2FeAXwEKBwp9kUx1f6xHqwuZ%2BZJE6IBIkxerlv%2FE3eoTBjleGGo2wwfiOgBypgZ5sXatzcXx72vmVtwhxsDHzFmuJonyOALDBbiuqGbIPREpmA3jUxq%2BMAacTvuf9XMxNE478SaHCKprf1SFobf84oc7fT%2FWNU4UeJ8GNMQeSenAKYY%2BrLefa1UY4wwj6g5D0GjwCVp9bHXI21rt%2BOchx%2BJy%2Ff8hhrWt2fFEziDHK2ejHlzmon20KSav3Ecka%2Fl7q%2FXbFq%2B5cHQ3Fnv6Hsuz%2BtzfIL4EI8nN4PTXJ959QXCgSq68M3r%2FCq038IGGPaf9q5IZ44XiRhpk9WyrUqaUvKDpIG2kZMpC6jLDCikWY%2F0pq0aLMVs8K3zMuHvUvoA%2B2gV%2Bcm6EdoBU1pM0KqEZ4gTsmJdr8mPFqfdK1P4IwECSvHVNNvRZ%2FytigAMyryjJi%2FzrEs38Y9%2FrEkIQq4jS7aMXa2dJvo8qo%2BMpwzgI63Zc9%2BUb7QMMj32n1iEhgvRp0P4HsvjBZW5a45NrCNrdPawRXUjURzopS4c1KkPmoIyqVJLA%2FcZfSuGhSIBnYcB3irx3ar6nXnb1BlJQeYwVq%2BGugPDwYF7JnE98PVLlThTxxkQLe6rmhG98KDMqkM2rSCOaoIoCAr8pyrGNylV531TI6WsbwObHBBin8dGaMs5bPKof2pfOiufJXYwPbUfatl0yR4eeNEDZ2ojVwsNt%2FXz0I%2BnOHi3gFnlaTXXL2pE75y8B8i2gdpWyljLCB%2Bnh8JAX4zJ9W5uSJwboRkdOBCbm1EMOnJra4GOrIBAGTU0E8gZ3I1JcYpghGRH630deXcWBT7WyMmozUTe6qarc28Ss1LWSuryHkoMrH7Sud0DqGFERBVj7YzRXPoLL7BGEhCuNa2uCE2kvLJYBOVb8O0U%2BA8CX4iNwz55KlL7rByi1vNt6ahpUI7DJZTOvkkTX1DSVfQF%2Baicg%2BfMtGKT4Z2J8HGmzqC%2FR%2FqkC6K2vyecQNgl1yG%2BNZWxHLH3sMFQGgXVbyipFgwNo8D0TTcrQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=ad18dd2a5dc233383360421efc0e87cef366405b408a6b051d629075bac7204a",
      "file_size": 81938,
      "type": "image/png",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2022-08-25T15:59:55.795Z",
  "allow_singular_disclosure_after": -46390880.49159572,
  "singular_disclosure_allowed": true,
  "vote_count": 50,
  "voters": [
    "arvindz7",
    "mksyi",
    "tikidude",
    "jumpydata",
    "shreyaschavhan",
    "n1m0",
    "drsniper",
    "zy9ard3",
    "thruster",
    "yassinek3ch",
    "and 40 more..."
  ],
  "severity": {
    "rating": "critical",
    "score": 9.3,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "high",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 7037,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/cometbft/cometbft",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "id": 179011,
      "category": "researcher",
      "content": "The proper writeup of the bug can be found here at our blogpost https://blog.credshields.com/race-condition-in-tendermints-starport-7cebe176d935\n\nThe root cause of the bug was in function “Transfer” at\nhttps://github.com/tendermint/starport/blob/7812125/starport/pkg/cosmosfaucet/transfer.go#L50-L74\nWe can notice in the code that each request to the faucet causes two actions to be made; one for querying the account’s balance and the other for sending tokens. When sending concurrent requests to the faucet, in the time of querying the balance, for some requests, this check happens at the same time and ends up seeing less balance in the account because sending the tokens action has not been finalized for the previous requests.",
      "user": {
        "id": 1006,
        "username": "cyberboy",
        "name": "Shashank",
        "bio": "I have 5 years of experience in penetration testing of diverse web, mobile application, desktop application frameworks. Now speciziled in Smart contract and blockchain security.  ",
        "cleared": true,
        "verified": true,
        "website": "https://blog.shashank.co",
        "location": "Banglore",
        "created_at": "2013-11-08T13:10:16.527Z",
        "url": "https://hackerone.com/cyberboy",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/pQbrCr2dJysJYTjJvvMUiMdr/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/pQbrCr2dJysJYTjJvvMUiMdr/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/pQbrCr2dJysJYTjJvvMUiMdr/114764ec8f01b1a3e153599212c9f011fb3b0bce3a4fdc1f9a3c551f8c94acf8"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    }
  ]
}
