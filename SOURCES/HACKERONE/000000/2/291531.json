{
  "id": 291531,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yOTE1MzE=",
  "url": "https://hackerone.com/reports/291531",
  "title": "Introspection query leaks sensitive graphql system information.",
  "state": "Closed",
  "substate": "duplicate",
  "readable_substate": "Duplicate",
  "created_at": "2017-11-18T16:58:42.150Z",
  "submitted_at": "2017-11-18T16:58:42.150Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "zuriel",
    "url": "/zuriel",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/217/627/50b5d3118d160c5d1d0728385de090f0567a6170_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 13,
    "url": "https://hackerone.com/security",
    "handle": "security",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "HackerOne",
      "twitter_handle": "Hacker0x01",
      "website": "https://hackerone.com",
      "about": "Vulnerability disclosure should be safe, transparent, and rewarding."
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2017-11-22T06:29:35.128Z",
  "bug_reporter_agreed_on_going_public_at": "2017-11-21T20:36:42.428Z",
  "team_member_agreed_on_going_public_at": "2017-11-22T06:29:33.786Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "**Summary:**\nInterospection query leaks sensitive data.\n\n**Introduction**\nAs we know graphql was initially developed and used by facebook as an **internal query language** and so the features of graphql mostly revolve around internal and development areas.\nGraphql executes queries using a type system with the data defined. An important but often ignored feature of graphql is the ability to ask graphql schema about the supported queries with the help of **Interospection Sytem**\n\n**Description (includes Impact and Steps to Reproduce)**\nAn interospection system can completely reveal the backend system defined by developers inluding arguments,fields,types,descriptions,deprecated status of types and so on. \nThis could easily give out the complete map of backend system along with the schema and directives. \n\nIn our case graphql is implemented as an [endpoint] (https://hackerone.com/graphql) to retrieve sensitive data like user information, payout preferences, program policies, team settings etc.\nRevealing the schema of the entire backend will serve as an attack ground for attackers in order to craft graphql queries that can retrieve fields that are normally not meant to be accessed by users.\nMoreover any changes made or to be brought about can be easily revealed through **description** fields of types.\n\nThe following graphql query is an **interospection query** that completely reveals the defined system with all required details ([Reference] (https://gist.github.com/craigbeck/b90915d49fda19d5b2b17ead14dcd6da)). \n\n`{\"query\": \"query IntrospectionQuery {__schema {queryType { name },mutationType { name },subscriptionType { name },types {...FullType},directives {name,description,args {...InputValue},onOperation,onFragment,onField}}}\\nfragment FullType on __Type {kind,name,description,fields(includeDeprecated: true) {name,description,args {...InputValue},type {...TypeRef},isDeprecated,deprecationReason},inputFields {...InputValue},interfaces {...TypeRef},enumValues(includeDeprecated: true) {name,description,isDeprecated,deprecationReason},possibleTypes {...TypeRef}}\\nfragment InputValue on __InputValue {name,description,type { ...TypeRef },defaultValue}\\nfragment TypeRef on __Type {kind,name,ofType {kind,name,ofType {kind,name,ofType {kind,name}}}}\"}`\n\nUpon looking into the response (ie the graphql system map returned), following things were observed:\n\n+ **Deprecated Nodes could still be queried at root level**\n\nThe interospection query response returned deprecated status of nodes like \"Report\",\"Team\" as \"true\":\n\neg.\n> \"isDeprecated\": true,\n  \"deprecationReason\": \"Query for a <Node Name> node at the root level is not recommended. Ref T12456\" \n\nBut it was seen that a graphql query could still be created with above nodes as root. \n\neg. Query with Node **Team** at root level:\n\n**Steps to Reproduce**\n\n`{\"query\": \"query {team(handle:\\\"security\\\"){id,_id,about,base_bounty,bug_count}}\"}`\n\nThis returned valid data even if it was supposed to be deprecated:\n\n> {\n\t\"data\": {\n\t\t\"team\": {\n\t\t\t\"id\": \"Z2lkOi8vaGFja2Vyb25lL1RlYW0vMTM=\",\n\t\t\t\"_id\": \"13\",\n\t\t\t\"about\": \"Vulnerability disclosure should be safe, transparent, and rewarding.\",\n\t\t\t\"base_bounty\": 500,\n\t\t\t\"bug_count\": 236\n\t\t}\n\t}\n}\n\nThis holds true for all nodes that shouldnt be allowed to query directly at root level: Report, Team, User.\n\n**Impact**\nNode queries not meant to be allowed at root level could still be executed and could potentially leak data not to be retrieved otherwise. \n\n\n+ **Additional Fields of Nodes can be disclosed**\n\nThe fields that are not retrieved normally could be retrieved due to knowledge of all fields on a type (or OBJECT). \n\neg. the fields sla_missed_count sla_failed-count for a team:\n\n**Steps to Reproduce** \n`{\"query\": \"query {team(handle:\\\"security\\\"){sla_failed_count,sla_missed_count}}\"}`\n\n> {\n\t\"data\": {\n\t\t\"team\": {\n\t\t\t\"sla_failed_count\": 0,\n\t\t\t\"sla_missed_count\": 0\n\t\t}\n\t}\n}\n\nThis was also possible due to \"team\" being allowed at root level.\n\n**Impact**\nDisclosure of additional fields on Nodes\n\n\n+ **Description field leaks future implementations**\n\n> \"deprecationReason\": \"This is about to be replaced by .genius_execution\" \n> \"deprecationReason\": \"Deprecated in favor of .original_report\" \n\nThese were returned as deprecationReason fields for genius_execution_id and original_report_id respectively. \n\n**Impact**\nMay leak future implementations\n\n\n**Possible fix**\nAs mentioned before, graphql was originally used as internal query language and so features like \"Interospection System\" was useful for development.\nBut When it is used as a method to query sensitive data, it becomes a threat. Interospection queries should be disabled.\n\n\nRegards,\nZuriel",
  "weakness": {
    "id": 57,
    "name": "Violation of Secure Design Principles"
  },
  "original_report_id": 230244,
  "original_report_url": "https://hackerone.com/reports/230244",
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 16,
  "voters": [
    "inhibitor181",
    "pacmanx",
    "eveeez",
    "sa1tama0",
    "hasskodark",
    "japz",
    "cryptographer",
    "rickshang",
    "0619",
    "vptechnolabs",
    "and 6 more..."
  ],
  "structured_scope": {
    "databaseId": 3,
    "asset_type": "URL",
    "asset_identifier": "hackerone.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
