{
  "id": 224096,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjQwOTY=",
  "url": "https://hackerone.com/reports/224096",
  "title": "ShopifyAPI is vulnerable to timing attacks.",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2017-04-26T16:31:49.207Z",
  "submitted_at": "2017-04-26T16:31:49.207Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "edoverflow",
    "url": "/edoverflow",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 1382,
    "url": "https://hackerone.com/shopify",
    "handle": "shopify",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Shopify",
      "twitter_handle": "",
      "website": "https://www.shopify.com",
      "about": "Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2017-06-23T15:36:23.392Z",
  "bug_reporter_agreed_on_going_public_at": "2017-06-23T15:30:37.677Z",
  "team_member_agreed_on_going_public_at": "2017-06-23T15:36:23.360Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Dear Shopify bug bounty team,\n\nThe [Python ShopifyAPI](https://github.com/Shopify/shopify_python_api) library is vulnerable to timing attacks, because the `validate_hmac()` falls back to a non-constant time comparison when `hmac.compare_digest()` is not available. I am perfectly aware that this issue is out of scope, but your Shopify Guru (Jack P.) kindly advised me to report this issue here.\n\n# Summary\n---\n\nTiming attacks are a type of side channel attack where one can discover valuable information by recording the time it takes for a cryptographic algorithm to execute.\n\nThe issue lies in `shopify/session.py`'s `validate_hmac()` function:\n\n~~~\n# Try to use compare_digest() to reduce vulnerability to timing attacks.\n# If it's not available, just fall back to regular string comparison.\ntry:\n    return hmac.compare_digest(hmac_calculated, hmac_to_verify)\nexcept AttributeError:\n    return hmac_calculated == hmac_to_verify\n~~~\n\nThe `==` operator does a byte-by-byte comparison of two values and as soon as the two differentiate it terminates. This means the longer it takes until the operation returns, the more correct characters the attacker has guessed. It is important to note that this issue really only affects users using Python versions prior to 2.7.7.\n\nLink to source code: https://github.com/Shopify/shopify_python_api/blob/master/shopify/session.py#L115-L120\n\n# PoC\n---\n\nHere is a quick and messy PoC to demonstrate the issue:\n\n~~~python\nimport time, hmac\n\n\ndef timing(f):\n    def wrap(*args):\n        time1 = time.time()\n        ret = f(*args)\n        time2 = time.time()\n        print '%s took %0.3f ms' % (f.func_name, (time2-time1)*1000.0)\n        return ret\n    return wrap\n\n@timing\ndef timing_attack_diff():\n    s1 = \"100000000000000000000000000000000\"\n    s2 = \"000000000000000000000000000000001\"\n    for i in range(200):\n        if not s1 == s2:\n            print i\n\n@timing\ndef timing_attack_same():\n    s1 = \"100000000000000000000000000000000\"\n    s2 = \"100000000000000000000000000000000\"\n    for i in range(200):\n        if s1 == s2:\n            print i\n\n@timing\ndef constant_time_diff():\n    s1 = b\"100000000000000000000000000000000\"\n    s2 = b\"000000000000000010000000000000000\"\n    for i in range(200):\n        if not hmac.compare_digest(s1, s2):\n            print i\n        \n@timing\ndef constant_time_same():\n    s1 = b\"100000000000000000000000000000000\"\n    s2 = b\"100000000000000000000000000000000\"\n    for i in range(200):\n        if hmac.compare_digest(s1, s2):\n            print i\n\ntiming_attack_diff()\ntiming_attack_same()\nconstant_time_diff()\nconstant_time_same()\n~~~\n\nThe results are quite significant:\n\n| Round   | timing_attack_diff | timing_attack_same | constant_time_diff | constant_time_same |\n|---------|---------------------------|---------------------------|---------------------------|---------------------------|\n| Round 1 | 2463 ms                   | 2365 ms                   | 2310 ms                   | 2329 ms                   |\n| Round 2 | 2219 ms                   | 2175 ms                   | 2156 ms                   | 2188 ms                   |\n\n# How can this be fixed?\n---\n\n~~~python\n# Try to use compare_digest() to reduce vulnerability to timing attacks.\ntry:\n    return hmac.compare_digest(hmac_calculated, hmac_to_verify)\nexcept AttributeError:\n    def fallback_constant_time(hmac_calculated, hmac_to_verify):\n    if len(hmac_calculated) != len(hmac_to_verify):\n        return False\n    \n    result = 0\n    for x, y in zip(hmac_calculated, hmac_to_verify):\n        result |= x ^ y\n    return result == 0\n~~~\n\nThis fallback does not terminate as soon as two bytes are not the same. I am willing to submit a PR to solve this issue, but I need your permission first.\n\n# Just one more little thing\n---\n\nThe \"Verify the request\" section over in the [docs](https://help.shopify.com/api/tutorials/building-public-app) is also vulnerable to timing attacks:\n\n~~~ruby\nif not (hmac == digest)\n    return [403, \"Authentication failed. Digest provided was: #{digest}\"]\nend\n~~~\n\nBest regards,\nEd",
  "weakness": {
    "id": 32,
    "name": "Cryptographic Issues - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 179737,
      "file_name": "shopify_timing_attack_poc.py",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/179/737/884207803eea164ebea174299ec87252d168f995/shopify_timing_attack_poc.py?response-content-disposition=attachment%3B%20filename%3D%22shopify_timing_attack_poc.py%22%3B%20filename%2A%3DUTF-8%27%27shopify_timing_attack_poc.py&response-content-type=text%2Fplain&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSJAEOSEA%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T124057Z&X-Amz-Expires=632&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIFGoM7UVkpoUFXOwmBO1YCW3cw%2F4NyxP2Yan%2BgrkBav8AiEAyCUaZteSGAOL1VybC9wE4FNtA9ZRB0rOhRCfRb1SJtUqsgUIcBADGgwwMTM2MTkyNzQ4NDkiDK4laJFhO348YrQkpSqPBT0JpdttzMzvj7d49wHxo6XKhZp6ShyKPYUpw0Uq4AHmWnLgN8g%2BsTPzAignfCeJBrRSLMJVkOL0W5ter7990DhqIASPNW1EZwrDyGA7kuePP%2BF4tcrX3LO0OOR6gGZx9EtA5T7iJB1DFapuW5N7q%2F51A5Mu7ZLK0NaZo8zhsohgiWzzyR2iluk%2FLl3XGm%2Fa6%2BcTwHua%2BNjD%2F97XLRv1zF3YE7sSdAY3bunMdQ6NaH%2BxtZj7FOWcsouUYmSWYMItq7rFc2QX6eLL04LoQhGF%2BsAlIJRuG9morj%2FzbUBeITu4Wjw1YqZoqh4stcI25Q3hf6RXlfWGW%2FpPgFVXTaKeiqdUSu86Hp0mtdhvWjZ%2F3frTMpqYRrp2a1mbGWETUc5Uf0mzI3H5oA%2B3GNQfu3cWaPp6Vj5kQ0fBwtej92wxqBKYcwQGX1OqkYgzXEkCCIsQfZxhAaPTN%2FtgMRJ58JVzNuHtKdPerJm1tZ8fQ6tljGtPSMxjFhDzyA9m9NHez5izRf7KqXOVO9vYJFw%2Fi00wL4IHCuGJag8I%2Fxka6p1qKR%2BLgjmHhEme4qKwVcZHLFn9ks9Opq5yjYs0%2BDnJLzW8EoTTImazBY6PuaPKcKQY8cuOfRLUWHjfDoiEvtTVUk8hNiRL7PEmq8TnurN%2BlvDbNHfB1bc7T4OkQ0bkDfDKxp%2Bw6kMpFfLzp3zMh4sVkCicAf8phxPfZ3ImBweoHetjdWVM%2FAaqoQFfIvSuNFRLjBRBvd1PbhmnN5Jq5WNPDsGhoXmnlt9dIMyM30uqRrm5JWVLqPt5x3tJ%2F6XEKfiDRzBMK4wT7DJ94Iud7aggpV%2BQl9JVRf86hwRXR9rFbvmmDTUka9kitEZLd%2FlL7mfvrF8wlKGsrgY6sQG6xY6iPHcuzMUPYlF%2BiPLSQhv%2F6pGqgLnKtUql08pwI3ttBcBcKWvZH4WOc5lXL1qEfHHkJQ1HwYwKvH5vG3URLBINtmvkDZGhy%2F605sBLv1QwPSjd91a2Orn1TKno6iqHfQCQTcPrP0NyRztLXpdgkxXv3JyY%2FNXpBhGdrABNb%2BwkB78q7U4iWLt6tducslFnRZ4D7lUbbNW%2FhxyDCkCcwec2EWKyZiZLijLaLBQG2P4%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=f28ede599d25bca49e094be22517faa4b46a794a4cac4b4be08bc21f1ca8fc3d",
      "file_size": 1194,
      "type": "text/plain",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": null,
  "vote_count": 9,
  "voters": [
    "drsniper",
    "christophetd",
    "muhammad_uwais",
    "r3y",
    "eveeez",
    "b3nac",
    "exadmin",
    "hacklad",
    "0xm1racle"
  ],
  "severity": {
    "rating": "low",
    "score": 3.7,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "high",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "low",
      "availability": "none"
    }
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
