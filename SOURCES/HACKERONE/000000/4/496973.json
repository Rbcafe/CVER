{
  "id": 496973,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80OTY5NzM=",
  "url": "https://hackerone.com/reports/496973",
  "title": "Persistent XSS via e-mail when creating merge requests",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2019-02-16T07:34:25.515Z",
  "submitted_at": "2019-02-16T07:34:25.515Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "mario-areias",
    "url": "/mario-areias",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 264,
    "url": "https://hackerone.com/gitlab",
    "handle": "gitlab",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "GitLab",
      "twitter_handle": "gitlab",
      "website": "https://about.gitlab.com",
      "about": "A single application for the entire software development lifecycle."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2019-5471"
  ],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2019-08-30T23:27:28.304Z",
  "bug_reporter_agreed_on_going_public_at": "2019-08-30T23:27:28.205Z",
  "team_member_agreed_on_going_public_at": "2019-08-30T22:57:26.646Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "**Summary:**\nThe vulnerability consists in the ability to create branch names that contain characters such as `<>/`. This branch name is sent via e-mail which is rendered as HTML.\n\n**Description:**\nOne way to exploit this is by forking a repository. Then an attacker would create a branch called `<script>alert(1)</script>` and make a simple change. Now the attacker creates a merge request to the original repository and assign a reviewer to it. The reviewer will receive the e-mail with the branch name not sanitised. \n\nAnother way to exploit is to by adding Gitlab users to a repository the attacker controls and assign them to review merge requests.\n\n## Steps To Reproduce:\n\nNote: These instructions work on GDK with the latest version. I wasn't sure if it is allowed to test something like on gitlab.com\n\n  1.  Choose a public repository and fork it (let's say HTML5 boilerplate)\n  2. Go through the repository main page http://yourserver:3000/root/html5-boilerplate\n  3. Click on the button + button and select New File\n  4. Create any file but choose a different target branch (something like <script>alert(1)</script>\n  5. Gitlab will direct you to a page to create a new merge request from your recently create branch to master. Ignore that.\n  6. Open a New Merge Request\n  7. Select Source Branch as your fork and the recently created branch\n  8. As for Target branch select the original repo and master\n  9. Click submit\n10. Select one the maintainers of the original repo \n11. Submit\n12. Go to letter opener (/rails/letter_opener/)\n13. See the alert popping up.\n\nThe steps above only require UI, but an attacker can create a branch name through git client as well. The create branch option UI protects against this attack.\n\nThere is also another version of the attack, where a repository owner can add any Gitlab users to become members of her repo. The attacker now create a Merge Request in his own repo and assign the new member to it. Same result. \n\n## Supporting Material/References:\n\n* Vulnerable code at `gitlab-ce/app/views/notify/new_merge_request_email.html.haml` line 6. This is the exploit above.\n* Vulnerable code at `gitlab-ce/app/views/notify/repository_push_email.text.haml` line 49. I haven't created an exploit for this one, but I would assume it should be similar.\n\n## Impact\n\nE-mail clients nowadays are well protected against XSS. However, a malicious user could use Gitlab's name to mislead users. The problem with this vulnerability is the reach. It is my understanding, an attacker can add whoever is a Gitlab user as a member of her own repo. So she could send malicious e-mails to them. I would usually say that is a low vulnerability, however, given the number of users that could be affected I would say is a medium",
  "weakness": {
    "id": 60,
    "name": "Cross-site Scripting (XSS) - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 24,
  "voters": [
    "securitychops",
    "ali",
    "mik317",
    "theappsec",
    "tulswani",
    "dhakal_bibek",
    "0-1",
    "lumbridge",
    "m7mdharoun",
    "cr4xerbik4sh",
    "and 14 more..."
  ],
  "severity": {
    "rating": "low",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 18138,
    "asset_type": "URL",
    "asset_identifier": "gitlab.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
