{
  "id": 872089,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NzIwODk=",
  "url": "https://hackerone.com/reports/872089",
  "title": "Curl_auth_create_plain_message integer overflow leads to heap buffer overflow",
  "state": "Closed",
  "substate": "informative",
  "severity_rating": "low",
  "readable_substate": "Informative",
  "created_at": "2020-05-12T16:26:28.342Z",
  "submitted_at": "2020-05-12T16:26:28.342Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "major_tom",
    "url": "/major_tom",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 35663,
    "url": "https://hackerone.com/curl",
    "handle": "curl",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "curl",
      "twitter_handle": "",
      "website": "https://curl.se",
      "about": "cURL is an Open Source project providing a library and command-line tool for doing internet transfers"
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2018-16839"
  ],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2021-01-08T10:27:32.095Z",
  "bug_reporter_agreed_on_going_public_at": "2021-01-08T10:27:32.044Z",
  "team_member_agreed_on_going_public_at": "2021-01-08T08:19:45.936Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\n\nThere is an incorrect integer overflow check in `Curl_auth_create_plain_message` in `lib/vauth/cleartext.c` , leading to a potential heap buffer overflow of controlled length and data. The exploitation seems quite easy, yet the vulnerability can only be triggered locally and does not seem to lead to RCE.\n\nThis vulnerability is very similar to [CVE-2018-16839](https://curl.haxx.se/docs/CVE-2018-16839.html) but was introduced later in [this commit](https://github.com/curl/curl/commit/762a292f8783d73501b7d7c93949268dbb2e61b7)\n\n## Vulnerability:\n\n```C\n  zlen = (authzid == NULL ? 0 : strlen(authzid));\n  clen = strlen(authcid);\n  plen = strlen(passwd);\n\n  /* Compute binary message length. Check for overflows. */\n  if(((zlen + clen) > SIZE_T_MAX/4) || (plen > (SIZE_T_MAX/2 - 2))) (1)\n    return CURLE_OUT_OF_MEMORY;\n  plainlen = zlen + clen + plen + 2; (2)\n\n  plainauth = malloc(plainlen); (3)\n  if(!plainauth)\n    return CURLE_OUT_OF_MEMORY;\n\n  /* Calculate the reply */\n  if(zlen != 0)\n    memcpy(plainauth, authzid, zlen); (4)\n```\nIn (1), `zlen + clen` can overflow, making the check for integer overflow useless.\n\nIn (2), `plainlen` can thus overflow, leading to an incorrect size for memory allocation done in (3).\n\nA heap buffer overflow of controlled size can then occur in (4), as we can compute `clen`, `plen` and `zlen` as needed for the overflow to occur in (1) and (2).\n\nThe data in `authzid` might be fully controlled and can lead to a trivial exploitation of the heap buffer overflow.\n\n## Limitations:\n\nThis vulnerability is not trivially triggered, as it requires the `authzid`, `authcid` and `passwd` strings to be controlled by an attacker, and require at least 2 of them to be over 2GB-long, which is not very likely to happen.\n\nMoreover, there are more limitations on strings, as they can not be over 2GB of size, if set through curl_easy mechanisms, but I believe they can be set with no such limitations through configuration files (untested).\n\nI did not include any PoC code for such reasons. I can always try to make one later if necessary.\n\n## Impact\n\nThis might lead to local code execution through a heap buffer overflow, or, in case of unknown usage of libcurl from an application, to RCE (yet not very likely).",
  "weakness": {
    "id": 13,
    "name": "Incorrect Calculation of Buffer Size"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 0,
  "voters": [],
  "severity": {
    "rating": "low",
    "score": 2.8,
    "author_type": "User",
    "metrics": {
      "attack_vector": "local",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "required",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "none",
      "availability": "low"
    }
  },
  "structured_scope": {
    "databaseId": 18844,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/curl/curl",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
