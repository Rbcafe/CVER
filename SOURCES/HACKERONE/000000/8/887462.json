{
  "id": 887462,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84ODc0NjI=",
  "url": "https://hackerone.com/reports/887462",
  "title": "CVE-2020-8177: curl overwrite local file with -J",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2020-05-30T13:08:39.175Z",
  "submitted_at": "2020-05-30T13:08:39.175Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "snsn",
    "url": "/snsn",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 35663,
    "url": "https://hackerone.com/curl",
    "handle": "curl",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "curl",
      "twitter_handle": "",
      "website": "https://curl.se",
      "about": "cURL is an Open Source project providing a library and command-line tool for doing internet transfers"
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2020-8177"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2020-12-05T08:33:30.879Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2020-11-05T08:33:29.543Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\ncurl supports the `Content-disposition` header, including the `filename=` option. By design, curl does not allow server-provided  local file override by verifying that the `filename=` argument does not exist before opening it.\nHowever, the implementation contains 2 minor logical bugs that allow a server to override an arbitrary local file (without path traversal) when running curl with specific command line args (-OJi)\nThis bug can trigger a logical RCE when curl is used from the user's home dir (or other specific directories), by overriding  specific files (e.g. \".bashrc\"), while keeping the user completely uninformed of the side effects.\n\nThe 2 bugs are:\n1. `curl -iJ` is not supported however `curl -Ji` is available - \n2. The standard `Content-disposition` handling flow does not allow opening existing files: https://github.com/curl/curl/blob/master/src/tool_cb_wrt.c#L54, however by using `-OJi` it is possible to reach a flow that overrides a local file with the response headers, without verification: https://github.com/curl/curl/blob/master/src/tool_cb_hdr.c#L196\n\n## Steps To Reproduce:\n\n  1. Return the following http response form a server :\n```\nHTTP/1.1 200 OK\n<PAYLOAD>\nContent-disposition: attachment; filename=\".bashrc\"\n```\nWhere `<PAYLOAD>` is the bash payload, e.g. `echo pwn`\n\n  2. Run `curl -OJi` from the user's home dir\n\n**Note that curl falsely claims that `.bashrc` was refused to be overwritten.**\n\n## Supporting Material/References:\nFirst bug:\n```c\n    case 'i':\n      config->show_headers = toggle; /* show the headers as well in the\n                                        general output stream */\n      break;\n...\n    case 'J': /* --remote-header-name */\n      if(config->show_headers) {\n        warnf(global,\n              \"--include and --remote-header-name cannot be combined.\\n\");\n        return PARAM_BAD_USE;\n      }\n      config->content_disposition = toggle;\n      break;\n```\n\nSecond bug:\n```c\n      if(filename) {\n        if(outs->stream) {\n          int rc;\n          /* already opened and possibly written to */\n          if(outs->fopened)\n            fclose(outs->stream);\n          outs->stream = NULL;\n\n          /* rename the initial file name to the new file name */\n          rc = rename(outs->filename, filename);\n          if(rc != 0) {\n            warnf(per->config->global, \"Failed to rename %s -> %s: %s\\n\",\n                  outs->filename, filename, strerror(errno));\n          }\n          if(outs->alloc_filename)\n            Curl_safefree(outs->filename);\n          if(rc != 0) {\n            free(filename);\n            return failure;\n          }\n        }\n```\n\n## Impact\n\nLocal file override without path traversal, possibly leading to an RCE or loss of data.",
  "bounty_amount": "700.0",
  "formatted_bounty": "$700",
  "weakness": {
    "id": 107,
    "name": "Improper Input Validation"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2020-12-05T08:33:29.652Z",
  "allow_singular_disclosure_after": -100674730.37638186,
  "singular_disclosure_allowed": true,
  "vote_count": 52,
  "voters": [
    "daviey",
    "sw33tlie",
    "xploiterr",
    "rook1337",
    "mirhat",
    "bibekshah",
    "rzx007x",
    "ali",
    "nightm4re",
    "tomtenisse",
    "and 42 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 4.7,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "high",
      "privileges_required": "none",
      "user_interaction": "required",
      "scope": "changed",
      "confidentiality": "none",
      "integrity": "low",
      "availability": "low"
    }
  },
  "structured_scope": {
    "databaseId": 18844,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/curl/curl",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
