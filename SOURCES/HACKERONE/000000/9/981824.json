{
  "id": 981824,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85ODE4MjQ=",
  "url": "https://hackerone.com/reports/981824",
  "title": "DNS Setup allows sending mail on behalf of other customers",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2020-09-14T16:41:04.167Z",
  "submitted_at": "2020-09-14T16:41:04.206Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "aisforarray",
    "url": "/aisforarray",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/EbDBUh47Jn78TjXkoVjy7Rkg/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 67,
    "url": "https://hackerone.com/basecamp",
    "handle": "basecamp",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Basecamp",
      "twitter_handle": "basecamp",
      "website": "https://basecamp.com/about/policies/security/response",
      "about": "Basecamp is the leading online project manager and the birthplace of Ruby on Rails. Creators of the HEY email service."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2021-02-21T16:02:32.495Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2021-01-22T16:02:25.128Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "# Sent on your behalf\n\nI knew basecamp themselves had used helpscout for support, so I was\ncurious to see if hey was doing the same.  A quick DNS lookup gave me the answer\nI was looking for:\n\n```\ndig hey.com txt                     \n\n; <<>> DiG 9.10.6 <<>> hey.com txt\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 48297\n;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;hey.com.\t\t\tIN\tTXT\n\n;; ANSWER SECTION:\nhey.com.\t\t60\tIN\tTXT\t\"cyssd1dn8z15bmffrprj1hzycw436gzh\"\nhey.com.\t\t60\tIN\tTXT\t\"google-site-verification=k7w8RY2bLljThqEsIGQOoQlclHp19HawwdiHTq2nJpw\"\nhey.com.\t\t60\tIN\tTXT\t\"google-site-verification=VH8KKQzQ7gWsKxSsibqBexLteqs254PwGFS37Hf22MQ\"\nhey.com.\t\t60\tIN\tTXT\t\"v=spf1 include:_spf.hey.com include:helpscoutemail.com -all\"\n\n;; Query time: 39 msec\n;; SERVER: 192.168.42.1#53(192.168.42.1)\n;; WHEN: Fri Jun 26 17:20:34 PDT 2020\n;; MSG SIZE  rcvd: 315\n```\n\nOk.  That's interesting.  helpscoutemail.com has permissions to send email on\nbehalf of hey.com.  For completeness let's look at helpscoutmail.com spf\nrecords:\n\n```\ndig helpscoutemail.com txt\n\n; <<>> DiG 9.10.6 <<>> helpscoutemail.com txt\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 47004\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;helpscoutemail.com.\t\tIN\tTXT\n\n;; ANSWER SECTION:\nhelpscoutemail.com.\t300\tIN\tTXT\t\"v=spf1 ip4:54.173.229.38 ip4:52.0.20.102 ip4:54.174.116.32 ip4:52.2.238.96 ip4:52.20.146.34 ip4:34.198.122.65 ~all\"\n\n;; Query time: 42 msec\n;; SERVER: 192.168.42.1#53(192.168.42.1)\n;; WHEN: Fri Jun 26 17:32:45 PDT 2020\n;; MSG SIZE  rcvd: 174\n```\n\n### How can we exploit this?\n\nFirst, let's go ahead and create an account over at helpscout.  It can be\nanything.  Let's setup an inbox.  Again, it can be anything, doesn't really\nmatter.  What **does** matter is that we setup a custom address for the inbox.\nOf course, helpscout makes sure we have access to the email address we're\nacting as.  \n\nSo let's go ahead and setup an email as dhhracing@hey.com.  First, we sign up\nfor a trial on hey.com with that email.  All good.  Now, let's enter that into\nhelpscout.  Once we get the verification email in hey, we enter the verification\nin helpscout.  But... generally there is another step.  Helpscout needs to have\npermission to send on our behalf.  How do they do that?  With DNS records for\nSPF, DKIM and DMARC.  But... hey.com has already done that as they themselves\nare helpscout customers.\n\nNow here is where the trouble comes in.  hey.com has a recycle policy.  If you\ncreate a trial but never pay, or as for a refund, then after 30 days the email\naddress becomes available again.  So let's go ahead and cancel our\ndhhracing@hey.com account (in hey, not in sendgrid).  Now we wait 30 days.  Now,\nDHH realizes he needs an address for his racing.  So he goes to hey.com and\ncreates an account under dhhracing@hey.com.  And what do you know, it's\navailable!\n\nBut now, not only can DHH send email from dhhracing@hey.com, but SO CAN I.  From\nmy helpscout account.  Of course, I won't receive mail from that account, but I\ncould always just send out mail and CC another address that I own and hope for a\nreply-all.  But really, the options for scamming are limitless.\n\nI've suggested a few options to hey.com:\n\n1. Don't use the primary domain on helpscout.  Setup heysupport.com or\n   something similar.\n2. Don't ever recycle accounts.  I can only ever see this causing issues.\n3. Get helpscout to treat hey.com as a mail provider and don't allow sending\n   from their domain.\n\n## Impact\n\nAn attacker could spoof any hey.com email address that they had originally created an address for (and had been recycled).  This could allow them to appear to be a high-profile individual or company.  By CCing an address that they currently own they could receive replies from the correspondence as well.",
  "weakness": {
    "id": 57,
    "name": "Violation of Secure Design Principles"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2021-02-21T16:02:25.220Z",
  "allow_singular_disclosure_after": -93909161.04525702,
  "singular_disclosure_allowed": true,
  "vote_count": 56,
  "voters": [
    "mr-medi",
    "osman1337",
    "arw9234",
    "username_n0t_4vailable",
    "badcracker",
    "fqdn",
    "ltidi",
    "kickino",
    "najeh_halawani",
    "ali",
    "and 46 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 6.8,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "high",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "changed",
      "confidentiality": "none",
      "integrity": "high",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 53959,
    "asset_type": "WILDCARD",
    "asset_identifier": "*.hey.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
