{
  "id": 127948,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjc5NDg=",
  "url": "https://hackerone.com/reports/127948",
  "title": "Stored XSS on newsroom.uber.com admin panel / Stream WordPress plugin",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-04-03T09:22:57.277Z",
  "submitted_at": "2016-04-03T09:22:57.277Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "jouko",
    "url": "/jouko",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/mqyrwb0f5m6e7yq17l0nrhhz32yw/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 314,
    "url": "https://hackerone.com/uber",
    "handle": "uber",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/314/24ea21370a71b18eafb5722d5855825ab622b5dd_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/314/24ea21370a71b18eafb5722d5855825ab622b5dd_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Uber",
      "twitter_handle": "",
      "website": "https://www.uber.com",
      "about": ""
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2016-07-27T19:39:41.866Z",
  "bug_reporter_agreed_on_going_public_at": "2016-07-27T19:39:41.718Z",
  "team_member_agreed_on_going_public_at": "2016-07-27T17:46:15.472Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "*newsroom.uber.com* uses a WordPress plugin called Stream to log user activity. In some cases the logged events aren't sanitized properly and can contain HTML tags and JavaScript. An unauthenticated user can produce such a log message to inject JavaScript in the admin panel. When an administrator views the log, the script would be evaluated with administrator privilegs and can (under normal setup) be further used to inject attacker-supplied PHP code on the server.\n\n#Reproducing#\nThe following command line can be used to inject JavaScript in the log with the *curl* tool:\n~~~~\ncurl -v -H 'Referer: /hello?plugin-editor.php&file=aaa%3cscript%3ealert(%27stored%20xss%27);%3c/script%3e' --data 'post-password=foo' 'https://newsroom.uber.com/wp-login.php?action=postpass'\n~~~~\nNext, if an administrator clicks the Stream tab in the WordPress Dashboard, an alert box should pop up.\n\n#Details#\nThe Stream plugin hooks many WordPress events to log user activity. In the file *connectors/installer.php* there is a *wp_redirect()* hook - the plugin checks every URL redirection to see if it involved the plugin editor. The code, compacted a bit:\n\n~~~~php\n        public static function callback_wp_redirect( $location ) {\n                if ( ! preg_match( '#(plugin)-editor.php#', $location, $match ) ) {\n                        return $location;\n                }\n                $type = $match[1];\n                list( $url, $query ) = explode( '?', $location );\n                $query = wp_parse_args( $query );\n                $file  = $query['file'];\n                if ( empty( $query['file'] ) ) {\n                        return $location;\n                }\n                /* SNIP ... */ elseif ( 'plugin' === $type ) {\n                        global $plugin, $plugins;\n                        $plugin_base = current( explode( '/', $plugin ) );\n                        foreach ( $plugins as $key => $plugin_data ) {\n                                if ( $plugin_base === current( explode( '/', $key ) ) ) {\n                                        $name = $plugin_data['Name'];\n                                        break;\n                                }\n                        }\n                }\n                self::log(\n                        _x(\n                                'Edited %1$s: %2$s',\n                                'Plugin/theme editing. 1: Type (plugin/theme), 2: Plugin/theme name',\n                                'stream'\n                        ),\n                        compact( 'type', 'name', 'file' ),null, array( $type . 's' => 'edited' ));\n\n~~~~\nSo if there is a redirect to a URL containing the string \"plugin-editor.php\" with a *file* query parameter, then the activity is logged. The *file* query parameter is included in the log entry.\n\nThe event is saved in Stream's database table and shown on the main tab of the plugin without sufficient HTML sanitizing.\n\nThere are many ways to generate an HTTP redirect in WordPress. The method used in the above example is requesting *wp-login.php* which, with appropriate arguments, redirects the browser back to the Referer: header's value.\n\n#Impact#\nThe JavaScript stored by an unauthenticated attacker would get executed with administrator privileges, thus having full control over the site contents. Under a normal WordPress setup it could also modify existing PHP files via the plugin or theme editors, leading to server-side compromise.\n\nI tested this on my local test system with the latest WordPress and Stream 1.4.9.",
  "bounty_amount": "5000.0",
  "formatted_bounty": "$5,000",
  "weakness": {
    "id": 60,
    "name": "Cross-site Scripting (XSS) - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2016-08-26T17:46:15.549Z",
  "allow_singular_disclosure_after": -235592365.66575196,
  "singular_disclosure_allowed": true,
  "vote_count": 18,
  "voters": [
    "delimitry",
    "n1m0",
    "bogdantcaciuc",
    "shailesh4594",
    "michiel",
    "vijay_kumar",
    "muhammad_uwais",
    "japz",
    "sumit7",
    "secbughunter",
    "and 8 more..."
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
