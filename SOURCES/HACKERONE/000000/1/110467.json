{
  "id": 110467,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTA0Njc=",
  "url": "https://hackerone.com/reports/110467",
  "title": "Bypassing Digits bridge origin validation",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-01-13T14:14:24.338Z",
  "submitted_at": "2016-01-13T14:14:24.338Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "filedescriptor",
    "url": "/filedescriptor",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 61,
    "url": "https://hackerone.com/x",
    "handle": "x",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/ikx4ept298unt534kpz4am2bd4zs/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/ikx4ept298unt534kpz4am2bd4zs/f4a495c04fdb224bac8ec64587537e511aa8c4925e7955bee0a19e0ed7d891dc"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "X (Formerly Twitter)",
      "twitter_handle": "XSecurity",
      "website": "https://x.com",
      "about": "X helps you create and share ideas and information instantly, without barriers."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2017-04-30T15:41:17.220Z",
  "bug_reporter_agreed_on_going_public_at": "2017-03-31T15:41:11.333Z",
  "team_member_agreed_on_going_public_at": null,
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hi,\nI would like to report an issue in the bridge proxy in Digits which allows attacker to retrieve the OAuth credential data of an application victims authorized.\n\n#Detail\nIn the Digits Web SDK, the method [getLoginStatus](https://docs.fabric.io/web/digits/getting-started.html#set-up-digits-authentication) can be used to retrieve the OAuth credential data of an application if the user has already logged in Digits and authorized the app. The way it works is to inject an hidden iframe (I call it bridge because the URL is https://www.digits.com/bridge) which acts like a proxy into the webpage and communicate using *postMessage*. Once the bridge receives the *getLoginStatus* command, it will make an AJAX request to /login_status and the response will contain the OAuth credential data of the user of an application. Then, the bridge will send back the data via *postMessage* to parent window.\n\nFor example:\n\n```\n+----------------------------------------------------------------------------------+\n| https://www.periscope.tv/                                                        |\n+----------------------------------------------------------------------------------+\n|                                                                                  |\n|  +----------------------------------------------------------------------------+  |\n|  | https://www.digits.com/bridge?consumer_key=.&host=https://www.periscope.tv |  |\n|  +----------------------------------------------------------------------------+  |\n|  |                                                                            |  |\n|  |                      ^                           +                         |  |\n|  +----------------------------------------------------------------------------+  |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         +                           v                            |\n|                   getLoginStatus             OAuth Credential                    |\n|                                                                                  |\n+----------------------------------------------------------------------------------+\n```\n\nIf https://www.periscope.tv/ invokes *Digits.getLoginStatus()*, then an iframe will be injected where the *host* parameter is the invoker origin.\n\nThere's a protection in place which validates whether the *host* parameter provided matches the application registered domain. For example, ```/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE&host=https://www.periscope.tv``` passes while ```/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE&host=https://attacker.com``` fails. This prevents others to use the same *consumer_key* to pretend to be the legit application to issue the command.\n\nHowever, **there is no validation to check whether the page which embeds the bridge proxy is from the registered domain**. In other words, attacker can manually embed ```/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE&host=https://www.periscope.tv``` into his/her webpage and issue command on behalf of the legit application.\n\n#Impact\nIt affects every application that has integrated Digits, and even official application (Periscope). Attacker can abuse the flaw to login to victim's account on the affected applications. In addition, this attack **does not require user interaction**. The only prerequisite is that the victim has already logged in Digits and authorized the application.\n\n#PoC\n1. Prepare a Periscope account which is associated with a phone number, and make sure you have logged in Digits (https://www.digits.com/signin) with that number\n2. Go to http://innerht.ml/pocs/digits-bridge-origin-validation-bypass/\n3. Wait for a while\n4. You Periscope account will be renamed as \"Pwn3d\"\n\nVideo demo: https://vimeo.com/151646523 (password: proxy)\n\nAnd as always, since it does not require user interaction, it can be put into a player card to achieve maximum stealthiness.\n\n#Fix\nIt would be ideal to employ CORS instead of postMessage + proxy for that purpose. An alternative fix would be to check whether the page embedding the bridge proxy is from the registered domain by comparing referrer (pretty unsound though).",
  "weakness": {
    "id": 27,
    "name": "Improper Authentication - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2017-04-30T15:41:11.389Z",
  "allow_singular_disclosure_after": -214258401.27266204,
  "singular_disclosure_allowed": true,
  "vote_count": 89,
  "voters": [
    "zhchbin",
    "n1m0",
    "sp1d3rs",
    "bogdantcaciuc",
    "kapytein",
    "hunter",
    "woltage",
    "bl4de",
    "adn",
    "tess",
    "and 79 more..."
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
