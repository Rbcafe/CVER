{
  "id": 148151,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDgxNTE=",
  "url": "https://hackerone.com/reports/148151",
  "title": "SMB User Authentication Bypass and Persistence",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-06-29T06:53:24.816Z",
  "submitted_at": "2016-06-29T06:53:24.816Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "rhinosecuritylabs",
    "url": "/rhinosecuritylabs",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/009/014/87f51a075923b3ca98dee6380644f9f008ae96fc_original.jpg/3c7b305354c9073c106ae3d1701798defaaf5be844fb8fdfa49ca62f991a2c2c"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 3059,
    "url": "https://hackerone.com/owncloud",
    "handle": "owncloud",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/003/059/d31dc64427bbbf2e428a0b0b97bce59b98d2ba0d_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/003/059/d31dc64427bbbf2e428a0b0b97bce59b98d2ba0d_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "paused",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "ownCloud",
      "twitter_handle": "ownCloud",
      "website": "https://www.owncloud.com",
      "about": "ownCloud GmbH is the company behind the ownCloud Project - the most downloaded open source project for data and file sync, share and view."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2016-9463"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2016-11-26T15:29:24.618Z",
  "bug_reporter_agreed_on_going_public_at": "2016-10-27T15:29:23.771Z",
  "team_member_agreed_on_going_public_at": null,
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Authentication Bypass\n==================\n\nThe external user authentication app in OwnCloud does not properly authenticate against an SMB server. In it's current implementation, the file (owncloud/apps/user_external/lib/smb.php, line 46-47) uses the command `smbclient -L //host/dummy -Uuser%pass`, where the variables `user` and `pass` are escaped for shell characters. However, default Samba SMB servers set \"map to guest\" to the value \"bad user\". This allows for the listing of shares regardless of user, but not further information. \n\nThe image shows the command `smbclient -L //localhost/dummy -Utest%test` succeeding with an invalid user \"test\" using password \"test\", yet the user does not exist as shown by the second command `smbclient //localhost/dummy -Utest%test`.\n\n{F102413}\n\nWhen the default \"map to guest\" parameter is changed to \"never\" in the smb.conf for the SMB server, both commands fail as required.\n\n{F102414}\n\nTo properly validate the user the command should simply be `smbclient //host -Uuser%pass`. This properly authenticates the user and returns a valid error message the the script can interpret. In it's current implementation, providing any username to the application will log you in as that user - even creating a new one if necessary.\n\nTo Replicate\n------------------\n1. Set up a Samba SMB server like detailed on this page:\n\nhttps://help.ubuntu.com/community/How%20to%20Create%20a%20Network%20Share%20Via%20Samba%20Via%20CLI%20(Command-line%20interface/Linux%20Terminal)%20-%20Uncomplicated,%20Simple%20and%20Brief%20Way!\n\n2. Login to the OwnCloud application and enable the external user authentication app.\n\n3. Edit the config and add:\n'user_backends' => \n  array (\n    0 => \n    array (\n      'class' => 'OC_User_SMB',\n      'arguments' => \n      array (\n        0 => 'SMBHOST',\n      ),\n    ),\n  ),\n\n3. If a user already exists and you have the username, you can login using any password (including the administrator account!). If user doesn't exist, it will create said user and log you in.\n\n\nUntrusted Parameter Host\n======================\n\nIn the same php file (owncloud/apps/user_external/lib/smb.php, line 46-47) the parameter `host` is not properly escaped. This allows for code execution every time a user logs into the application if they were able to edit the owncloud/config/config.php file. This could allow for a valid persistence mechanism within the application.",
  "weakness": {
    "id": 27,
    "name": "Improper Authentication - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 102413,
      "file_name": "Screen_Shot_2016-06-28_at_11.45.08_PM.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/102/413/bd6ad1e590346403092f322c9256d706614ac515/Screen_Shot_2016-06-28_at_11.45.08_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2016-06-28_at_11.45.08_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2016-06-28_at_11.45.08_PM.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4FAMPPRY%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T121625Z&X-Amz-Expires=3062&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCID7qnbDtQnppWbK9qoDjLwYSeBYc3LRQ%2BMdKpj5H8QM5AiBcd5fhkOSjbw3KxGXsdAbT3wThN7msB2RWCygRr5LCFCqxBQhwEAMaDDAxMzYxOTI3NDg0OSIMgNfkjKpbMNfrzm%2FrKo4FsJk%2BxIB%2FpE9OZtgUFnkErO%2BhHPLPdxGIhFqg%2Bq0WjmQDZNK0xDM7xsBL8S96OIBsJhKmFO2X5YXAM%2BJWLiq5jWeZK2UlcjaqMbEYoqMwzZZpon%2BJgSLl7CmhaaJEYo2Eqg8gQk%2FzsS7gK1DQUo5y7p40mrs3bqiBli%2BEbN3p1DzRF1OsJmu1tZGMKR0FAcr61%2B9haXE8SpV7jEcHIuniF5i4IiY6EhO8q7kzwOOWNJi%2BBAgp27jLj8bpr8BIQYO9YMDJ2sl9KSPyh3nYV9sPJ8eAhDm9MU6faC%2F6CndOHo39J7nBh3nxv2OgaiNVBrG9IB1IshOcJ6TbRWQITABKSELW8lcGO%2Fk5kL84OvCkCj8lGri2ErfG6E2cdhO5msFSxbOSsdeTEzyZMnlXNbIwvPbKFe1JSot39yqx1rwXOWENIyZGKymFar7C00y4EjMAnYIa8LnZv9bZddep%2B6C8rAKUuhA5WNFQMoEjYPbkMBoR5%2BJwceeEq9Y7eWce1bzC2baAtlgJv00Bq8dW1ERyDEqL2rMEsnwcqK176fzylvXzP3%2BwcRPApE21%2F2U2EPNQcv%2FpdP5UelCpwvfNpMQdSI%2BeOWh6zhSs2Qu5HziRgeMzA86pDdxk%2B16Slz2CwT8P4OXzvVQRmNY7Nz0miEc3OEklOATXOFxHiDHWPfc7csKSpFUSLauCI%2FULJBbezKD4QcgYP0B9xcbgKlsLzw%2BACW6EoDGtQCfib%2BDcpdzWYvsn9wbqvcZT7DBvkRrH2qyoW7Vqwv2n%2BIZuOW8JIYNJ8lI5wHRZGNr9kwx6cfvK0V2%2Fkpi8X7UdGfaGDccM7kwtlYjl90mD1zjfZCweNKMiv6mx5wX8Ek1dDgHEbl31MLeorK4GOrIB0Cm%2F258YlHJ0u3oe5G2fqDJBkkDc4nTkDoxYVyXxLDavzSxkqxIe4yUE6WkeTnQ50Hek4AkKUuDs3EcCnHh0bldMqsIZ4S5yaHjH3LoM%2BCaH9miaUPuq2ugm1ugC7WzW0auy4Y%2F5eNeOJH1TtrOM44T7LWh6S0WEUeScI8SSHyviHGGemiCIB8Pt7Ns0huMN7cWBZ6nAw2p5vpvlUOWFreiZY5OJe4C9DAST3zh0ufFv%2FA%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=5df9789e7b06df7e7ae212542140788e0bffa3d7be09599aded84efa6c4ab229",
      "file_size": 196762,
      "type": "image/png",
      "moderated": null
    },
    {
      "id": 102414,
      "file_name": "Screen_Shot_2016-06-28_at_11.46.11_PM.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/102/414/ee218050665c73c0c15040502fa350f1e75b481b/Screen_Shot_2016-06-28_at_11.46.11_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2016-06-28_at_11.46.11_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2016-06-28_at_11.46.11_PM.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4FAMPPRY%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T121625Z&X-Amz-Expires=3062&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCID7qnbDtQnppWbK9qoDjLwYSeBYc3LRQ%2BMdKpj5H8QM5AiBcd5fhkOSjbw3KxGXsdAbT3wThN7msB2RWCygRr5LCFCqxBQhwEAMaDDAxMzYxOTI3NDg0OSIMgNfkjKpbMNfrzm%2FrKo4FsJk%2BxIB%2FpE9OZtgUFnkErO%2BhHPLPdxGIhFqg%2Bq0WjmQDZNK0xDM7xsBL8S96OIBsJhKmFO2X5YXAM%2BJWLiq5jWeZK2UlcjaqMbEYoqMwzZZpon%2BJgSLl7CmhaaJEYo2Eqg8gQk%2FzsS7gK1DQUo5y7p40mrs3bqiBli%2BEbN3p1DzRF1OsJmu1tZGMKR0FAcr61%2B9haXE8SpV7jEcHIuniF5i4IiY6EhO8q7kzwOOWNJi%2BBAgp27jLj8bpr8BIQYO9YMDJ2sl9KSPyh3nYV9sPJ8eAhDm9MU6faC%2F6CndOHo39J7nBh3nxv2OgaiNVBrG9IB1IshOcJ6TbRWQITABKSELW8lcGO%2Fk5kL84OvCkCj8lGri2ErfG6E2cdhO5msFSxbOSsdeTEzyZMnlXNbIwvPbKFe1JSot39yqx1rwXOWENIyZGKymFar7C00y4EjMAnYIa8LnZv9bZddep%2B6C8rAKUuhA5WNFQMoEjYPbkMBoR5%2BJwceeEq9Y7eWce1bzC2baAtlgJv00Bq8dW1ERyDEqL2rMEsnwcqK176fzylvXzP3%2BwcRPApE21%2F2U2EPNQcv%2FpdP5UelCpwvfNpMQdSI%2BeOWh6zhSs2Qu5HziRgeMzA86pDdxk%2B16Slz2CwT8P4OXzvVQRmNY7Nz0miEc3OEklOATXOFxHiDHWPfc7csKSpFUSLauCI%2FULJBbezKD4QcgYP0B9xcbgKlsLzw%2BACW6EoDGtQCfib%2BDcpdzWYvsn9wbqvcZT7DBvkRrH2qyoW7Vqwv2n%2BIZuOW8JIYNJ8lI5wHRZGNr9kwx6cfvK0V2%2Fkpi8X7UdGfaGDccM7kwtlYjl90mD1zjfZCweNKMiv6mx5wX8Ek1dDgHEbl31MLeorK4GOrIB0Cm%2F258YlHJ0u3oe5G2fqDJBkkDc4nTkDoxYVyXxLDavzSxkqxIe4yUE6WkeTnQ50Hek4AkKUuDs3EcCnHh0bldMqsIZ4S5yaHjH3LoM%2BCaH9miaUPuq2ugm1ugC7WzW0auy4Y%2F5eNeOJH1TtrOM44T7LWh6S0WEUeScI8SSHyviHGGemiCIB8Pt7Ns0huMN7cWBZ6nAw2p5vpvlUOWFreiZY5OJe4C9DAST3zh0ufFv%2FA%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=ee2b461721d311ddf03efc9efe8617adac8a4abe89ddd42d5657d2db8a36a5d7",
      "file_size": 83565,
      "type": "image/png",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2016-11-26T15:29:23.808Z",
  "allow_singular_disclosure_after": -227652421.85072902,
  "singular_disclosure_allowed": true,
  "vote_count": 8,
  "voters": [
    "lukasreschke",
    "sodium_",
    "mpz",
    "eveeez",
    "lordjerry0x01",
    "linkks",
    "sumit7",
    "spetr0x"
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
