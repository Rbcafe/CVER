{
  "id": 195088,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTUwODg=",
  "url": "https://hackerone.com/reports/195088",
  "title": "Every user can delete public deploy keys",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2017-01-01T18:10:30.371Z",
  "submitted_at": "2017-01-01T18:10:30.371Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "jobert",
    "url": "/jobert",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 264,
    "url": "https://hackerone.com/gitlab",
    "handle": "gitlab",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "GitLab",
      "twitter_handle": "gitlab",
      "website": "https://about.gitlab.com",
      "about": "A single application for the entire software development lifecycle."
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2017-01-23T23:09:52.996Z",
  "bug_reporter_agreed_on_going_public_at": "2017-01-23T20:47:24.215Z",
  "team_member_agreed_on_going_public_at": "2017-01-23T23:09:52.947Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "# Vulnerability details\nA GitLab instance can have public deploy keys that project admins can use for their project. An attacker can delete these public keys used by other users to deploy code.\n\n# Impact\nDeleting these shared deploy keys may stop users to deploy their code.\n\n# Proof of concept\nMake sure the GitLab instance has a public deploy key. Lets assume it has ID 1. Now sign in as a normal user and follow the steps below.\n\n1. Create a new project called `test`\n2. Go to http://gitlab-instance/user/test/deploy_keys\n3. Go to the `Public deploy keys available to any project` section and click the `Enable` button for the public deploy key\n4. Create an access token for the API for your own account\n5. Request `/api/v3/projects`, get the ID number for the project `test`\n6. Request `/api/v3/projects/:project_id/deploy_keys`, you'll see the public deploy key\n7. Send a `DELETE` request to `/api/v3/projects/:project_id/deploy_keys/:id - this will delete the public (shared) deploy key, not the relationship between the project and the key. Below is a copy of the request and response.\n\n**Request**\n```\ncurl -X DELETE -H \"Private-Token: AAAA\" http://gitlab-instance/api/v3/projects/1/deploy_keys/1\n```\n\n\n**Response**\n```\n{\"id\":1,\"user_id\":null,\"created_at\":\"<removed>\",\"updated_at\":\"<removed>\",\"key\":\"<key>\",\"title\":\"<title>\",\"fingerprint\":\"72:bb:e9:cc:04:dc:64:b9:a3:e7:c2:26:8f:f2:ed:df\",\"public\":true}\n```\n\nThe root cause of this problem lies in the following lines of code:\n\n**lib/api/deploy_keys.rb**\n```ruby\ndelete \":id/#{path}/:key_id\" do\n  key = user_project.deploy_keys.find(params[:key_id])\n  key.destroy\nend\n```\n\nThe `destroy` method will be called on the shared deploy key instead of on the relationship.\n\n# Remediation advice\nInstead of removing the entire object, remove the relationship instead when it's a public deploy key.",
  "weakness": {
    "id": 75,
    "name": "Privilege Escalation"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2017-02-22T20:47:24.312Z",
  "allow_singular_disclosure_after": -220031065.76446465,
  "singular_disclosure_allowed": true,
  "vote_count": 12,
  "voters": [
    "derision",
    "bogdantcaciuc",
    "ayoubfathi_",
    "mpz",
    "eveeez",
    "kieran",
    "japz",
    "spetr0x",
    "cryptosector",
    "arice",
    "and 2 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 6.5,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "none",
      "availability": "high"
    }
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
