{
  "id": 506161,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MDYxNjE=",
  "url": "https://hackerone.com/reports/506161",
  "title": "Build fetches jars over HTTP",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2019-03-07T16:24:48.110Z",
  "submitted_at": "2019-03-07T16:24:48.110Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "jlleitschuh",
    "url": "/jlleitschuh",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/388/267/887b2ef55debfc7b243bdf563d314329cf750468_original.JPG/cccd3716a6d2e06174d2a41492445cb1d4bf85b4611a755bc810b9246a24d951"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 15252,
    "url": "https://hackerone.com/portswigger",
    "handle": "portswigger",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/015/252/60e8778f4f1fee57ea2b164a7d2ec1e2d2dd7bc8_original./d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/015/252/60e8778f4f1fee57ea2b164a7d2ec1e2d2dd7bc8_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "PortSwigger Web Security",
      "twitter_handle": "Burp_Suite",
      "website": "https://portswigger.net",
      "about": "Burp Suite is the leading software for web security testing"
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-06-10T19:01:06.838Z",
  "bug_reporter_agreed_on_going_public_at": "2019-06-10T18:59:44.744Z",
  "team_member_agreed_on_going_public_at": "2019-06-10T19:01:06.742Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "[CWE-829: Inclusion of Functionality from Untrusted Control Sphere](https://cwe.mitre.org/data/definitions/829.html)\n[CWE-494: Download of Code Without Integrity Check](https://cwe.mitre.org/data/definitions/494.html)\n\nPortSwigger maintains several Open Source Projects under the [PortSwigger GitHub organization](https://github.com/PortSwigger). Some of these projects contain build files that indicate that some of these projects are resolving dependencies over HTTP instead of HTTPS. This allows these artifacts to be potentially MITMed to maliciously compromise them and infect the build artifacts that are produced. Additionally, if any of these JARs or other dependencies were compromised, any developers or production servers using these could continue to be infected past updating to fix this.\n\n**Description:**\n\nThis attack leverages the build infrastructure loading dependencies over HTTP without any other sort of integrity check to allow them to be maliciously compromised.\n\n### This isn't just theoretical\nPOC code has existed since 2014 to maliciously compromise a JAR file inflight.\nSee:\n* https://max.computer/blog/how-to-take-over-the-computer-of-any-java-or-clojure-or-scala-developer/\n* https://github.com/mveytsman/dilettante\n\n### MITM Attacks Increasingly Common\nSee:\n* https://serverfault.com/a/153065\n* https://security.stackexchange.com/a/12050\n* [Comcast continues to inject its own code into websites you visit](https://thenextweb.com/insights/2017/12/11/comcast-continues-to-inject-its-own-code-into-websites-you-visit/#) (over HTTP)\n\n### Source Locations\n\n#### Insecure Download\n\n##### TeamCity Integration\n- https://github.com/PortSwigger/burp-teamcity-integration/blob/4fc37ab14575ab9b54cf27e8ecac0923fa1ed3e0/pom.xml#L11-L22\n\n##### Jenkins Integration\n\n- https://github.com/PortSwigger/burp-jenkins-integration/blob/0151b131807d46ef0b55b172a1f23f988cd27bac/pom.xml#L17-L29\n\n#### Insecure Upload\n\nInsecure upload of artifacts is pretty much always accompanied by credentials. Since these credentials are sent over HTTP, they are transmitted in plaintext and should be considered compromised.\n\n##### Jenkins Integration\n - https://github.com/PortSwigger/burp-jenkins-integration/blob/0151b131807d46ef0b55b172a1f23f988cd27bac/pom.xml#L61-L66\n\n### Fix and Public Disclosure\n\nAt a minimum, all of these code locations where artifacts are downloaded from an untrusted source needs to be fixed. Previous releases should be rebuilt with the fix applied. The checksum of the released artifacts and artifacts built in a trusted environment should be made. If the checksums match, you can be certain that they weren't compromised.\n\nIf the checksums don't match, indicating a compromised artifact, CVE numbers need to be issued for the potentially malicious artifacts.\n\nThe ability to check if checksums match assume that these projects have [reproducible builds](https://en.wikipedia.org/wiki/Reproducible_builds).\n\n## Steps To Reproduce:\n\n  1. Cone the Impacted Project\n  2. Change this line in Dilettante so it is targeting the repository used in the build.\n       https://github.com/mveytsman/dilettante/blob/master/dilettante.py#L143\n  3. Start Dilettante on your local machine.\n  4. Proxy the HTTP traffic for the build through Dilettante\n  5. Execute the Build's tests.\n  6. You should be greeted with the image of a cat.\n\n\n## Other Places to Look\n\nGiven how widely I'm finding this vulnerability externally, I'd advise that the Port Swigger Security team take some time to also analyze their internal infrastructure for similar vulnerabilities.\n\n**This responsible disclosure follows [Google's 90-day vulnerability disclosure policy](https://www.google.com/about/appsecurity/) (I'm not an employee of Google, I just like their policy).**\n\n## Impact\n\nBy insecurely downloading code over an untrusted connection HTTP and executing the untrusted code inside of these JAR files as part of the unit/integration tests before a release opens these artifacts up to being maliciously compromised.\n\nRemote code execution on a production server. Malicious compromise of build artifacts.",
  "bounty_amount": "1000.0",
  "formatted_bounty": "$1,000",
  "weakness": {
    "id": 30,
    "name": "Man-in-the-Middle"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-07-10T18:59:44.852Z",
  "allow_singular_disclosure_after": -145045151.61896846,
  "singular_disclosure_allowed": true,
  "vote_count": 131,
  "voters": [
    "tangoj",
    "ikuamike",
    "k0z3r0",
    "foobar7",
    "base_64",
    "rook1337",
    "str0k1rch",
    "th4nu_0x0",
    "sameerphad72",
    "myasnikovalexey",
    "and 121 more..."
  ],
  "severity": {
    "rating": "medium",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 14056,
    "asset_type": "DOWNLOADABLE_EXECUTABLES",
    "asset_identifier": "Burp Suite Enterprise Edition",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "id": 16582,
      "category": "researcher",
      "content": "This report was part of a 4 month research project into the general supply chain security of the JVM ecosystem. This vulnerability impacted organizations like the Apache Foundation, Eclipse Foundation, Elastic Search, JetBrains, Jenkins, Oracle, Google, Gradle and many other open source projects including both the Kotlin and Groovy compiler.\n\nThe full blog post about this research can be found here: [Want to take over the Java ecosystem? All you need is a MITM!](https://medium.com/@jonathan.leitschuh/want-to-take-over-the-java-ecosystem-all-you-need-is-a-mitm-1fc329d898fb?source=friends_link&sk=3c99970c55a899ad9ef41f126efcde0e)\n\nIn the case of BurpSuite, this vulnerability impacted the build infrastructure for their TeamCity and Jenkins Integration plugins.",
      "user": {
        "id": 388267,
        "username": "jlleitschuh",
        "name": "Jonathan Leitschuh",
        "bio": "Senior Software Security Researcher @ Open Source Security Foundation; First Dan Kaminsky Fellow",
        "cleared": false,
        "verified": false,
        "website": "https://twitter.com/JLLeitschuh",
        "location": "New England",
        "created_at": "2018-10-27T03:04:35.078Z",
        "url": "https://hackerone.com/jlleitschuh",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/000/388/267/887b2ef55debfc7b243bdf563d314329cf750468_original.JPG/cccd3716a6d2e06174d2a41492445cb1d4bf85b4611a755bc810b9246a24d951",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/388/267/887b2ef55debfc7b243bdf563d314329cf750468_original.JPG/67ff39e4a58539d410215f8dba66a6070ecd205a28d2d3cc89a9223fcfd99d7c",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/000/388/267/887b2ef55debfc7b243bdf563d314329cf750468_original.JPG/d1445988e2aaee9e43a96ed7edc9348b9095032dce95c8873f36a1ca91ca18f7"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    }
  ]
}
