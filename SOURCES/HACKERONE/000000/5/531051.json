{
  "id": 531051,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MzEwNTE=",
  "url": "https://hackerone.com/reports/531051",
  "title": "SQL Injection Extracts Starbucks Enterprise Accounting, Financial, Payroll Database",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "critical",
  "readable_substate": "Resolved",
  "created_at": "2019-04-08T10:38:35.130Z",
  "submitted_at": "2019-04-08T10:38:35.130Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "spaceraccoon",
    "url": "/spaceraccoon",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 1989,
    "url": "https://hackerone.com/starbucks",
    "handle": "starbucks",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Starbucks",
      "twitter_handle": "Starbucks",
      "website": "http://www.starbucks.com",
      "about": "OUR MISSION WITH EVERY CUP, WITH EVERY CONVERSATION, WITH EVERY COMMUNITYâ€“ WE NURTURE THE LIMITLESS POSSIBILITIES OF HUMAN CONNECTION"
    }
  },
  "has_bounty?": true,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "no-content",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2019-08-06T05:51:52.800Z",
  "bug_reporter_agreed_on_going_public_at": "2019-07-13T02:52:44.659Z",
  "team_member_agreed_on_going_public_at": "2019-08-06T05:51:52.686Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "",
  "weakness": {
    "id": 67,
    "name": "SQL Injection"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-08-12T02:52:44.773Z",
  "allow_singular_disclosure_after": -142252096.07740384,
  "singular_disclosure_allowed": true,
  "vote_count": 751,
  "voters": [
    "totori",
    "lotsofloops",
    "voiddy",
    "an40r1",
    "kzyo0t",
    "lyinq",
    "hexpwn",
    "nohats",
    "xypex",
    "mr_military",
    "and 741 more..."
  ],
  "severity": {
    "rating": "critical",
    "score": 9.3,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "high",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 13008,
    "asset_type": "OTHER",
    "asset_identifier": "Other non domain specific items",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 17666,
      "category": "team",
      "content": "As described in the Hacker Summary, @spaceraccoon discovered a SQL Injection vulnerability in a web service backed by Microsoft Dynamics AX. @spaceraccoon demonstrated that the flaw was exploitable via XML-formatted HTTP payload requests to the server. We appreciate @spaceraccoon's clear and thorough report, which helped us quickly and effectively triage the report and remediate the vulnerability.",
      "user": {
        "id": 241256,
        "username": "shadegrown",
        "name": "",
        "bio": "",
        "cleared": false,
        "verified": false,
        "website": null,
        "location": "",
        "created_at": "2018-02-13T17:38:01.397Z",
        "url": "https://hackerone.com/shadegrown",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/000/241/256/c58560470742940abd59de20f14746b5f8b2dcd2_original.png/60f411638706d89ae3052af6fe8b88fa9a798e291deee40f6a22e81418d78d5f"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    },
    {
      "id": 17199,
      "category": "researcher",
      "content": "## False Starts\n\nI first came across the endpoint via typical subdomain enumeration. On the surface, it looked like an extremely promising target: a simple HTML file upload form. I began by testing for unrestricted file uploads with PHP shells and such, but it quickly became clear from the verbose error messages that while the files were being sent to the server, they were being processed as XML files and were not saved on the server.\n\nFortunately, the error messages helped me craft a properly-formatted XML file that was accepted by the server. It appeared to be some kind of accounting database entry as it expected nodes like `MainAccount`, `Credit`, `Debit`, `Invoice` and so on. Moreover, the error messages included references to [Microsoft Dynamics AX](https://dynamics.microsoft.com/en-sg/ax-overview/?cdn=disable), an enterprise financial/accounting software platform. At this point, I started testing for XXE attacks. However, it appeared that external entities were blocked and despite multiple attempts at bypasses, I could only achieve a \"Billion Laughs\" attack that would result in denial of service. This wasn't good enough, so after several more days of trying, I eventually moved on to other targets.\n\n## The Lightbulb Moment\n\nMore than a month later, I revisited the target. Fortunately, it was still online. This time, I suspected that if the XML input was being entered into a database, I should test for SQL injections. In particular, the `MainAccount` looked promising because it accepted a numerical ID like `<MainAccount>123456</MainAccount>` and was perhaps used in a `WHERE` SQL query.\n\nHowever, it appeared that the apostrophe `'` was being properly escaped. After a bit of testing, I realized my mistake: the XML format prohibits some characters, including the apostrophe. To include them, you have to enter apostrophes as escaped entities. Instead of `<MainAccount>123456'</MainAccount>`, I had to use `<MainAccount>123456&apos;</MainAccount>`. The server immediately returned a `database error` message - I was on the right path!\n\nWith a bit more manual testing, I realized it was possible to craft a time-based SQL injection. I then switched to `sqlmap` with the `--tamper htmlencode` flag to automate my attack. After a few minutes of anxious waiting, `sqlmap` confirmed the exploit and returned the database  version: `Microsoft SQL Server 2012`. I was in!\n\n## Assessing Impact\n\nSo I had an SQL injection - but what if the database was unused or negligible? I decided to test for three things: the type of data in the database, the amount of data, and the recency of data. However, I quickly met a roadblock: as an enterprise database, Microsoft Dynamics AX was massive: a quick check revealed that the database had thousands of tables. I had to find and focus on the main table, but where should I begin?\n\nFortunately, Microsoft provides documentation online about Dynamics AX. After a bit of research, I found the default main table and the relevant columns. A few minutes later, the answers came in. There were almost a million entries up till the previous year that included real accounting information. Zaheck!! I immediately stopped testing and wrote my report.\n\n## Takeaways\n\n1. Don't get tunnel vision. Just because it's a file upload, don't focus solely on uploading a reverse shell. Just because it accepts XML files, don't focus solely on XXE.\n2. Take notes and revisit old targets. Many of my best bugs were from vulnerabilities I found after revisiting an old endpoint. Taking time off can reveal new attack paths.\n3. Assess impact after the initial exploit, but don't go too far.\n\nThank you Starbucks team and Hackerone triagers for responding quickly and communicating so well!",
      "user": {
        "id": 442757,
        "username": "spaceraccoon",
        "name": "spaceraccoon",
        "bio": "Here to learn!",
        "cleared": true,
        "verified": true,
        "website": "https://spaceraccoon.dev/",
        "location": "Singapore",
        "created_at": "2018-12-20T11:15:48.390Z",
        "url": "https://hackerone.com/spaceraccoon",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/c5zYRQsvGPQP6MxHYYN4r5Jp/60f411638706d89ae3052af6fe8b88fa9a798e291deee40f6a22e81418d78d5f"
        }
      },
      "can_view?": true,
      "can_create?": false,
      "attachments": []
    }
  ]
}
