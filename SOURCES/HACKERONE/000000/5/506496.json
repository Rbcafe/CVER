{
  "id": 506496,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MDY0OTY=",
  "url": "https://hackerone.com/reports/506496",
  "title": "RingCT malformed tx prevents target from being able to sweep balance",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2019-03-07T20:46:58.869Z",
  "submitted_at": "2019-03-07T20:46:58.869Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "organdonor1",
    "url": "/organdonor1",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-25f7248a18bdf9e2dc8310319b148d66cff430fa0fade6c5f25fee1b8d7f27ed.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 7731,
    "url": "https://hackerone.com/monero",
    "handle": "monero",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/d3dc6b2d7e2dc3657e8861b0d7e2dfca1a6d513dd784c613f4e56738907cea98",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/5136ed9b2fa7c4d4abbf39fb971047c62d98ec4740a88eb55d7e26373250a937"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": false,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "profile": {
      "name": "Monero",
      "twitter_handle": "monero",
      "website": "https://getmonero.org",
      "about": " Monero: the secure, private, untraceable cryptocurrency"
    }
  },
  "has_bounty?": false,
  "in_validation?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-04-20T22:44:25.226Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2019-03-21T22:44:19.716Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\nAn attacker can send a malformed RingCT transaction to an attackee wallet that prevents the attackee from sweeping their wallet balance. This is done by the attacker changing the mask amount in `genRctSimple` with a modified wallet. The attacker does not need any intervention from the attackee other than their public Monero address.\n\n## Releases Affected:\n\n  * Affects all versions of monero-wallet-cli and monero-wallet-rpc\n\n## Steps To Reproduce:\n\n  1. Clone and compile the v0.14.0.2 tagged branch of monero-project/monero\n  2. Create a new attackee wallet on stagenet. Load it up by sending a few  transactions of various amounts to this wallet.\n  3. Create a new attacker wallet on stagenet. Send one small amount of coins such as 0.1 XMR.\n  4. [Modify this line in rctSigs.cpp](https://github.com/monero-project/monero/blob/v0.14.0.2/src/ringct/rctSigs.cpp#L803) to ` rv.ecdhInfo[i].amount = d2h(MONEY_SUPPLY);`\n  5. Recompile monero-project/monero\n  6. Open the attacker wallet and send a transaction to the attackee wallet. The amount you select to transfer does not matter. Send 0.05 XMR as an example.\n  7. Switch back to upstream code without the patch from step 4.\n  8. Open the attackee wallet and wait for network confirmations. The malformed transaction will correctly show up as 0 XMR. \n  9. Attempt to sweep all from the attackee wallet to any destination. The attackee wallet will throw an error: “Error: internal error: Daemon response did not include the requested real output.”\n\n## How to fix this:\nThe bug is fixed by changing two lines in `wallet2.cpp`. [After this conditional](https://github.com/monero-project/monero/blob//v0.14.0.2/src/wallet/wallet2.cpp#L1337) add `if (!tx_scan_info.money_transfered) { return; } outs.push_back(i);` and remove `outs.push_back(i);` from a few lines earlier. Recompile and rescan the attackee wallet.\n\n## Supporting Material/References:\nThis bug was found by carefully inspecting [this ryo-currency commit](https://github.com/ryo-currency/ryo-currency/commit/e7931ca065baba61bf9b7b96ce567f07669d75de) which was suggested to have a bug fix within. This one line fix makes itself evident because there is no relation to coinbase outputs on this line.\n\nAttackee example stagenet wallet seed: \n\n```\nyesterday doorway sizes royal sipped mesh nephew around\nidols laptop cactus present imagine ponies puzzled auctions\npoaching jogger surfer launching phase rewind soda tequila ponies\n```\n\n## Impact\n\nAn attacker can send malformed transactions and prevent an attackee from being able to sweep their balance. The attackee needs to apply the patch described above and rescan their wallet if they have been affected. Since this attack doesn’t cause permanent damage, it is less severe, however forcing the attackee to rescan their wallet causes loss of data such as tx secret keys.",
  "weakness": {
    "id": 65,
    "name": "Business Logic Errors"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-04-20T22:44:19.784Z",
  "allow_singular_disclosure_after": -152030078.0217209,
  "singular_disclosure_allowed": true,
  "vote_count": 8,
  "voters": [
    "eveeez",
    "cryptographer",
    "akshayambre",
    "tdawgbtc88",
    "carrickchristtopher12",
    "kanonton",
    "kingshish",
    "kinkoknik"
  ],
  "severity": {
    "rating": "medium",
    "score": 6.5,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "low",
      "availability": "low"
    }
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
