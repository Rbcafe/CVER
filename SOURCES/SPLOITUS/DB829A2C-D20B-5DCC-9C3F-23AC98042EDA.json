[
  {
    "source": "## https://sploitus.com/exploit?id=DB829A2C-D20B-5DCC-9C3F-23AC98042EDA\n# CVE-2023-5178\nThe exploit for \n[CVE-2023-5178: NVMe-oF-TCP vulnerability](https://www.opencve.io/cve/CVE-2023-5178), which is a logic error in NVMe-oF-TCP driver during the handle of corrupted `Initialize Connection Request`. It leads to **racy double-free in kmalloc-96**, which can be exploited to gain LPE(see demo below).\n\nThe exploit targets `Ubuntu 23.10` with `6.5.0-9-generic` kernel (the latest affected kernel version). \n* It can be easily backported to earlier `v6` kernel by changing kernel symbols \nand adjusting ropchain.\n* Backporting to kernel version `v5` requires some minor modifications which I will discuss in the writeup. Exploitation in kernel `v5` is easier (I will discuss it in writeup) and is more reliable.\n\nThe bug was discovered by Alon Zahavi. He posted a good description of the vulnerability in\nthis [openwall article](https://www.openwall.com/lists/oss-security/2023/10/15/1).\n\n## DEMO\nSee video [here](https://youtu.be/dulmno4GjF8).\n![DEMO PIC 1 HERE](./assets/demo_pic_1.png)\n![DEMO PIC 2 HERE](./assets/demo_pic_2.png)\n\n## Requirements\n* You should have the `nvmet`, `nvmet-tcp` modules being loaded into the kernel. \n* Be sure you have `libfuse3-dev` (it's by default on Ubuntu, but anyways). If you don't have it, the best idea is to download and \ncompile release from [github](https://github.com/libfuse/libfuse/).\nI used `3.14.0`, but it should work with other versions too.\n* Currently exploit works on machines with **1 CPU** only. It's only about how the `SLUB` works, but race condition makes things a little bit tricky. Either way, I will describe in the writeup how it can be improved to handle multi-CPU machines.\n\n# Setup\n```\ngit clone https://github.com/rockrid3r/CVE-2023-5178\ncd CVE-2023-5178\nmake\n./build/xpl # run the exploit\n```\n* In case you don't have `libfuse3-dev`, you should manually link the compiled libfuse. \nSee `Makefile` for how to compile. Replace `-lfuse3` with `-l:path-to-libfuse.so`. Don't forget to add header path with `-I /path/to/libfuse-headers/`.\nRun the exploit with:\n```\nLD_PRELOAD_PATH=/path/to/libfuse.so ./build/exploit\n```\n\n# Writeup\nSee complete writeup [here](https://rockrid3r.github.io/2024/02/07/CVE-2023-5178.html)",
    "id": "DB829A2C-D20B-5DCC-9C3F-23AC98042EDA",
    "href": "https://github.com/rockrid3r/CVE-2023-5178",
    "title": "Exploit for Use After Free in Linux Linux Kernel"
  }
]
